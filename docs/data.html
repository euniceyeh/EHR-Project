<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>BST 260 Final Project: EHR</title>
  <meta name="description" content="This is the final project report for BST 260 on the relationships between the use of Electronic Health Records (EHR) and provider demographics, separately among the eligible professionals (EPs) and eligible hospitals participating in the Medicare &amp; Medicaid EHR Incentive Program in 2016.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="BST 260 Final Project: EHR" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the final project report for BST 260 on the relationships between the use of Electronic Health Records (EHR) and provider demographics, separately among the eligible professionals (EPs) and eligible hospitals participating in the Medicare &amp; Medicaid EHR Incentive Program in 2016." />
  <meta name="github-repo" content="euniceyeh/EHR-Project" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="BST 260 Final Project: EHR" />
  
  <meta name="twitter:description" content="This is the final project report for BST 260 on the relationships between the use of Electronic Health Records (EHR) and provider demographics, separately among the eligible professionals (EPs) and eligible hospitals participating in the Medicare &amp; Medicaid EHR Incentive Program in 2016." />
  

<meta name="author" content="Eunice Yeh, Lauren Yoo, Katherine Wang">


<meta name="date" content="2017-12-09">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="questions.html">
<link rel="next" href="primary.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">BST 260 Final Project: EHR</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview and Motivation</a></li>
<li class="chapter" data-level="2" data-path="work.html"><a href="work.html"><i class="fa fa-check"></i><b>2</b> Related Work</a></li>
<li class="chapter" data-level="3" data-path="questions.html"><a href="questions.html"><i class="fa fa-check"></i><b>3</b> Initial Questions</a></li>
<li class="chapter" data-level="4" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>4</b> Data</a><ul>
<li class="chapter" data-level="4.1" data-path="data.html"><a href="data.html#eligible-professionals-eps"><i class="fa fa-check"></i><b>4.1</b> Eligible Professionals (EPs)</a><ul>
<li class="chapter" data-level="4.1.1" data-path="data.html"><a href="data.html#sourcemetadata"><i class="fa fa-check"></i><b>4.1.1</b> Source/Metadata</a></li>
<li class="chapter" data-level="4.1.2" data-path="data.html"><a href="data.html#wrangling"><i class="fa fa-check"></i><b>4.1.2</b> Wrangling</a></li>
<li class="chapter" data-level="4.1.3" data-path="data.html"><a href="data.html#output"><i class="fa fa-check"></i><b>4.1.3</b> Output</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="data.html"><a href="data.html#eligible-hospitals-hosp"><i class="fa fa-check"></i><b>4.2</b> Eligible Hospitals (Hosp)</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data.html"><a href="data.html#sourcemetadata-1"><i class="fa fa-check"></i><b>4.2.1</b> Source/Metadata</a></li>
<li class="chapter" data-level="4.2.2" data-path="data.html"><a href="data.html#wrangling-1"><i class="fa fa-check"></i><b>4.2.2</b> Wrangling</a></li>
<li class="chapter" data-level="4.2.3" data-path="data.html"><a href="data.html#output-1"><i class="fa fa-check"></i><b>4.2.3</b> Output</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data.html"><a href="data.html#vendors-products-ehr"><i class="fa fa-check"></i><b>4.3</b> Vendors &amp; Products (EHR)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data.html"><a href="data.html#sourcemetadata-2"><i class="fa fa-check"></i><b>4.3.1</b> Source/Metadata</a></li>
<li class="chapter" data-level="4.3.2" data-path="data.html"><a href="data.html#wrangling-2"><i class="fa fa-check"></i><b>4.3.2</b> Wrangling</a></li>
<li class="chapter" data-level="4.3.3" data-path="data.html"><a href="data.html#output-2"><i class="fa fa-check"></i><b>4.3.3</b> Output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="primary.html"><a href="primary.html"><i class="fa fa-check"></i><b>5</b> Primary Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="primary.html"><a href="primary.html#physician-demographics"><i class="fa fa-check"></i><b>5.1</b> Physician Demographics</a><ul>
<li class="chapter" data-level="5.1.1" data-path="primary.html"><a href="primary.html#exploratory"><i class="fa fa-check"></i><b>5.1.1</b> Exploratory</a></li>
<li class="chapter" data-level="5.1.2" data-path="primary.html"><a href="primary.html#final-analysis"><i class="fa fa-check"></i><b>5.1.2</b> Final Analysis</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="primary.html"><a href="primary.html#hospital-demographics"><i class="fa fa-check"></i><b>5.2</b> Hospital Demographics</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="secondary.html"><a href="secondary.html"><i class="fa fa-check"></i><b>6</b> Secondary Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="secondary.html"><a href="secondary.html#ehr-vendor-types"><i class="fa fa-check"></i><b>6.1</b> EHR Vendor Types</a></li>
<li class="chapter" data-level="6.2" data-path="secondary.html"><a href="secondary.html#exploring-the-characteristics-of-non-hospital-affiliated-practitioners-who-use-ehr"><i class="fa fa-check"></i><b>6.2</b> Exploring the Characteristics of Non-hospital-affiliated Practitioners Who Use EHR</a></li>
<li class="chapter" data-level="6.3" data-path="secondary.html"><a href="secondary.html#regional"><i class="fa fa-check"></i><b>6.3</b> Regional</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BST 260 Final Project: EHR</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Data</h1>
<p>All of our data are based on the 2016 Medicare &amp; Medicaid EHR Incentive Program since the adoption of EHR is an ongoing basis: a provider who adopted and used EHR during the 2014 program, for example, is likely to still be in the program the following years. So theorethically, the 2016 program would be the most cumulative source of providers adopting EHR. As mentioned in <a href="https://euniceyeh.github.io/EHR-Project/work.html">Related Work</a>, the adoption of EHR has been consistently rising over the years across the U.S., so there is also no interest in looking at the use over time when we can just look at the latest collection of data. And since 2017 isn’t quite over yet, it wouldn’t be fair to start looking at the usage of EHR within the 2017 program, so the most recent completed data would be on the 2016 program.</p>
<div id="eligible-professionals-eps" class="section level2">
<h2><span class="header-section-number">4.1</span> Eligible Professionals (EPs)</h2>
<p>To answer the first of our <a href="https://euniceyeh.github.io/EHR-Project/questions.html">Initial Questions</a> as to whether or not a physician’s age, education, practice location, etc. may be related to their use of EHR in the incentive program, we must be able to find demographics data at the practitioner level.</p>
<div id="sourcemetadata" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Source/Metadata</h3>
<p>And here we are: readily available on <a href="https://data.medicare.gov/Physician-Compare/Physician-Compare-National-Downloadable-File/mj5m-pzi6">Data.Medicare.gov</a> are the demographics of physicians eligible for the Medicare &amp; Medicaid EHR incentive program at the practitioner level. We used the api link to read in the dataset and applied SQL filtering options to speed up the download since it is a large file. we specified the limit to be exactly 2254703 because that’s the exact number of rows the data contain, if we don’t specify this the default limit of rows that get downloaded is 100. to compensate, we will specify specific columns to download, which also be specified in the download link (looked thru metadata on the website to select variables i’m interested in).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># change limit to 2254703 on the final run</span>
dat &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://data.medicare.gov/resource/c8qv-268j.csv?$limit=10000&amp;$select=npi,frst_nm,gndr,cred,med_sch,grd_yr,pri_spec,cty,st,zip,hosp_afl_1,hosp_afl_lbn_1,ehr&amp;$order=npi&quot;</span>)</code></pre></div>
</div>
<div id="wrangling" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Wrangling</h3>
<p>Let’s first take a look at the data structure and a summary of all the columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(dat)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    10000 obs. of  13 variables:
##  $ cred          : Factor w/ 16 levels &quot;&quot;,&quot;AU&quot;,&quot;CNA&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ cty           : Factor w/ 2023 levels &quot;ABBEVILLE&quot;,&quot;ABERDEEN&quot;,..: 454 56 1548 524 1785 217 1093 1093 74 74 ...
##  $ ehr           : Factor w/ 2 levels &quot;&quot;,&quot;Y&quot;: 1 1 1 1 2 1 1 1 1 1 ...
##  $ frst_nm       : Factor w/ 1872 levels &quot;AAMIR&quot;,&quot;AARON&quot;,..: 155 155 155 1722 1408 409 763 763 917 917 ...
##  $ gndr          : Factor w/ 2 levels &quot;F&quot;,&quot;M&quot;: 2 2 2 2 2 2 1 1 2 2 ...
##  $ grd_yr        : int  1994 1994 1994 2003 1999 2003 2007 2007 1997 1997 ...
##  $ hosp_afl_1    : int  490126 490126 490126 140010 360262 391312 360098 360098 60024 60024 ...
##  $ hosp_afl_lbn_1: Factor w/ 1450 levels &quot;&quot;,&quot;ABBEVILLE AREA MEDICAL CENTER&quot;,..: 615 615 615 341 743 919 584 584 1333 1333 ...
##  $ med_sch       : Factor w/ 210 levels &quot;A T STILL UN, ARIZONA SCHL OF DENT.Y &amp; ORAL HLTH&quot;,..: 101 101 101 160 101 108 128 128 97 97 ...
##  $ npi           : int  1003000126 1003000126 1003000126 1003000134 1003000142 1003000407 1003000423 1003000423 1003000480 1003000480 ...
##  $ pri_spec      : Factor w/ 72 levels &quot;ADDICTION MEDICINE&quot;,..: 33 33 33 53 3 21 44 44 24 24 ...
##  $ st            : Factor w/ 53 levels &quot;AK&quot;,&quot;AL&quot;,&quot;AR&quot;,..: 47 47 47 15 36 39 36 36 6 6 ...
##  $ zip           : int  201662247 222053610 241537474 602011718 436082675 158251367 440608702 440608702 800452545 800452545 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(dat)</code></pre></div>
<pre><code>##       cred                cty       ehr          frst_nm     gndr    
##         :9575   PITTSBURGH  : 209    :8623   MICHAEL : 182   F:5699  
##  MD     : 253   HOUSTON     : 156   Y:1377   SARAH   : 134   M:4301  
##  PA     :  39   NEW YORK    : 125            JENNIFER: 127           
##  PT     :  29   ANN ARBOR   : 119            DAVID   : 103           
##  NP     :  19   DALLAS      : 117            MATTHEW :  92           
##  OD     :  17   PHILADELPHIA:  99            JOHN    :  89           
##  (Other):  68   (Other)     :9175            (Other) :9273           
##      grd_yr       hosp_afl_1    
##  Min.   :1963   Min.   : 10001  
##  1st Qu.:2004   1st Qu.:140011  
##  Median :2009   Median :260032  
##  Mean   :2007   Mean   :269085  
##  3rd Qu.:2012   3rd Qu.:390147  
##  Max.   :2017   Max.   :800001  
##  NA&#39;s   :9      NA&#39;s   :3156    
##                                     hosp_afl_lbn_1
##                                            :3171  
##  UNIVERSITY OF VIRGINIA MEDICAL CENTER     :  64  
##  BANNER PAYSON MEDICAL CENTER              :  63  
##  UNIVERSITY OF MICHIGAN HEALTH SYSTEM      :  60  
##  PROVIDENCE REGIONAL MEDICAL CENTER EVERETT:  59  
##  EASTERN MAINE MEDICAL CENTER              :  56  
##  (Other)                                   :6527  
##                                       med_sch          npi           
##  OTHER                                    :6302   Min.   :1.003e+09  
##  BAYLOR COLLEGE OF MEDICINE               :  73   1st Qu.:1.003e+09  
##  UNIVERSITY OF FLORIDA COLLEGE OF MEDICINE:  67   Median :1.003e+09  
##  LAKE ERIE COLLEGE OF OSTEOPATHIC MEDICINE:  63   Mean   :1.003e+09  
##  NEW YORK UNIVERSITY SCHOOL OF MEDICINE   :  59   3rd Qu.:1.003e+09  
##  INDIANA UNIVERSITY SCHOOL OF MEDICINE    :  58   Max.   :1.004e+09  
##  (Other)                                  :3378                      
##                                    pri_spec          st      
##  NURSE PRACTITIONER                    :1569   TX     : 780  
##  PHYSICIAN ASSISTANT                   :1053   CA     : 768  
##  INTERNAL MEDICINE                     : 936   PA     : 679  
##  PHYSICAL THERAPY                      : 652   FL     : 612  
##  FAMILY PRACTICE                       : 638   NY     : 592  
##  CERTIFIED REGISTERED NURSE ANESTHETIST: 541   MI     : 422  
##  (Other)                               :4611   (Other):6147  
##       zip           
##  Min.   :      603  
##  1st Qu.:212086417  
##  Median :452192364  
##  Mean   :476032054  
##  3rd Qu.:752434115  
##  Max.   :998017863  
## </code></pre>
<p>From the above outputs, we learned that:</p>
<ul>
<li>There are 53 levels of states, which means this data include states outside of the 50 mainland states and DC. we don’t have sufficient data on the virgin islands and guam, so we will have to filter these states out.</li>
<li>There is one person whose gender is unknown, we will filter this person out since we want to group by gender.</li>
<li>There are rows with missing graduation years, will need to filer this out too if graduation years is one of the main demographics of interest (will mess up plotting). Also, one or more physician who graduated in 2017 slipped into our data…we will ignore this by filtering it out too.</li>
<li>The zip code, 603, is out of range. a standard zip code has to be at least 5 digits. looks like most zip codes in this data are the full 9-digit zip codes, which can be split into the standard 5-digit format and the 4-digit after.</li>
<li>There are way too many levels of medical schools and primary specialties, we will probably focus on looking at the most popular ones for exploratory analysis.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;state&quot;</span>)
clean &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(st <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(state.abb, <span class="st">&quot;DC&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(gndr <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(<span class="kw">as.integer</span>(grd_yr)) <span class="op">&amp;</span><span class="st"> </span>grd_yr <span class="op">!=</span><span class="st"> </span><span class="dv">2017</span>)</code></pre></div>
<p>Now we only have 51 levels of states, 2 levels of gender, and no records with missing graduation year. But we still have zip codes as small as 2138, which is still out of range. To make sure only keep valid zip codes (since there may be other ways the zip codes are not clean), we can try to use R’s zip code package to validate our zip codes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># separate out the first five zip codes from the last four extension to match R zipcode data</span>
clean &lt;-<span class="st"> </span>clean <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">zip.ext =</span> <span class="kw">substr</span>(<span class="kw">as.character</span>(zip), <span class="dv">6</span>, <span class="dv">9</span>), 
                          <span class="dt">zip =</span> <span class="kw">substr</span>(<span class="kw">as.character</span>(zip), <span class="dv">1</span>, <span class="dv">5</span>))

<span class="co"># use R zipcode package and data</span>
<span class="kw">library</span>(zipcode)
<span class="kw">data</span>(<span class="st">&quot;zipcode&quot;</span>)
zip_dat &lt;-<span class="st"> </span>clean <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(zipcode,<span class="dt">by=</span><span class="st">&#39;zip&#39;</span>) 
<span class="co"># zip_dat %&gt;% select(npi, zip, zip.ext, cty, st, city, state, latitude, longitude) %&gt;% filter(as.character(st) != state | is.na(as.integer(state))) %&gt;% arrange(as.integer(zip)) %&gt;%  head(.,20)</span>
<span class="co"># test &lt;- zip_dat %&gt;% select(npi, zip, zip.ext, cty, st, city, state, latitude, longitude) %&gt;% mutate(st = as.character(st)) %&gt;% filter(st != state) %&gt;% arrange(as.integer(zip))</span>

<span class="co"># check if any of the invalid zip codes were matched to R&#39;s zip code package</span>
zip_dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">nchar</span>(zip) <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(npi, frst_nm, zip, cty, st, city, state) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">20</span>)</code></pre></div>
<pre><code>##           npi  frst_nm  zip           cty st city state
## 1  1003003088    AVANI 8824  KENDALL PARK NJ &lt;NA&gt;  &lt;NA&gt;
## 2  1003021866    DONNA 8060   MOUNT HOLLY NJ &lt;NA&gt;  &lt;NA&gt;
## 3  1003024142  ALLISON 7719          WALL NJ &lt;NA&gt;  &lt;NA&gt;
## 4  1003033390    BRIAN 6385     WATERFORD CT &lt;NA&gt;  &lt;NA&gt;
## 5  1003033390    BRIAN 6385     WATERFORD CT &lt;NA&gt;  &lt;NA&gt;
## 6  1003041427   LAURIE 8302     BRIDGETON NJ &lt;NA&gt;  &lt;NA&gt;
## 7  1003149451 COURTNEY 8401 ATLANTIC CITY NJ &lt;NA&gt;  &lt;NA&gt;
## 8  1003149477   ASHLEY 7430        MAHWAH NJ &lt;NA&gt;  &lt;NA&gt;
## 9  1003150137     ALAN 2601       HYANNIS MA &lt;NA&gt;  &lt;NA&gt;
## 10 1003162132  JESSICA 4901    WATERVILLE ME &lt;NA&gt;  &lt;NA&gt;
## 11 1003188954 KIMBERLY 2557    OAK BLUFFS MA &lt;NA&gt;  &lt;NA&gt;
## 12 1003228479   LAUREN 3103    MANCHESTER NH &lt;NA&gt;  &lt;NA&gt;
## 13 1003248204    KELLY 2138     CAMBRIDGE MA &lt;NA&gt;  &lt;NA&gt;</code></pre>
<p>As expected, none of the zip codes with only 4 digits matched, so these 13 records will have to be thrown away in order for us to be able to accurately do analysis on the location variables and regional analysis and to match with the vendor data by zip code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">zip_mismatch &lt;-<span class="st"> </span>zip_dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">st =</span> <span class="kw">as.character</span>(st)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(st <span class="op">!=</span><span class="st"> </span>state <span class="op">|</span><span class="st"> </span><span class="kw">nchar</span>(zip) <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(npi, frst_nm, zip, cty, city, st, state, latitude, longitude)

<span class="co"># check number of records mismatched</span>
<span class="kw">nrow</span>(zip_mismatch)</code></pre></div>
<pre><code>## [1] 399</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># look at the top five mismatches</span>
(top5_mismatch &lt;-<span class="st"> </span>zip_mismatch <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(zip, cty, st, city, state) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>))</code></pre></div>
<pre><code>## # A tibble: 5 x 6
## # Groups:   zip, cty, st, city [5]
##     zip        cty    st         city state     n
##   &lt;chr&gt;     &lt;fctr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
## 1 21156     BOSTON    MA  Upper Falls    MD    10
## 2 16550  WORCESTER    MA         Erie    PA     7
## 3 22152     BOSTON    MA  Springfield    VA     7
## 4 23602   PLYMOUTH    MA Newport News    VA     7
## 5 31033 MANCHESTER    NH      Haddock    GA     7</code></pre>
<p>In order to not just blatantly throw away 399 mismatches, we will look at the top 5 most common mismatches on a case-by-case basis to try to salvage as many records as possible without searching too deeply in our dataset. Also, starting from the 6th most common mismatches, the number of records (n) were down to 58 or less, so they would have little effect on the dataset.</p>
<p>The results of searching up the top 10 mismatches on Google Maps:</p>
<ul>
<li>the zipcode 99362 spans across Walla Walla in both WA and OR, so it is likely that the practice is located on the WA side of the zipcode coverage. We will ignore the state mismatch from the zipcode package for this case.</li>
<li>the zipcode 52761 does belong to Muscatine, IA, which is right on the border of IL. Again, the practice is most likely located on the IA side. Will ignore the state mismatch for this case as well.</li>
<li>the zip code for Granger, IN was most likely mistyped. The correct zip code for Granger is 46530, which is very close to 43530. We will fix the zipcode for this particular case only.</li>
<li>the zipcode 22401 does belong to Frederickburg, VA, and is not near the border of VA and MD at all. There is a “Frederick” city in MD, but none of its zipcodes look similar enough to 22401. No clear culprit, will have to let this one go. :(</li>
<li>The zipcode for Hanover, MD is 21076, which was most likely mistyped as 20176. We will fix this particular case as well.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># leave out the 22401 Fredericksburg MD mismatch, fix the zip codes for Granger and Hanover.</span>
zip_fix &lt;-<span class="st"> </span>top5_mismatch <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(cty <span class="op">!=</span><span class="st"> &#39;FREDERICKSBURG&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">zip =</span> <span class="kw">replace</span>(zip, zip <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">43530</span>, <span class="dv">20176</span>), <span class="kw">c</span>(<span class="dv">46530</span>, <span class="dv">21076</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>n)

mismatch_tokeep &lt;-<span class="st"> </span>zip_dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>zip) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># we want to replace the original wrong zip codes with the fixed zip codes</span>
<span class="st">  </span><span class="kw">inner_join</span>(zip_fix, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;cty&#39;</span>,<span class="st">&#39;st&#39;</span>, <span class="st">&#39;city&#39;</span>, <span class="st">&#39;state&#39;</span>))</code></pre></div>
<pre><code>## Warning: Column `st` joining factor and character vector, coercing into
## character vector</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clean &lt;-<span class="st"> </span>zip_dat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">st =</span> <span class="kw">as.character</span>(st), <span class="dt">state =</span> <span class="kw">as.character</span>(state)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(st <span class="op">==</span><span class="st"> </span>state <span class="op">|</span><span class="st"> </span><span class="kw">nchar</span>(zip) <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># keeping only the matches</span>
<span class="st">  </span><span class="kw">bind_rows</span>(mismatch_tokeep) <span class="co"># then add in the mismatches we wanted to keep or have fixed</span></code></pre></div>
<p>Continuing on with our wrangling…</p>
<ul>
<li>About 31.56% of the (original) data are of physicians not affiliated with any hospital, these are the practitioners we will subset on to do our practitioner-level analysis on since these are the only cases when a physician’s demographics can have an effect on the choice of using EHR. For physicians who are affiliated with a hospital, their demographics would no longer be informative as to whether or not they use EHR, it would then have to be the demographics of the hospitals that could inform the use of EHR at the hospital-level. Thus, we were able to find hospital demographics such as ___ on hospitals across the U.S. in general, which will be discussed in the next section within this chapter, but there’s no indication of participation in the incentive program nor EHR use, so we will have to merge that hospital demographic data with the practitioners in this dataset who are affiliated with any one hospital.</li>
</ul>
<p>for the practitioner-level analysis we want to:</p>
<ul>
<li>Calculate the number of years since graudation</li>
<li>Use 1’s and 0’s instead of ‘Y’ and blanks as indicator of EHR use for our binary outcome</li>
<li>Keep only one record per physician, which means we would have to lose the distinct practice locations for physicians who have multiple practices. But since we can’t fit our logistic model with either city, state, or zip code, there’s no point in keeping this detail. Instead, we can calculate the number of distinct practices these physicians have in order to collapse the data to the practitioner level.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EPs &lt;-<span class="st"> </span>clean <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(<span class="kw">as.integer</span>(hosp_afl_<span class="dv">1</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">yrs_grd =</span> <span class="dv">2016</span> <span class="op">-</span><span class="st"> </span><span class="kw">as.integer</span>(grd_yr), <span class="co"># calc the n of years since graduation</span>
         <span class="dt">cred =</span> <span class="kw">case_when</span>(cred <span class="op">==</span><span class="st"> &#39;&#39;</span> <span class="op">~</span><span class="st"> &#39;NA&#39;</span>, <span class="co"># assign blanks to NA&#39;s</span>
                          <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(cred)),
         <span class="dt">cred =</span> <span class="kw">as.factor</span>(cred),
         <span class="dt">ehr =</span> <span class="kw">case_when</span>(ehr <span class="op">==</span><span class="st"> &#39;Y&#39;</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="co"># use numeric indicators</span>
                         ehr <span class="op">==</span><span class="st"> &#39;&#39;</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>),
         <span class="dt">ehr =</span> <span class="kw">as.factor</span>(ehr)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>hosp_afl_<span class="dv">1</span>, <span class="op">-</span>hosp_afl_lbn_<span class="dv">1</span>, <span class="op">-</span>frst_nm) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">distinct</span>(npi, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>) <span class="co"># keep only one row per physician</span>

<span class="co"># calculate the number of practices for each physician</span>
SL &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(npi) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">locations =</span> <span class="kw">n_distinct</span>(zip))

EPs &lt;-<span class="st"> </span><span class="kw">left_join</span>(EPs, SL, <span class="dt">by=</span><span class="st">&quot;npi&quot;</span>)

<span class="kw">rm</span>(SL)
<span class="kw">summary</span>(EPs)</code></pre></div>
<pre><code>##       cred               cty       ehr      gndr         grd_yr    
##  NA     :1535   NEW YORK   :  21   0:1531   F:1068   Min.   :1965  
##  PT     :  14   ROCHESTER  :  16   1:  70   M: 533   1st Qu.:2003  
##  DC     :  10   DALLAS     :  14                     Median :2009  
##  MD     :  10   COLUMBUS   :  13                     Mean   :2006  
##  CSW    :   8   DURHAM     :  13                     3rd Qu.:2013  
##  OD     :   7   SAN ANTONIO:  13                     Max.   :2016  
##  (Other):  17   (Other)    :1511                                   
##                                      med_sch          npi           
##  OTHER                                   :1133   Min.   :1.003e+09  
##  LOGAN COLLEGE OF CHIROPRACTIC           :  19   1st Qu.:1.003e+09  
##  SOUTHERN COLLEGE OF OPTOMETRY           :  17   Median :1.003e+09  
##  PALMER COLLEGE CHIROPRACTIC - DAVENPORT :  16   Mean   :1.003e+09  
##  NEW YORK CHIROPRACTIC COLLEGE           :  12   3rd Qu.:1.003e+09  
##  ILLINOIS COLLEGE OF OPTOMETRY AT CHICAGO:  11   Max.   :1.004e+09  
##  (Other)                                 : 393                      
##                    pri_spec        st                zip           
##  PHYSICAL THERAPY      :306   Length:1601        Length:1601       
##  NURSE PRACTITIONER    :247   Class :character   Class :character  
##  CLINICAL SOCIAL WORKER:201   Mode  :character   Mode  :character  
##  CHIROPRACTIC          :128                                        
##  PHYSICIAN ASSISTANT   :108                                        
##  OPTOMETRY             : 99                                        
##  (Other)               :512                                        
##    zip.ext              city              state              latitude    
##  Length:1601        Length:1601        Length:1601        Min.   :20.04  
##  Class :character   Class :character   Class :character   1st Qu.:33.87  
##  Mode  :character   Mode  :character   Mode  :character   Median :38.69  
##                                                           Mean   :37.66  
##                                                           3rd Qu.:41.28  
##                                                           Max.   :64.84  
##                                                           NA&#39;s   :66     
##    longitude          yrs_grd        locations     
##  Min.   :-161.88   Min.   : 0.00   Min.   : 1.000  
##  1st Qu.:-102.09   1st Qu.: 3.00   1st Qu.: 1.000  
##  Median : -88.16   Median : 7.00   Median : 1.000  
##  Mean   : -93.17   Mean   :10.01   Mean   : 1.314  
##  3rd Qu.: -80.70   3rd Qu.:13.00   3rd Qu.: 1.000  
##  Max.   : -73.07   Max.   :51.00   Max.   :25.000  
##  NA&#39;s   :66</code></pre>
<p>[explain the analysis-ready data]</p>
</div>
<div id="output" class="section level3">
<h3><span class="header-section-number">4.1.3</span> Output</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">saveRDS</span>(EPs, <span class="dt">file =</span> <span class="st">&quot;./data/EPs.rds&quot;</span>)
<span class="co"># don&#39;t actually need to save hosp_afl data, going to merge with hospital data soon</span>
<span class="co"># saveRDS(hosp_afl, file = &quot;./data/hosp_afl.RDS&quot;)</span>
hosp_afl &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(<span class="kw">as.integer</span>(hosp_afl_<span class="dv">1</span>)))</code></pre></div>
<ul>
<li><code>EPs</code> data will be used to analyze the potential effects of practitioner demographics on the use of EHR, contains one row per physician</li>
<li><code>hosp_afl</code> is to be merged with the hospital demographics data discussed in the next section, contains one row per physician per state</li>
<li>both are to be merged with the EHR vendor and product information to explore these demographics by specific types of EHR used.</li>
</ul>
</div>
</div>
<div id="eligible-hospitals-hosp" class="section level2">
<h2><span class="header-section-number">4.2</span> Eligible Hospitals (Hosp)</h2>
<p>General hospital demographics such as the total number of staffed beds, total number of discharges, total number of patient days, and total gross patient revenue (inpatient and outpatient) are all publicly accessible on the <a href="https://www.ahd.com/states/">American Hospital Directory</a> organized by U.S. states. Since there is not a <code>.csv</code> file ready for us to download and the hospital demographics are already neatly summarized in a table for each state, we decided that we could do some web scraping for this. The details of these hospital statistics are described <a href="https://www.ahd.com/definitions/statistics.html">here</a>.</p>
<div id="sourcemetadata-1" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Source/Metadata</h3>
<p>The link to each U.S. state’s summary table of hospital demographics by hospital name in that state begins with the same URL: <code>https://www.ahd.com/states/hospital_</code> and ends with the state’s abbreviation plus a <code>.html</code>. For example, a table of hospital demographics for each hospital in Massachusetts can be directly scraped from the link, <a href="https://www.ahd.com/states/hospital_MA.html" class="uri">https://www.ahd.com/states/hospital_MA.html</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># code for scraping</span>
a =<span class="st"> </span><span class="dv">1</span>
b =<span class="st"> </span><span class="dv">2</span>
a <span class="op">+</span><span class="st"> </span>b <span class="co"># check that this does not evaluate to anything</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(hosp_web)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    3334 obs. of  7 variables:
##  $ Hospital_name        : chr  &quot;Alaska Regional Hospital&quot; &quot;Bartlett Regional Hospital&quot; &quot;Central Peninsula General Hospital&quot; &quot;Fairbanks Memorial Hospital&quot; ...
##  $ City                 : chr  &quot;Anchorage&quot; &quot;Juneau&quot; &quot;Soldotna&quot; &quot;Fairbanks&quot; ...
##  $ Staffed_beds         : num  174 57 106 212 74 379 125 88 71 49 ...
##  $ Total_discharges     : num  6405 1710 2575 4513 4857 ...
##  $ Patient_days         : num  33507 6325 10186 21706 19498 ...
##  $ Gross_patient_revenue: num  947754 147231 305469 456240 596437 ...
##  $ State                : chr  &quot;ak_t&quot; &quot;ak_t&quot; &quot;ak_t&quot; &quot;ak_t&quot; ...</code></pre>
</div>
<div id="wrangling-1" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Wrangling</h3>
<ul>
<li>looks like there are some hospitals with really low values - turns out they indicate missing data with zeroes, so we need to convert all zeroes to missing so that the zero values do not misinform summary statistics, and we highly doubt that the zeros are actually meaningfully zeros…<em>right?</em></li>
<li>merge in with <code>hosp_afl</code>, which is a subset of practitioners who are affiliated with a hospital, on the hospital name and city (since different hospitals in different locations can have the same name).</li>
</ul>
</div>
<div id="output-1" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Output</h3>
<ul>
<li><code>hosp</code> will be used to analyze the potential effects of hospital demographics on the use of EHR</li>
<li>and to subsequently merge with the EHR vendor and product information to explore these demographics by specific types of EHR used.</li>
</ul>
</div>
</div>
<div id="vendors-products-ehr" class="section level2">
<h2><span class="header-section-number">4.3</span> Vendors &amp; Products (EHR)</h2>
<p>Since so many professionals and hospitals across the U.S. have already adopted EHR, we realized that simplying looking at the binary outcome of EHR use would be too boring of a project. Thus, we were curious to further explore the demographics of those who do use EHR by the specific types of EHR vendor or product. Fortunately, we were able to find data to support this additional secondary/exploratory analysis.</p>
<div id="sourcemetadata-2" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Source/Metadata</h3>
<p>The <a href="https://dashboard.healthit.gov/datadashboard/documentation/ehr-products-mu-attestation-data-documentation.php">Health IT Dashboard</a> provides certified health IT product data from the ONC Certified Health IT Product List (CHPL) such as the unique vendors, products, and product types of each certified health IT product used as part of the Medicare EHR Incentive Program. We downloaded only the 2016 dataset, which also includes unique provider identifiers (NPI), in order to match the <code>EPs</code> dataset discussed in the first section of this chapter. As the <a href="https://dashboard.healthit.gov/api/open-api.php?source=onc-data-documentation.csv&amp;data=ehr-products-mu-attestation-data-documentation">metadata</a> explains, a provider in this dataset can be either an eligible professional (EP) and eligible hospital (Hospital), as distinguished by the <code>Provider_Type</code> column. Thus, only the <code>Provider_Type == 'EP'</code> records is merged with the subset of <code>EPs</code> who are not affiliated with any hospital, and the <code>Provider_Type == 'Hospital'</code> records is merged with the subset of <code>EPs</code> who are affiliated with a hospital, and therefore directly merged with the combined and cleaned version of the <code>hosp</code> dataset discussed in the previous section of this chapter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EHR &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://dashboard.healthit.gov/datadashboard/data/MU_REPORT_2016.csv&quot;</span>)</code></pre></div>
</div>
<div id="wrangling-2" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Wrangling</h3>
<ul>
<li><p>specific product types are too dirty and not meaningful, will focus on vendor types.</p></li>
<li>merge with the subset of EPs who are not affiliated with any hospital, basically just the cleaned <code>EPs</code></li>
<li>notice that the <code>ehr</code> column is not all <code>y</code> when we expect them to be. this explains why we had so many physicians who fell in the <code>ehr=''</code> category. the physicians whom we have EHR product usage information on did not answer “yes” to EHR use in the phys data.</li>
<li>again the top primary specialties overall are <code>summary(dat$pri_spec)</code>, compare that to the top specialities among physicians whom we have vendor information: <code>summary(vend_EPs$pri_spec)</code>.</li>
<li><p>merge with the cleaned hosp data</p></li>
</ul>
</div>
<div id="output-2" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Output</h3>
<p>Although the specific product types are too granular and not meaningful enough to clean, we believe that exploring the professional and hospital demographics across vendor types may still be interesting, especially if we focus on the top 10 most popular vendors or classify the smaller local vendors as one group.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="questions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="primary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/euniceyeh/EHR-Project/edit/master/03-Data.Rmd",
"text": "Edit"
},
"download": ["EHR-Project.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
