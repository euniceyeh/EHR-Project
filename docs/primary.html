<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>BST 260 Final Project: EHR</title>
  <meta name="description" content="This is the final project report for BST 260 on the relationships between the use of Electronic Health Records (EHR) and provider demographics, separately among the eligible professionals (EPs) and eligible hospitals participating in the Medicare &amp; Medicaid EHR Incentive Program in 2016.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="BST 260 Final Project: EHR" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the final project report for BST 260 on the relationships between the use of Electronic Health Records (EHR) and provider demographics, separately among the eligible professionals (EPs) and eligible hospitals participating in the Medicare &amp; Medicaid EHR Incentive Program in 2016." />
  <meta name="github-repo" content="euniceyeh/EHR-Project" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="BST 260 Final Project: EHR" />
  
  <meta name="twitter:description" content="This is the final project report for BST 260 on the relationships between the use of Electronic Health Records (EHR) and provider demographics, separately among the eligible professionals (EPs) and eligible hospitals participating in the Medicare &amp; Medicaid EHR Incentive Program in 2016." />
  

<meta name="author" content="Eunice Yeh, Lauren Yoo, Katherine Wang">


<meta name="date" content="2017-12-10">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="data.html">
<link rel="next" href="secondary.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">BST 260 Final Project: EHR</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview and Motivation</a></li>
<li class="chapter" data-level="2" data-path="work.html"><a href="work.html"><i class="fa fa-check"></i><b>2</b> Related Work</a></li>
<li class="chapter" data-level="3" data-path="questions.html"><a href="questions.html"><i class="fa fa-check"></i><b>3</b> Initial Questions</a></li>
<li class="chapter" data-level="4" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>4</b> Data</a><ul>
<li class="chapter" data-level="4.1" data-path="data.html"><a href="data.html#eligible-professionals-eps"><i class="fa fa-check"></i><b>4.1</b> Eligible Professionals (EPs)</a><ul>
<li class="chapter" data-level="4.1.1" data-path="data.html"><a href="data.html#sourcemetadata"><i class="fa fa-check"></i><b>4.1.1</b> Source/Metadata</a></li>
<li class="chapter" data-level="4.1.2" data-path="data.html"><a href="data.html#wrangling"><i class="fa fa-check"></i><b>4.1.2</b> Wrangling</a></li>
<li class="chapter" data-level="4.1.3" data-path="data.html"><a href="data.html#output"><i class="fa fa-check"></i><b>4.1.3</b> Output</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="data.html"><a href="data.html#eligible-hospitals-hosp"><i class="fa fa-check"></i><b>4.2</b> Eligible Hospitals (Hosp)</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data.html"><a href="data.html#sourcemetadata-1"><i class="fa fa-check"></i><b>4.2.1</b> Source/Metadata</a></li>
<li class="chapter" data-level="4.2.2" data-path="data.html"><a href="data.html#wrangling-1"><i class="fa fa-check"></i><b>4.2.2</b> Wrangling</a></li>
<li class="chapter" data-level="4.2.3" data-path="data.html"><a href="data.html#output-1"><i class="fa fa-check"></i><b>4.2.3</b> Output</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data.html"><a href="data.html#vendors-products-ehr"><i class="fa fa-check"></i><b>4.3</b> Vendors &amp; Products (EHR)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data.html"><a href="data.html#sourcemetadata-2"><i class="fa fa-check"></i><b>4.3.1</b> Source/Metadata</a></li>
<li class="chapter" data-level="4.3.2" data-path="data.html"><a href="data.html#wrangling-2"><i class="fa fa-check"></i><b>4.3.2</b> Wrangling</a></li>
<li class="chapter" data-level="4.3.3" data-path="data.html"><a href="data.html#output-2"><i class="fa fa-check"></i><b>4.3.3</b> Output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="primary.html"><a href="primary.html"><i class="fa fa-check"></i><b>5</b> Primary Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="primary.html"><a href="primary.html#physician-demographics"><i class="fa fa-check"></i><b>5.1</b> Physician Demographics</a><ul>
<li class="chapter" data-level="5.1.1" data-path="primary.html"><a href="primary.html#exploratory"><i class="fa fa-check"></i><b>5.1.1</b> Exploratory</a></li>
<li class="chapter" data-level="5.1.2" data-path="primary.html"><a href="primary.html#final-analysis"><i class="fa fa-check"></i><b>5.1.2</b> Final Analysis</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="primary.html"><a href="primary.html#hospital-demographics"><i class="fa fa-check"></i><b>5.2</b> Hospital Demographics</a><ul>
<li class="chapter" data-level="5.2.1" data-path="primary.html"><a href="primary.html#exploratory-1"><i class="fa fa-check"></i><b>5.2.1</b> Exploratory</a></li>
<li class="chapter" data-level="5.2.2" data-path="primary.html"><a href="primary.html#final-analysis-1"><i class="fa fa-check"></i><b>5.2.2</b> Final Analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="secondary.html"><a href="secondary.html"><i class="fa fa-check"></i><b>6</b> Secondary Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="secondary.html"><a href="secondary.html#by-geographical-regions"><i class="fa fa-check"></i><b>6.1</b> By Geographical Regions</a><ul>
<li class="chapter" data-level="6.1.1" data-path="secondary.html"><a href="secondary.html#physician-demographics-1"><i class="fa fa-check"></i><b>6.1.1</b> Physician Demographics</a></li>
<li class="chapter" data-level="6.1.2" data-path="secondary.html"><a href="secondary.html#hospital-demographics-1"><i class="fa fa-check"></i><b>6.1.2</b> Hospital Demographics</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="secondary.html"><a href="secondary.html#by-ehr-vendors"><i class="fa fa-check"></i><b>6.2</b> By EHR Vendors</a><ul>
<li class="chapter" data-level="6.2.1" data-path="secondary.html"><a href="secondary.html#physician-demographics-2"><i class="fa fa-check"></i><b>6.2.1</b> Physician Demographics</a></li>
<li class="chapter" data-level="6.2.2" data-path="secondary.html"><a href="secondary.html#hospital-demographics-2"><i class="fa fa-check"></i><b>6.2.2</b> Hospital Demographics</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BST 260 Final Project: EHR</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="primary" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Primary Analysis</h1>
<p><strong>[resate our primary objectives here and explain why we split the primary analysis into the following sections]</strong></p>
<div id="physician-demographics" class="section level2">
<h2><span class="header-section-number">5.1</span> Physician Demographics</h2>
<p>Since practitioners who are affiliated with a hospital may not have a choice in using EHR or not, we will exclude these from our analysis population, which is now just the practitioners who enrolled in the Medicare Incentive Program who are not affiliated with any hospital, which come from the data set <code>EPs</code> that we cleaned in section <a href="https://euniceyeh.github.io/EHR-Project/data.html#eligible-professionals-eps">4.1</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EPs &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;./data/EPs.rds&quot;</span>)</code></pre></div>
<p>[explain that we are doing logistic regression model because of our binary outcome EHR use, and write out the mathematical theory and methods here.]</p>
<div id="exploratory" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Exploratory</h3>
<p>Before fitting our model, we explored the relationships between our variables of interest using <a href="https://www.r-bloggers.com/association-rule-learning-and-the-apriori-algorithm/">Association Rule Learning</a>. We will use the R package called <code>arulesViz</code> to help us visualize this because we have mostly categorical variables with too many levels for simple correlation matrices to handle.</p>
<p>Here, each “transaction” is a practitioner who adapted EHR as part of the Medicare EHR Incentive Program in the U.S.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;arulesViz&quot;</span>)</code></pre></div>
<pre><code>## Loading required package: arules</code></pre>
<pre><code>## 
## Attaching package: &#39;arules&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:car&#39;:
## 
##     recode</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     recode</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     abbreviate, write</code></pre>
<pre><code>## Loading required package: grid</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># first need to keep certain associational variables of interest and discretize them</span>
corr &lt;-<span class="st"> </span>EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(med_sch <span class="op">!=</span><span class="st"> &quot;OTHER&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(gndr, grd_yr, pri_spec, st) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">grd_yr =</span> <span class="kw">as.factor</span>(grd_yr),
         <span class="dt">st =</span> <span class="kw">as.factor</span>(st))

<span class="co"># convert from a data frame to a transaction dataset</span>
corrt &lt;-<span class="st"> </span><span class="kw">as</span>(corr, <span class="st">&quot;transactions&quot;</span>)

<span class="co"># create rules using the apriori</span>
rules &lt;-<span class="st"> </span><span class="kw">apriori</span>(corrt, <span class="dt">parameter=</span><span class="kw">list</span>(<span class="dt">support=</span><span class="fl">0.01</span>, <span class="dt">confidence=</span><span class="fl">0.5</span>))</code></pre></div>
<pre><code>## Apriori
## 
## Parameter specification:
##  confidence minval smax arem  aval originalSupport maxtime support minlen
##         0.5    0.1    1 none FALSE            TRUE       5    0.01      1
##  maxlen target   ext
##      10  rules FALSE
## 
## Algorithmic control:
##  filter tree heap memopt load sort verbose
##     0.1 TRUE TRUE  FALSE TRUE    2    TRUE
## 
## Absolute minimum support count: 4 
## 
## set item appearances ...[0 item(s)] done [0.00s].
## set transactions ...[145 item(s), 468 transaction(s)] done [0.00s].
## sorting and recoding items ... [70 item(s)] done [0.00s].
## creating transaction tree ... done [0.00s].
## checking subsets of size 1 2 3 done [0.00s].
## writing ... [85 rule(s)] done [0.00s].
## creating S4 object  ... done [0.00s].</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(rules)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>The result is a a set of ______________ association rules with generally high confidence and low support (proportion of transactions in the data set which contain the item set). Let’s first trim this down a bit to show only important rules (confidence &gt; 0.85). We’ll pick the top 30 rules so we have a smaller subset to find meaningful relationships.</p>
<p>The top 30 rules are chosen with respect to the lift measure (a measure of rule strength) - the deviation of the support of the whole rule from the support expected under independence given the supports of both sides of the rule.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subrules &lt;-<span class="st"> </span>rules[<span class="kw">quality</span>(rules)<span class="op">$</span>confidence <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.85</span>]
<span class="kw">inspect</span>(<span class="kw">head</span>(<span class="kw">sort</span>(subrules, <span class="dt">by =</span><span class="st">&quot;lift&quot;</span>),<span class="dv">30</span>))</code></pre></div>
<pre><code>##     lhs                                rhs         support confidence     lift count
## [1] {st=OK}                         =&gt; {gndr=M} 0.01068376  1.0000000 2.197183     5
## [2] {grd_yr=2012,                                                                   
##      pri_spec=CHIROPRACTIC}         =&gt; {gndr=M} 0.01282051  1.0000000 2.197183     6
## [3] {pri_spec=DIAGNOSTIC RADIOLOGY} =&gt; {gndr=M} 0.01282051  0.8571429 1.883300     6
## [4] {grd_yr=2007,                                                                   
##      pri_spec=OPTOMETRY}            =&gt; {gndr=M} 0.01282051  0.8571429 1.883300     6
## [5] {grd_yr=2007,                                                                   
##      pri_spec=NURSE PRACTITIONER}   =&gt; {gndr=F} 0.01068376  1.0000000 1.835294     5
## [6] {pri_spec=NURSE PRACTITIONER}   =&gt; {gndr=F} 0.05555556  0.9629630 1.767320    26
## [7] {pri_spec=PEDIATRIC MEDICINE}   =&gt; {gndr=F} 0.01709402  0.8888889 1.631373     8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(subrules, <span class="dt">method=</span><span class="st">&quot;grouped&quot;</span>, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">k=</span><span class="dv">50</span>))</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>We concluded the following:</p>
<ul>
<li>Practitioner graduation year is not very interesting</li>
<li>Medical School, Primary Specialty, and Gender had the most meaningful associations
<ul>
<li>However, we would choose only one of medical school or primary specialty. They are likely highly correlated because there are specialty-specific schools such as chiropractic schools.</li>
</ul></li>
</ul>
<p>Now we need to explore the relationships of our continuous independent variables</p>
<ol style="list-style-type: decimal">
<li>Years since graduation by gender using jittered violin plots</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">melt</span>(<span class="dt">id.vars=</span><span class="st">&quot;gndr&quot;</span>, <span class="dt">measure.vars=</span><span class="st">&quot;yrs_grd&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(gndr, value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">alpha =</span> <span class="fl">0.75</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(variable <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_sqrt</span>()</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Gender seems to be pretty independent of the number of years since graduation so we should be able to add both to the model without influencing each other’s effects. The distribution of years since graduation is skewed, so we used a square root scale to make the kernel density curves look more symmetric in the plots than it otherwise would have been. The actual values of the years since graduation were left alone so we could intuitively interpret the results from our model.</p>
<ol start="2" style="list-style-type: decimal">
<li>Number of locations by gender using jittered violin plots</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">melt</span>(<span class="dt">id.vars=</span><span class="st">&quot;gndr&quot;</span>, <span class="dt">measure.vars=</span><span class="st">&quot;locations&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(gndr, value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">alpha =</span> <span class="fl">0.75</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(variable <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>While practice locations seem to be distributed evenly between males and females, note that the large majority of physicians in our data set have only one location. There are a few outliers who have over 300 unique zip codes associated with their practices.</p>
<ol start="3" style="list-style-type: decimal">
<li>Years since graduation by credentials using bubble plots</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">cred =</span> <span class="kw">reorder</span>(cred, yrs_grd)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(cred, yrs_grd)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_sum</span>(<span class="kw">aes</span>(<span class="dt">size =</span> ..n.., <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_size_area</span>(<span class="dt">max_size =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Credentials (physician degrees) had one of the fewest number of levels, so we wanted to see if it was a good candidate for our model. The distribution of years since graduation looked pretty consistent across different credentials. Unfortunately, there were disproportionally high numbers of physicians with credentials listed as N/A (~75%), meaning their credential was unknown, so we could not use this variable in our model.</p>
<ol start="4" style="list-style-type: decimal">
<li>Gender, years since graduation, and number of locations by EHR use</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># scatter plot matrix of all three effects by EHR use</span>
my_colors &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="kw">nlevels</span>(<span class="kw">as.factor</span>(EPs<span class="op">$</span>ehr)), <span class="st">&quot;Set1&quot;</span>)</code></pre></div>
<pre><code>## Warning in brewer.pal(nlevels(as.factor(EPs$ehr)), &quot;Set1&quot;): minimal value for n is 3, returning requested palette with 3 different levels</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">gender =</span> <span class="kw">as.factor</span>(<span class="kw">as.integer</span>(gndr))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scatterplotMatrix</span>(<span class="op">~</span>gender<span class="op">+</span>yrs_grd<span class="op">+</span>locations<span class="op">|</span>ehr, <span class="dt">data=</span>., 
                    <span class="dt">col=</span>my_colors, <span class="dt">smoother.args=</span><span class="kw">list</span>(<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>), 
                    <span class="dt">cex=</span><span class="fl">1.5</span> , <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">15</span>,<span class="dv">16</span>), <span class="dt">legend.plot=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># bubble plot of years since graduation by EHR use</span>
EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(ehr, yrs_grd)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_sum</span>(<span class="kw">aes</span>(<span class="dt">size =</span> ..n.., <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_size_area</span>(<span class="dt">max_size =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-22-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># jittered violin plot of years since graduation by EHR use</span>
EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">melt</span>(<span class="dt">id.vars=</span><span class="st">&quot;ehr&quot;</span>, <span class="dt">measure.vars=</span><span class="st">&quot;yrs_grd&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(ehr, value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">alpha =</span> <span class="fl">0.75</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(variable <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_sqrt</span>()</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-22-3.png" width="672" /></p>
<ul>
<li>Note that we forced gender, which is binary, into the scatter plot matrix so just ignore any noise between the values 1 and 2 on the scale for gender.</li>
<li>From the this scatter plot matrix, it is apparent that the distribution of gender and years since graduation differ by EHR use (as indicated by the red and blue colors, blinded here because we want to give you some suspense dun dun dun - but actually, we just couldn’t get the legend to not completely cover the density curves).</li>
<li>A general observation from the bubble and violin plots is that there are proportionally more physicians in our data who have not used EHR. so we already have an imbalance in sample size between the two groups. But overall, our sample size is still large enough.</li>
</ul>
</div>
<div id="final-analysis" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Final Analysis</h3>
<div id="fit-the-logistic-model" class="section level4">
<h4><span class="header-section-number">5.1.2.1</span> Fit the Logistic Model</h4>
<p>[write out our final model]</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># fit the model</span>
model &lt;-<span class="st"> </span><span class="kw">glm</span>(ehr <span class="op">~</span><span class="st"> </span>gndr <span class="op">+</span><span class="st"> </span>yrs_grd <span class="op">+</span><span class="st"> </span>locations, <span class="dt">data =</span> EPs, <span class="dt">family =</span> binomial)
<span class="kw">summary</span>(model)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ehr ~ gndr + yrs_grd + locations, family = binomial, 
##     data = EPs)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.5328  -0.3522  -0.2465  -0.2338   2.7075  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -3.66972    0.23914 -15.345  &lt; 2e-16 ***
## gndrM        0.85466    0.24895   3.433 0.000597 ***
## yrs_grd      0.01783    0.01031   1.730 0.083652 .  
## locations    0.01255    0.08678   0.145 0.885043    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 575.08  on 1600  degrees of freedom
## Residual deviance: 558.65  on 1597  degrees of freedom
## AIC: 566.65
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#table of odds ratios with 95% CI</span>
<span class="kw">exp</span>(<span class="kw">cbind</span>(<span class="dt">OR =</span> <span class="kw">coef</span>(model), <span class="kw">confint</span>(model)))</code></pre></div>
<pre><code>## Waiting for profiling to be done...</code></pre>
<pre><code>##                     OR      2.5 %     97.5 %
## (Intercept) 0.02548362 0.01585523 0.04123045
## gndrM       2.35056990 1.44398896 3.84687839
## yrs_grd     1.01798938 0.99676093 1.03804917
## locations   1.01262573 0.79323722 1.15495640</code></pre>
<p>[copy the interpretation from katherine’s website]</p>
<p>We did not find a statistically significant effect in the number of practice locations on the use of EHR, so this makes me feel better about collapsing the records by unique physicians and losing the specific location information like city, state, and zip code. If owning practices in various different locations had an effect on EHR use, then we would have needed to consider fitting a mixed effects model that takes into account the random effects of the different locations these physicians practice in, or consider a repeated measures analysis on the non-collapsed data where a physician can have repeated records for each unique location of their practice, etc. But since we lack statistical evidence for the number of practice locations to show an effect on EHR use, we have no reason to seek a better model to fit.</p>
</div>
<div id="predicted-probabilities" class="section level4">
<h4><span class="header-section-number">5.1.2.2</span> Predicted Probabilities</h4>
<p>We can look at the effects of varying years since graduation by gender while holding the number of practice locations constant at its sample mean on the outcome of EHR use with a ribbon plot of the predicted probabilities.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create a table of predicted probabilities varying the value of years since graduation and gender</span>
varyvals &lt;-<span class="st"> </span><span class="kw">with</span>(EPs, <span class="kw">data.frame</span>(<span class="dt">yrs_grd =</span> <span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">min</span>(yrs_grd), <span class="dt">to =</span> <span class="kw">max</span>(yrs_grd), <span class="dt">length.out =</span> <span class="dv">100</span>),
    <span class="dv">2</span>), <span class="dt">locations =</span> <span class="kw">mean</span>(locations), <span class="dt">gndr =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&#39;M&#39;</span>,<span class="st">&#39;F&#39;</span>), <span class="dt">each =</span> <span class="dv">100</span>))))
pred &lt;-<span class="st"> </span><span class="kw">cbind</span>(varyvals, <span class="kw">predict</span>(model, <span class="dt">newdata =</span> varyvals, <span class="dt">type =</span> <span class="st">&quot;link&quot;</span>,
    <span class="dt">se =</span> <span class="ot">TRUE</span>))
pred &lt;-<span class="st"> </span><span class="kw">within</span>(pred, {
    PredictedProb &lt;-<span class="st"> </span><span class="kw">plogis</span>(fit)
    LL &lt;-<span class="st"> </span><span class="kw">plogis</span>(fit <span class="op">-</span><span class="st"> </span>(<span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.fit))
    UL &lt;-<span class="st"> </span><span class="kw">plogis</span>(fit <span class="op">+</span><span class="st"> </span>(<span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.fit))
})

<span class="co"># ribbon plot</span>
<span class="kw">ggplot</span>(pred, <span class="kw">aes</span>(<span class="dt">x =</span> yrs_grd, <span class="dt">y =</span> PredictedProb)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> LL, <span class="dt">ymax =</span> UL, <span class="dt">fill =</span> gndr), <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> gndr), <span class="dt">size =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Well, how well does the model with these predictors fit compared to a null model? Let’s perform the likelihood ratio test using a chi-square test of <code>{r} with(model, null.deviance - deviance)</code> (the difference in deviance for the two models) with <code>{r} with(model, df.null - df.residual)</code> degrees of freedom on our observed data, which gives us the following p-value:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(model, <span class="kw">pchisq</span>(null.deviance <span class="op">-</span><span class="st"> </span>deviance, df.null <span class="op">-</span><span class="st"> </span>df.residual, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>))</code></pre></div>
<pre><code>## [1] 0.0009280001</code></pre>
<p>Looks like our model did pretty well!</p>
</div>
</div>
</div>
<div id="hospital-demographics" class="section level2">
<h2><span class="header-section-number">5.2</span> Hospital Demographics</h2>
<div id="exploratory-1" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Exploratory</h3>
<ul>
<li>Describe the analysis population</li>
<li>outline a model we want to fit, talk some math</li>
<li>what are our aims?</li>
<li>correlations</li>
</ul>
</div>
<div id="final-analysis-1" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Final Analysis</h3>
<ul>
<li>state our final model based on correlation results</li>
<li>Run the model</li>
<li>describe the results</li>
<li>Conclusion/discussion</li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="secondary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/euniceyeh/EHR-Project/edit/master/04-Primary.Rmd",
"text": "Edit"
},
"download": ["EHR-Project.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
