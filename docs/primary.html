<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Electronic Health Records: Who Uses It?</title>
  <meta name="description" content="This is the final project report for BST 260 on the relationships between the use of Electronic Health Records (EHR) and provider demographics, separately among the eligible professionals (EPs) and eligible hospitals participating in the Medicare &amp; Medicaid EHR Incentive Program in 2016.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Electronic Health Records: Who Uses It?" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the final project report for BST 260 on the relationships between the use of Electronic Health Records (EHR) and provider demographics, separately among the eligible professionals (EPs) and eligible hospitals participating in the Medicare &amp; Medicaid EHR Incentive Program in 2016." />
  <meta name="github-repo" content="euniceyeh/EHR-Project" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Electronic Health Records: Who Uses It?" />
  
  <meta name="twitter:description" content="This is the final project report for BST 260 on the relationships between the use of Electronic Health Records (EHR) and provider demographics, separately among the eligible professionals (EPs) and eligible hospitals participating in the Medicare &amp; Medicaid EHR Incentive Program in 2016." />
  

<meta name="author" content="Eunice Yeh, Lauren Yoo, Katherine Wang">


<meta name="date" content="2017-12-11">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="data.html">
<link rel="next" href="secondary.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">BST 260 Final Project: EHR</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview and Motivation</a></li>
<li class="chapter" data-level="2" data-path="work.html"><a href="work.html"><i class="fa fa-check"></i><b>2</b> Related Work</a></li>
<li class="chapter" data-level="3" data-path="questions.html"><a href="questions.html"><i class="fa fa-check"></i><b>3</b> Initial Questions</a></li>
<li class="chapter" data-level="4" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>4</b> Data</a><ul>
<li class="chapter" data-level="4.1" data-path="data.html"><a href="data.html#eligible-professionals-eps"><i class="fa fa-check"></i><b>4.1</b> Eligible Professionals (EPs)</a><ul>
<li class="chapter" data-level="4.1.1" data-path="data.html"><a href="data.html#sourcemetadata"><i class="fa fa-check"></i><b>4.1.1</b> Source/Metadata</a></li>
<li class="chapter" data-level="4.1.2" data-path="data.html"><a href="data.html#wrangling"><i class="fa fa-check"></i><b>4.1.2</b> Wrangling</a></li>
<li class="chapter" data-level="4.1.3" data-path="data.html"><a href="data.html#output"><i class="fa fa-check"></i><b>4.1.3</b> Output</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="data.html"><a href="data.html#eligible-hospitals-hosp"><i class="fa fa-check"></i><b>4.2</b> Eligible Hospitals (Hosp)</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data.html"><a href="data.html#sourcemetadata-1"><i class="fa fa-check"></i><b>4.2.1</b> Source/Metadata</a></li>
<li class="chapter" data-level="4.2.2" data-path="data.html"><a href="data.html#wrangling-1"><i class="fa fa-check"></i><b>4.2.2</b> Wrangling</a></li>
<li class="chapter" data-level="4.2.3" data-path="data.html"><a href="data.html#output-1"><i class="fa fa-check"></i><b>4.2.3</b> Output</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data.html"><a href="data.html#vendors-products-ehr"><i class="fa fa-check"></i><b>4.3</b> Vendors &amp; Products (EHR)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data.html"><a href="data.html#sourcemetadata-2"><i class="fa fa-check"></i><b>4.3.1</b> Source/Metadata</a></li>
<li class="chapter" data-level="4.3.2" data-path="data.html"><a href="data.html#wrangling-2"><i class="fa fa-check"></i><b>4.3.2</b> Wrangling</a></li>
<li class="chapter" data-level="4.3.3" data-path="data.html"><a href="data.html#output-2"><i class="fa fa-check"></i><b>4.3.3</b> Output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="primary.html"><a href="primary.html"><i class="fa fa-check"></i><b>5</b> Primary Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="primary.html"><a href="primary.html#physician-demographics"><i class="fa fa-check"></i><b>5.1</b> Physician Demographics</a><ul>
<li class="chapter" data-level="5.1.1" data-path="primary.html"><a href="primary.html#exploratory"><i class="fa fa-check"></i><b>5.1.1</b> Exploratory</a></li>
<li class="chapter" data-level="5.1.2" data-path="primary.html"><a href="primary.html#final-analysis"><i class="fa fa-check"></i><b>5.1.2</b> Final Analysis</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="primary.html"><a href="primary.html#hospital-demographics"><i class="fa fa-check"></i><b>5.2</b> Hospital Demographics</a><ul>
<li class="chapter" data-level="5.2.1" data-path="primary.html"><a href="primary.html#exploratory-analysis"><i class="fa fa-check"></i><b>5.2.1</b> Exploratory Analysis</a></li>
<li class="chapter" data-level="5.2.2" data-path="primary.html"><a href="primary.html#final-analysis-1"><i class="fa fa-check"></i><b>5.2.2</b> Final Analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="secondary.html"><a href="secondary.html"><i class="fa fa-check"></i><b>6</b> Secondary Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="secondary.html"><a href="secondary.html#by-geographical-regions"><i class="fa fa-check"></i><b>6.1</b> By Geographical Regions</a><ul>
<li class="chapter" data-level="6.1.1" data-path="secondary.html"><a href="secondary.html#physician-demographics-1"><i class="fa fa-check"></i><b>6.1.1</b> Physician Demographics</a></li>
<li class="chapter" data-level="6.1.2" data-path="secondary.html"><a href="secondary.html#hospital-demographics-1"><i class="fa fa-check"></i><b>6.1.2</b> Hospital Demographics</a></li>
<li class="chapter" data-level="6.1.3" data-path="secondary.html"><a href="secondary.html#regional-conclusions"><i class="fa fa-check"></i><b>6.1.3</b> Regional Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="secondary.html"><a href="secondary.html#by-ehr-vendors"><i class="fa fa-check"></i><b>6.2</b> By EHR Vendors</a><ul>
<li class="chapter" data-level="6.2.1" data-path="secondary.html"><a href="secondary.html#physician-demographics-2"><i class="fa fa-check"></i><b>6.2.1</b> Physician Demographics</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://katwang.github.io/BST-260-Final-Project-Site" target="blank">Our Project Website</a></li>
<li><a href="https://github.com/euniceyeh/EHR-Project" target="blank">Our Github Repo</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Electronic Health Records: Who Uses It?</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="primary" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Primary Analysis</h1>
<div id="physician-demographics" class="section level2">
<h2><span class="header-section-number">5.1</span> Physician Demographics</h2>
<p>Since practitioners who are affiliated with a hospital may not have a choice in using EHR or not, we will exclude these from our analysis population, which is now just the practitioners who enrolled in the Medicare Incentive Program who are not affiliated with any hospital, which come from the data set <code>EPs</code> that we cleaned in section <a href="https://euniceyeh.github.io/EHR-Project/data.html#eligible-professionals-eps">4.1</a>.</p>
<p>We will use logistic regression because we have a dichotomous outcome (EHR used: Y/N) and want to explore the relationship between the outcome and other predictor/explanatory variables. The coefficients generated from logistic regression will give us a formula to predict a logit transformation of the probability of the outcome. The general formula will look like this:</p>
<p><span class="math display">\[
ln\left(\frac{p}{1-p}\right) = \beta_0 + \beta_1X_1 + \beta_2X_2 + ....+\beta_kX_k
\]</span></p>
<div id="exploratory" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Exploratory</h3>
<p>Before fitting our model, we explored the relationships between our variables of interest using <a href="https://www.r-bloggers.com/association-rule-learning-and-the-apriori-algorithm/">Association Rule Learning</a>. We will use the R package called <code>arulesViz</code> to help us visualize this because we have mostly categorical variables with too many levels for simple correlation matrices to handle.</p>
<p>Here, each “transaction” is a practitioner who adapted EHR as part of the Medicare EHR Incentive Program in the U.S.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># first need to keep certain associational variables of interest and discretize them</span>
corr &lt;-<span class="st"> </span>EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(med_sch <span class="op">!=</span><span class="st"> &quot;OTHER&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(gndr, grd_yr, pri_spec, st) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">grd_yr =</span> <span class="kw">as.factor</span>(grd_yr),
         <span class="dt">st =</span> <span class="kw">as.factor</span>(st))

<span class="co"># convert from a data frame to a transaction dataset</span>
corrt &lt;-<span class="st"> </span><span class="kw">as</span>(corr, <span class="st">&quot;transactions&quot;</span>)

<span class="co"># create rules using the apriori</span>
rules &lt;-<span class="st"> </span><span class="kw">apriori</span>(corrt, <span class="dt">parameter=</span><span class="kw">list</span>(<span class="dt">support=</span><span class="fl">0.01</span>, <span class="dt">confidence=</span><span class="fl">0.5</span>))</code></pre></div>
<pre><code>## Apriori
## 
## Parameter specification:
##  confidence minval smax arem  aval originalSupport maxtime support minlen
##         0.5    0.1    1 none FALSE            TRUE       5    0.01      1
##  maxlen target   ext
##      10  rules FALSE
## 
## Algorithmic control:
##  filter tree heap memopt load sort verbose
##     0.1 TRUE TRUE  FALSE TRUE    2    TRUE
## 
## Absolute minimum support count: 919 
## 
## set item appearances ...[0 item(s)] done [0.00s].
## set transactions ...[203 item(s), 91966 transaction(s)] done [0.03s].
## sorting and recoding items ... [90 item(s)] done [0.00s].
## creating transaction tree ... done [0.04s].
## checking subsets of size 1 2 3 done [0.00s].
## writing ... [80 rule(s)] done [0.00s].
## creating S4 object  ... done [0.00s].</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(rules)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>The result is a a set of 80 association rules with generally high confidence and low support (proportion of transactions in the data set which contain the item set). Let’s first trim this down a bit to show only important rules (confidence &gt; 0.85). We’ll pick the top 30 rules so we have a smaller subset to find meaningful relationships.</p>
<p>The top 30 rules are chosen with respect to the lift measure (a measure of rule strength) - the deviation of the support of the whole rule from the support expected under independence given the supports of both sides of the rule.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subrules &lt;-<span class="st"> </span>rules[<span class="kw">quality</span>(rules)<span class="op">$</span>confidence <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.85</span>]
<span class="kw">inspect</span>(<span class="kw">head</span>(<span class="kw">sort</span>(subrules, <span class="dt">by =</span><span class="st">&quot;lift&quot;</span>),<span class="dv">30</span>))</code></pre></div>
<pre><code>##     lhs                              rhs      support    confidence
## [1] {pri_spec=NURSE PRACTITIONER} =&gt; {gndr=F} 0.02473740 0.9009901 
## [2] {grd_yr=1976}                 =&gt; {gndr=M} 0.01154775 0.8530120 
##     lift     count
## [1] 2.265309 2275 
## [2] 1.416338 1062</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(subrules, <span class="dt">method=</span><span class="st">&quot;grouped&quot;</span>, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">k=</span><span class="dv">50</span>))</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>We concluded the following:</p>
<ul>
<li>Medical School, Primary Specialty, and Gender had the most meaningful associations
<ul>
<li>However, we would choose only one of medical school or primary specialty. They are likely highly correlated because there are specialty-specific schools such as chiropractic schools.</li>
</ul></li>
</ul>
<p>Now we need to explore the relationships of our continuous independent variables</p>
<ol style="list-style-type: decimal">
<li>Years since graduation by gender using jittered violin plots</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">melt</span>(<span class="dt">id.vars=</span><span class="st">&quot;gndr&quot;</span>, <span class="dt">measure.vars=</span><span class="st">&quot;yrs_grd&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(gndr, value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">alpha =</span> <span class="fl">0.75</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(variable <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_sqrt</span>()</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Gender seems to be pretty independent of the number of years since graduation so we should be able to add both to the model without influencing each other’s effects. The distribution of years since graduation is skewed, so we used a square root scale to make the kernel density curves look more symmetric in the plots than it otherwise would have been. The actual values of the years since graduation were left alone so we could intuitively interpret the results from our model.</p>
<ol start="2" style="list-style-type: decimal">
<li>Number of locations by gender using jittered violin plots</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">melt</span>(<span class="dt">id.vars=</span><span class="st">&quot;gndr&quot;</span>, <span class="dt">measure.vars=</span><span class="st">&quot;locations&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(gndr, value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">alpha =</span> <span class="fl">0.75</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(variable <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>While practice locations seem to be distributed evenly between males and females, note that the large majority of physicians in our data set have only one location. There are a few outliers who have over 300 unique zip codes associated with their practices.</p>
<ol start="3" style="list-style-type: decimal">
<li>Years since graduation by credentials using bubble plots</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">cred =</span> <span class="kw">reorder</span>(cred, yrs_grd)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(cred, yrs_grd)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_sum</span>(<span class="kw">aes</span>(<span class="dt">size =</span> ..n.., <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_size_area</span>(<span class="dt">max_size =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Credentials (physician degrees) had one of the fewest number of levels, so we wanted to see if it was a good candidate for our model. The distribution of years since graduation looked pretty consistent across different credentials. Unfortunately, there were disproportionally high numbers of physicians with credentials listed as N/A (~75%), meaning their credential was unknown, so we could not use this variable in our model.</p>
<ol start="4" style="list-style-type: decimal">
<li>Gender, years since graduation, and number of locations by EHR use</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># scatter plot matrix of all three effects plus EHR use</span>
EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggpairs</span>(<span class="dt">columns =</span> <span class="kw">c</span>(<span class="st">&quot;gndr&quot;</span>, <span class="st">&quot;yrs_grd&quot;</span>, <span class="st">&quot;locations&quot;</span>, <span class="st">&quot;ehr&quot;</span>))</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># bubble plot of years since graduation by EHR use</span>
EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(ehr, yrs_grd)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_sum</span>(<span class="kw">aes</span>(<span class="dt">size =</span> ..n.., <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_size_area</span>(<span class="dt">max_size =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-24-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># jittered violin plot of years since graduation by EHR use</span>
EPs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">melt</span>(<span class="dt">id.vars=</span><span class="st">&quot;ehr&quot;</span>, <span class="dt">measure.vars=</span><span class="st">&quot;yrs_grd&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(ehr, value)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_violin</span>(<span class="dt">alpha =</span> <span class="fl">0.75</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(variable <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_sqrt</span>()</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-24-3.png" width="672" /></p>
<ul>
<li>Again, we can confirm that all three variables of interest (gender, years since graduation, and number of locations) are not strongly correlated with each other at all. We can safely add them into the final model without interaction terms.</li>
<li>From the this scatter plot matrix, it is apparent that the distribution of gender and years since graduation differ by EHR use (as indicated by the red and blue colors, blinded here because we want to give you some suspense dun dun dun - but actually, we just couldn’t get the legend to not completely cover the density curves).</li>
<li>A general observation from the bubble and violin plots is that there are proportionally more physicians in our data who have not used EHR. so we already have an imbalance in sample size between the two groups. But overall, our sample size is still large enough.</li>
</ul>
</div>
<div id="final-analysis" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Final Analysis</h3>
<div id="fit-the-logistic-model" class="section level4">
<h4><span class="header-section-number">5.1.2.1</span> Fit the Logistic Model</h4>
<p>Our final physician-level logistic regression model looked like this: <span class="math display">\[
logit(EHR) = \beta_0 + \beta_1(gender) + \beta_2(years~since~grad) + \beta_3(location)
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># fit the model</span>
model &lt;-<span class="st"> </span><span class="kw">glm</span>(ehr <span class="op">~</span><span class="st"> </span>gndr <span class="op">+</span><span class="st"> </span>yrs_grd <span class="op">+</span><span class="st"> </span>locations, <span class="dt">data =</span> EPs, <span class="dt">family =</span> binomial)
<span class="kw">summary</span>(model)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = ehr ~ gndr + yrs_grd + locations, family = binomial, 
##     data = EPs)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.7116  -0.4564  -0.3538  -0.3037   2.5340  
## 
## Coefficients:
##               Estimate Std. Error  z value Pr(&gt;|z|)    
## (Intercept) -3.1736081  0.0165219 -192.085   &lt;2e-16 ***
## gndrM        0.6964365  0.0165690   42.033   &lt;2e-16 ***
## yrs_grd      0.0166015  0.0005856   28.349   &lt;2e-16 ***
## locations    0.0020854  0.0023454    0.889    0.374    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 128120  on 232754  degrees of freedom
## Residual deviance: 124587  on 232751  degrees of freedom
## AIC: 124595
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#table of odds ratios with 95% CI</span>
(ORtab &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">cbind</span>(<span class="dt">OR =</span> <span class="kw">coef</span>(model), <span class="kw">confint</span>(model))))</code></pre></div>
<pre><code>## Waiting for profiling to be done...</code></pre>
<pre><code>##                     OR      2.5 %     97.5 %
## (Intercept) 0.04185232 0.04051644 0.04322772
## gndrM       2.00658945 1.94253308 2.07289203
## yrs_grd     1.01674007 1.01557342 1.01790742
## locations   1.00208755 0.99665828 1.00611723</code></pre>
<p>Holding years since graduation and locations at a fixed value, the odds of adopting EHR for males is 2.01 the odds of adopting EHR for females. Holding gender (male) and locations at a fixed value, the odds of adopting EHR has a 1.67% increase for each additional year since graduation.</p>
<p>We did not find a statistically significant effect in the number of practice locations on the use of EHR, so this makes me feel better about collapsing the records by unique physicians and losing the specific location information like city, state, and zip code. If owning practices in various different locations had an effect on EHR use, then we would have needed to consider fitting a mixed effects model that takes into account the random effects of the different locations these physicians practice in, or consider a repeated measures analysis on the non-collapsed data where a physician can have repeated records for each unique location of their practice, etc. But since we lack statistical evidence for the number of practice locations to show an effect on EHR use, we have no reason to seek a better model to fit.</p>
</div>
<div id="predicted-probabilities" class="section level4">
<h4><span class="header-section-number">5.1.2.2</span> Predicted Probabilities</h4>
<p>We can look at the effects of varying years since graduation by gender while holding the number of practice locations constant at its sample mean on the outcome of EHR use with a ribbon plot of the predicted probabilities.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create a table of predicted probabilities varying the value of years since graduation and gender</span>
varyvals &lt;-<span class="st"> </span><span class="kw">with</span>(EPs, <span class="kw">data.frame</span>(<span class="dt">yrs_grd =</span> <span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">min</span>(yrs_grd), <span class="dt">to =</span> <span class="kw">max</span>(yrs_grd), <span class="dt">length.out =</span> <span class="dv">100</span>),
    <span class="dv">2</span>), <span class="dt">locations =</span> <span class="kw">mean</span>(locations), <span class="dt">gndr =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&#39;M&#39;</span>,<span class="st">&#39;F&#39;</span>), <span class="dt">each =</span> <span class="dv">100</span>))))
pred &lt;-<span class="st"> </span><span class="kw">cbind</span>(varyvals, <span class="kw">predict</span>(model, <span class="dt">newdata =</span> varyvals, <span class="dt">type =</span> <span class="st">&quot;link&quot;</span>,
    <span class="dt">se =</span> <span class="ot">TRUE</span>))
pred &lt;-<span class="st"> </span><span class="kw">within</span>(pred, {
    PredictedProb &lt;-<span class="st"> </span><span class="kw">plogis</span>(fit)
    LL &lt;-<span class="st"> </span><span class="kw">plogis</span>(fit <span class="op">-</span><span class="st"> </span>(<span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.fit))
    UL &lt;-<span class="st"> </span><span class="kw">plogis</span>(fit <span class="op">+</span><span class="st"> </span>(<span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.fit))
})

<span class="co"># ribbon plot</span>
<span class="kw">ggplot</span>(pred, <span class="kw">aes</span>(<span class="dt">x =</span> yrs_grd, <span class="dt">y =</span> PredictedProb)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> LL, <span class="dt">ymax =</span> UL, <span class="dt">fill =</span> gndr), <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> gndr), <span class="dt">size =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Well, how well does the model with these predictors fit compared to a null model? Let’s perform the likelihood ratio test using a chi-square test of <code>{r} with(model, null.deviance - deviance)</code> (the difference in deviance for the two models) with <code>{r} with(model, df.null - df.residual)</code> degrees of freedom on our observed data, which gives us the following p-value:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(model, <span class="kw">pchisq</span>(null.deviance <span class="op">-</span><span class="st"> </span>deviance, df.null <span class="op">-</span><span class="st"> </span>df.residual, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>))</code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>Looks like our model did pretty well!</p>
</div>
</div>
</div>
<div id="hospital-demographics" class="section level2">
<h2><span class="header-section-number">5.2</span> Hospital Demographics</h2>
<p>Now let’s focus on the other type of providers eligible for the Medicaid &amp; Medicare EHR Incentive Program: the hospitals. Recall that in this analysis population, we included only the physicians who are affiliated with any hospital and aggregated their demographics and EHR use at the hospital level. This is because the use of EHR would no longer depend on the physicians themselves, but rather the hospitals who decide to participate in the program. Since the aggregated physician demographics are not reliable demographic representations of the hospitals, as discussed in the <a href="https://euniceyeh.github.io/EHR-Project/data.html#eligible-hospitals-hosp">Data</a> chapter, we will only perform exploratory analysis on them and focus on the scraped hospital demographics (staffed beds, total discharges, patient days, gross patient revenue) for the final analysis.</p>
<div id="exploratory-analysis" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Exploratory Analysis</h3>
<p><strong>Number of practitioners in hospital</strong> We suspect that if there is less than 10 physicians in our data per hospital, it is not an accurate representation of the hospital. i.e. The 10 practitioners may not accurately represent the entire group of practitioners in the hospital. We thought of excluding the hospitals with less than 10 practitioners in the data, but it would mean removing 108 out of 166 hospitals in the “control group” that does not use EHR.</p>
<p><strong>Therefore, while we will keep the aggregated variables, we should keep in mind that these variables may not be accurate representation of hospital demographics. e.g. Number of practitioners in the dataset may be only ten, while the hospital actually employees 500 practitioners.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#RECODE Using EHR_use==1 -&gt; Y, 0 -&gt; &quot;&quot;</span>
hosps<span class="op">$</span>EHR_char &lt;-<span class="st"> </span><span class="kw">ifelse</span>(hosps<span class="op">$</span>EHR_use <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;Blank&quot;</span>)
<span class="co">#RECODE Years since medical school graduation</span>
hosps<span class="op">$</span>yrs_since_grad =<span class="st"> </span><span class="dv">2017</span> <span class="op">-</span><span class="st"> </span>hosps<span class="op">$</span>avg_grad_year


<span class="kw">table</span>(hosps<span class="op">$</span>EHR_use)</code></pre></div>
<pre><code>## 
##    1    0 
## 1701  156</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">less10ind &lt;-<span class="st"> </span><span class="kw">which</span>(hosps<span class="op">$</span>num_phys <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>)
<span class="kw">table</span>(hosps[less10ind,]<span class="op">$</span>EHR_use)</code></pre></div>
<pre><code>## 
##   1   0 
##  52 114</code></pre>
<div id="box-plots" class="section level4">
<h4><span class="header-section-number">5.2.1.1</span> Box plots</h4>
<p>Each box plot shows an independent variable’s distribution grouped by electronic use or not.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(Staffed_beds<span class="op">~</span>EHR_use,<span class="dt">data=</span>hosps,
        <span class="dt">xlab=</span><span class="st">&quot;EHR Use&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Staffed_beds&quot;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>))</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(Total_discharges<span class="op">~</span>EHR_use,<span class="dt">data=</span>hosps,
        <span class="dt">xlab=</span><span class="st">&quot;EHR Use&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Total discharge&quot;</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-29-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(Patient_days<span class="op">~</span>EHR_use,<span class="dt">data=</span>hosps,
        <span class="dt">xlab=</span><span class="st">&quot;EHR Use&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Patient days&quot;</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-29-3.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(Gross_patient_revenue<span class="op">~</span>EHR_use,<span class="dt">data=</span>hosps,
        <span class="dt">xlab=</span><span class="st">&quot;EHR Use&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Yearly gross patient revenue&quot;</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-29-4.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(num_phys<span class="op">~</span>EHR_use ,<span class="dt">data=</span>hosps,
        <span class="dt">xlab=</span><span class="st">&quot;EHR Use&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Number of Practitioners&quot;</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-29-5.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(female_prop<span class="op">~</span>EHR_use ,<span class="dt">data=</span>hosps,
        <span class="dt">xlab=</span><span class="st">&quot;EHR Use&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Proportion of Female&quot;</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-29-6.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(yrs_since_grad<span class="op">~</span>EHR_use ,<span class="dt">data=</span>hosps,
        <span class="dt">xlab=</span><span class="st">&quot;EHR Use&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Years since graduation&quot;</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-29-7.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(n_specialty<span class="op">~</span>EHR_use ,<span class="dt">data=</span>hosps,
        <span class="dt">xlab=</span><span class="st">&quot;EHR Use&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Number of specialties&quot;</span>)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-29-8.png" width="672" /></p>
</div>
<div id="correlations-among-variables" class="section level4">
<h4><span class="header-section-number">5.2.1.2</span> Correlations among variables</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Correlation Matrix</span>
my_colors &lt;-<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="kw">nlevels</span>(<span class="kw">as.factor</span>(hosps<span class="op">$</span>EHR_use)), <span class="st">&quot;Set1&quot;</span>)</code></pre></div>
<pre><code>## Warning in brewer.pal(nlevels(as.factor(hosps$EHR_use)), &quot;Set1&quot;): minimal value for n is 3, returning requested palette with 3 different levels</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">scatterplotMatrix</span>(<span class="op">~</span>num_phys<span class="op">+</span>female_prop<span class="op">+</span>Staffed_beds<span class="op">+</span>Total_discharges<span class="op">+</span>Patient_days<span class="op">+</span>Gross_patient_revenue<span class="op">|</span>EHR_use, <span class="dt">data=</span>hosps, <span class="dt">col=</span>my_colors , <span class="dt">smoother.args=</span><span class="kw">list</span>(<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>) , <span class="dt">cex=</span><span class="fl">1.5</span> , <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">15</span>,<span class="dv">16</span>))</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
</div>
<div id="normality-check" class="section level4">
<h4><span class="header-section-number">5.2.1.3</span> Normality Check</h4>
<p>We notice that many of the predictor variables are not normally distributed in the above scatter plot. We logged the predictor variables that are skewed to be normally distributed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Variables that are not normally distributed are logged: num_phys, staffed_bed, Gross_patient_revenue</span>
hosps<span class="op">$</span>num_phys_log &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">log</span>(hosps<span class="op">$</span>num_phys),<span class="dv">2</span>)
hosps<span class="op">$</span>staffed_beds_log &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">log</span>(hosps<span class="op">$</span>Staffed_beds),<span class="dv">2</span>)
hosps<span class="op">$</span>gross_patient_rev_log &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">log</span>(hosps<span class="op">$</span>Gross_patient_revenue),<span class="dv">2</span>)
hosps<span class="op">$</span>total_discharge_log &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">log</span>(hosps<span class="op">$</span>Total_discharges),<span class="dv">2</span>)
hosps<span class="op">$</span>patient_days_log&lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">log</span>(hosps<span class="op">$</span>Patient_days),<span class="dv">2</span>)

<span class="co">#Check for normality after logging</span>
<span class="kw">qqnorm</span>(hosps<span class="op">$</span>num_phys_log)
<span class="kw">qqline</span>(hosps<span class="op">$</span>num_phys_log)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqnorm</span>(hosps<span class="op">$</span>staffed_beds_log)
<span class="kw">qqline</span>(hosps<span class="op">$</span>staffed_beds_log)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-31-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqnorm</span>(hosps<span class="op">$</span>gross_patient_rev_log)
<span class="kw">qqline</span>(hosps<span class="op">$</span>gross_patient_rev_log)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-31-3.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqnorm</span>(hosps<span class="op">$</span>total_discharge_log)
<span class="kw">qqline</span>(hosps<span class="op">$</span>total_discharge_log)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-31-4.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqnorm</span>(hosps<span class="op">$</span>patient_days_log)
<span class="kw">qqline</span>(hosps<span class="op">$</span>patient_days_log)</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-31-5.png" width="672" /></p>
<p>From observing qq-plots after taking log on the variables, we get much closer to normality for each variables. Now note some of correlations. Now let’s look at the correlation matrix again with the normalized variables.</p>
<p><strong>[General trends noticeable from the correlation matrix.]</strong> <em>Years since graduation is relevant only to MD, so it is not applicable to all practitioners </em>Female proportion is not associated with any other variables <em>EHR seems most heavily correlated (correlation coefficients over 0.7) with num_phys, n_specialty, staffed_bed, and gross patient revenue. </em>Potential confounding Factors: We can see that all four variables have positive correlation with each other. IN particular, total discharge has very strong positive association with patient days (coef = 0.99)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Correlation Matrix with logged variables</span>
<span class="co">#Final table</span>
<span class="kw">scatterplotMatrix</span>(<span class="op">~</span>staffed_beds_log<span class="op">+</span>total_discharge_log <span class="op">+</span><span class="st"> </span>patient_days_log
<span class="op">+</span>gross_patient_rev_log<span class="op">|</span>EHR_use, <span class="dt">data=</span>hosps, <span class="dt">col=</span>my_colors , <span class="dt">smoother.args=</span><span class="kw">list</span>(<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>) , <span class="dt">cex=</span><span class="fl">1.5</span> , <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">15</span>,<span class="dv">16</span>))</code></pre></div>
<p><img src="EHR-Project_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hosps_cor3 &lt;-<span class="st"> </span>hosps <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">EHR_use =</span> <span class="kw">ifelse</span>(EHR_use<span class="op">==</span><span class="st">&#39;1&#39;</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(staffed_beds_log, total_discharge_log, patient_days_log, gross_patient_rev_log)
<span class="kw">tidy</span>(<span class="kw">round</span>(<span class="kw">cor</span>(hosps_cor3, <span class="dt">use =</span> <span class="st">&quot;complete.obs&quot;</span>), <span class="dv">2</span>))</code></pre></div>
<pre><code>##               .rownames staffed_beds_log total_discharge_log
## 1      staffed_beds_log             1.00                0.86
## 2   total_discharge_log             0.86                1.00
## 3      patient_days_log             0.88                0.99
## 4 gross_patient_rev_log             0.81                0.91
##   patient_days_log gross_patient_rev_log
## 1             0.88                  0.81
## 2             0.99                  0.91
## 3             1.00                  0.90
## 4             0.90                  1.00</code></pre>
<p>The difference in distributions is not as apparent by the use of EHR. We believed that the gross patient revenue, which may be implying overall hospital size, is a confounding factor that affects other predictor variables. We can also observe this in the strong correlation (above 0.8) between GPR and staffed beds, GPR and total discharge, and GPR and patient days. Thus, we will stratify on gross patient revenue. Let’s see if other predictor variables still have effect on EHR use proportion after stratifying on GPR.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hosps<span class="op">$</span>gpr_grp =<span class="st"> </span><span class="kw">cut</span>(hosps<span class="op">$</span>gross_patient_rev_log, 
                    <span class="kw">quantile</span>(hosps<span class="op">$</span>gross_patient_rev_log, <span class="dt">prob =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">2</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>)
filter_var =<span class="st"> &quot;total_discharge_log&quot;</span> <span class="co">#&quot;staffed_beds_log&quot; #&quot;patient_days_log&quot;</span>
hosps <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(gpr_grp)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(gpr_grp) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">glm</span>(EHR_use <span class="op">~</span><span class="st"> </span>staffed_beds_log <span class="op">+</span><span class="st"> </span>total_discharge_log <span class="op">+</span><span class="st"> </span>patient_days_log, 
                <span class="dt">data =</span> ., <span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>), <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(term<span class="op">==</span>filter_var)</code></pre></div>
<pre><code>## # A tibble: 5 x 8
## # Groups:   gpr_grp [5]
##       gpr_grp                term  estimate std.error  statistic
##        &lt;fctr&gt;               &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1  [8.2,11.9] total_discharge_log -1.967436  0.491234 -4.0050898
## 2 (11.9,12.7] total_discharge_log -4.927093  1.449333 -3.3995581
## 3 (12.7,13.4] total_discharge_log -4.829553  2.695692 -1.7915816
## 4 (13.4,14.1] total_discharge_log -2.275644  1.916510 -1.1873892
## 5 (14.1,16.5] total_discharge_log -1.453429  1.998146 -0.7273889
## # ... with 3 more variables: p.value &lt;dbl&gt;, conf.low &lt;dbl&gt;,
## #   conf.high &lt;dbl&gt;</code></pre>
<p>We are only showing the statistical results on total discharge because it is the only demographic that has a different significance in effect on EHR use across the stratification of gross patient revenue, as evident by the p-values. So in our final model, we will use total discharge and gross patient revenue and their interaction term.</p>
</div>
</div>
<div id="final-analysis-1" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Final Analysis</h3>
<p>We are just running the models below to show you our process of choosing the best fitting model, by splitting our data into training and test sets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Train &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(hosps<span class="op">$</span>EHR_use, <span class="dt">p=</span><span class="fl">0.6</span>, <span class="dt">list=</span><span class="ot">FALSE</span>)
training &lt;-<span class="st"> </span>hosps[Train, ]
testing &lt;-<span class="st"> </span>hosps[<span class="op">-</span>Train, ]

<span class="co"># first model with all hosptial demographics</span>
glm1 &lt;-<span class="st"> </span><span class="kw">glm</span>(EHR_use <span class="op">~</span><span class="st"> </span>gross_patient_rev_log <span class="op">+</span><span class="st"> </span>staffed_beds_log <span class="op">+</span><span class="st"> </span>total_discharge_log <span class="op">+</span><span class="st"> </span>patient_days_log <span class="op">+</span>staffed_beds_log<span class="op">:</span>gross_patient_rev_log <span class="op">+</span><span class="st"> </span>total_discharge_log<span class="op">:</span>patient_days_log, <span class="dt">data=</span>training, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)
<span class="kw">summary</span>(glm1)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = EHR_use ~ gross_patient_rev_log + staffed_beds_log + 
##     total_discharge_log + patient_days_log + staffed_beds_log:gross_patient_rev_log + 
##     total_discharge_log:patient_days_log, family = &quot;binomial&quot;, 
##     data = training)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0305  -0.3535  -0.2603  -0.2060   2.9414  
## 
## Coefficients:
##                                        Estimate Std. Error z value
## (Intercept)                            24.29327    5.39258   4.505
## gross_patient_rev_log                  -2.30611    0.49088  -4.698
## staffed_beds_log                       -4.75227    1.36357  -3.485
## total_discharge_log                    -2.61047    0.69616  -3.750
## patient_days_log                        2.73517    0.69808   3.918
## gross_patient_rev_log:staffed_beds_log  0.40783    0.10677   3.820
## total_discharge_log:patient_days_log   -0.06185    0.04895  -1.264
##                                        Pr(&gt;|z|)    
## (Intercept)                            6.64e-06 ***
## gross_patient_rev_log                  2.63e-06 ***
## staffed_beds_log                       0.000492 ***
## total_discharge_log                    0.000177 ***
## patient_days_log                       8.92e-05 ***
## gross_patient_rev_log:staffed_beds_log 0.000134 ***
## total_discharge_log:patient_days_log   0.206382    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 624.20  on 1106  degrees of freedom
## Residual deviance: 484.11  on 1100  degrees of freedom
##   (8 observations deleted due to missingness)
## AIC: 498.11
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_hat_logit &lt;-<span class="st"> </span><span class="kw">predict</span>(glm1, <span class="dt">newdata =</span> testing, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)
y_hat_logit &lt;-<span class="st"> </span><span class="kw">ifelse</span>(p_hat_logit <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="dv">1</span>,  <span class="dv">0</span>)
<span class="kw">confusionMatrix</span>(<span class="dt">data =</span> y_hat_logit, <span class="dt">reference =</span> testing<span class="op">$</span>EHR_use)</code></pre></div>
<pre><code>## Warning in confusionMatrix.default(data = y_hat_logit, reference = testing
## $EHR_use): Levels are not in the same order for reference and data.
## Refactoring data to match.</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction   1   0
##          1  16  19
##          0 662  43
##                                           
##                Accuracy : 0.0797          
##                  95% CI : (0.0612, 0.1016)
##     No Information Rate : 0.9162          
##     P-Value [Acc &gt; NIR] : 1               
##                                           
##                   Kappa : -0.0495         
##  Mcnemar&#39;s Test P-Value : &lt;2e-16          
##                                           
##             Sensitivity : 0.02360         
##             Specificity : 0.69355         
##          Pos Pred Value : 0.45714         
##          Neg Pred Value : 0.06099         
##              Prevalence : 0.91622         
##          Detection Rate : 0.02162         
##    Detection Prevalence : 0.04730         
##       Balanced Accuracy : 0.35857         
##                                           
##        &#39;Positive&#39; Class : 1               
## </code></pre>
<p>Because total discharge and patient days have very high correlation (0.99), pick out one out of the two - total discharge. Also, because we observed from correlation plots that staffed beds and the gross patient revenue are highly correlated, we add interaction variable to the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">glm2 &lt;-<span class="st"> </span><span class="kw">glm</span>(EHR_use <span class="op">~</span><span class="st"> </span>gross_patient_rev_log <span class="op">+</span><span class="st"> </span>staffed_beds_log  <span class="op">+</span><span class="st"> </span>gross_patient_rev_log<span class="op">*</span>staffed_beds_log <span class="op">+</span><span class="st"> </span>total_discharge_log, <span class="dt">data=</span>training, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)
<span class="kw">summary</span>(glm2)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = EHR_use ~ gross_patient_rev_log + staffed_beds_log + 
##     gross_patient_rev_log * staffed_beds_log + total_discharge_log, 
##     family = &quot;binomial&quot;, data = training)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6894  -0.3466  -0.2697  -0.2300   2.7863  
## 
## Coefficients:
##                                        Estimate Std. Error z value
## (Intercept)                            25.68744    5.31031   4.837
## gross_patient_rev_log                  -2.18995    0.47545  -4.606
## staffed_beds_log                       -3.37459    1.14599  -2.945
## total_discharge_log                    -0.44873    0.21107  -2.126
## gross_patient_rev_log:staffed_beds_log  0.31235    0.08909   3.506
##                                        Pr(&gt;|z|)    
## (Intercept)                            1.32e-06 ***
## gross_patient_rev_log                  4.10e-06 ***
## staffed_beds_log                       0.003233 ** 
## total_discharge_log                    0.033503 *  
## gross_patient_rev_log:staffed_beds_log 0.000455 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 624.20  on 1106  degrees of freedom
## Residual deviance: 501.48  on 1102  degrees of freedom
##   (8 observations deleted due to missingness)
## AIC: 511.48
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>This time, we will pick total discharge instead of the staffed beds. Then we will compare two models (glm2 vs. glm3) using chisquare test.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">glm3 &lt;-<span class="st"> </span><span class="kw">glm</span>(EHR_use <span class="op">~</span><span class="st"> </span>gross_patient_rev_log <span class="op">+</span><span class="st"> </span>total_discharge_log <span class="op">+</span><span class="st"> </span>gross_patient_rev_log<span class="op">*</span>total_discharge_log, <span class="dt">data=</span>training, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)
<span class="kw">summary</span>(glm3)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = EHR_use ~ gross_patient_rev_log + total_discharge_log + 
##     gross_patient_rev_log * total_discharge_log, family = &quot;binomial&quot;, 
##     data = training)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.8495  -0.3370  -0.2777  -0.2550   2.6907  
## 
## Coefficients:
##                                           Estimate Std. Error z value
## (Intercept)                               35.18429    6.61203   5.321
## gross_patient_rev_log                     -3.02172    0.59662  -5.065
## total_discharge_log                       -3.64510    0.78982  -4.615
## gross_patient_rev_log:total_discharge_log  0.28840    0.06561   4.395
##                                           Pr(&gt;|z|)    
## (Intercept)                               1.03e-07 ***
## gross_patient_rev_log                     4.09e-07 ***
## total_discharge_log                       3.93e-06 ***
## gross_patient_rev_log:total_discharge_log 1.11e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 624.20  on 1106  degrees of freedom
## Residual deviance: 503.86  on 1103  degrees of freedom
##   (8 observations deleted due to missingness)
## AIC: 511.86
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_hat_logit &lt;-<span class="st"> </span><span class="kw">predict</span>(glm3, <span class="dt">newdata =</span> testing, <span class="dt">type=</span><span class="st">&quot;response&quot;</span>)
y_hat_logit &lt;-<span class="st"> </span><span class="kw">ifelse</span>(p_hat_logit <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)
<span class="kw">confusionMatrix</span>(<span class="dt">data =</span> y_hat_logit, <span class="dt">reference =</span> testing<span class="op">$</span>EHR_use)</code></pre></div>
<pre><code>## Warning in confusionMatrix.default(data = y_hat_logit, reference = testing
## $EHR_use): Levels are not in the same order for reference and data.
## Refactoring data to match.</code></pre>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction   1   0
##          1  11  16
##          0 667  46
##                                           
##                Accuracy : 0.077           
##                  95% CI : (0.0589, 0.0986)
##     No Information Rate : 0.9162          
##     P-Value [Acc &gt; NIR] : 1               
##                                           
##                   Kappa : -0.0419         
##  Mcnemar&#39;s Test P-Value : &lt;2e-16          
##                                           
##             Sensitivity : 0.01622         
##             Specificity : 0.74194         
##          Pos Pred Value : 0.40741         
##          Neg Pred Value : 0.06452         
##              Prevalence : 0.91622         
##          Detection Rate : 0.01486         
##    Detection Prevalence : 0.03649         
##       Balanced Accuracy : 0.37908         
##                                           
##        &#39;Positive&#39; Class : 1               
## </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#chisquare test H0(null model): glm2, H1(alternative model):glm3</span>
<span class="kw">anova</span>(glm3, glm2, <span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: EHR_use ~ gross_patient_rev_log + total_discharge_log + gross_patient_rev_log * 
##     total_discharge_log
## Model 2: EHR_use ~ gross_patient_rev_log + staffed_beds_log + gross_patient_rev_log * 
##     staffed_beds_log + total_discharge_log
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
## 1      1103     503.86                     
## 2      1102     501.48  1   2.3858   0.1224</code></pre>
<p>Because the anova test yields that glm3 is better, our final model is <code>glm3</code> with two variables: total staffed beds and gross patient revenue. Our final physician-level logistic regression model looked like this: <span class="math display">\[
logit(EHR) = \beta_0 + \beta_1(staffed~beds) + \beta_2(gross~patient~revenue) + \beta_3(interaction)
\]</span></p>
<p>Here is a table of odds ratios with 95% CI.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">exp</span>(<span class="kw">cbind</span>(<span class="dt">OR =</span> <span class="kw">coef</span>(glm3), <span class="kw">confint</span>(glm3)))</code></pre></div>
<pre><code>## Waiting for profiling to be done...</code></pre>
<pre><code>##                                                     OR        2.5 %
## (Intercept)                               1.906966e+15 5.233109e+09
## gross_patient_rev_log                     4.871726e-02 1.481991e-02
## total_discharge_log                       2.611883e-02 5.560800e-03
## gross_patient_rev_log:total_discharge_log 1.334285e+00 1.172378e+00
##                                                 97.5 %
## (Intercept)                               9.745855e+20
## gross_patient_rev_log                     1.541502e-01
## total_discharge_log                       1.236346e-01
## gross_patient_rev_log:total_discharge_log 1.516940e+00</code></pre>
<p>Interpretation of the final model: If the total discharge is equal at 5000, with the 10% increase in the revenue, the odds of using EHR is 2.92 times higher. Similarly, if the gross patient revenue is equal at 5000 and the discharged increases by 10%, the odds of using EHR is 2.95 times higher.</p>
<p>Mathematically, if revenue increases 10% and discharge is the same, the odds of using EHR is the higher by <span class="math inline">\(1.102\cdot \log(1.1)-0.04\cdot \log(1.1)\cdot \log(discharge)\)</span> times. If discharge increases by 10% while the revenue is the same, the odds of using EHR is higher by <span class="math inline">\(1.2411\cdot \log(1.1) - 0.046\cdot \log(1.1)\cdot \log(revenue)\)</span></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="secondary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/euniceyeh/EHR-Project/edit/master/04-Primary.Rmd",
"text": "Edit"
},
"download": ["EHR-Project.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
