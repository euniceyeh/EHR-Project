[
["index.html", "Electronic Health Records: Who Uses It? Chapter 1 Overview and Motivation", " Electronic Health Records: Who Uses It? Eunice Yeh, Lauren Yoo, Katherine Wang 2017-12-11 Chapter 1 Overview and Motivation This is the final project report for Fall 2017 Data Science I (BST 260) at Harvard T.H. Chan School of Public Health on the relationships between the use of Electronic Health Records (EHR) and provider demographics, separately among the eligible professionals (EPs) and eligible hospitals participating in the 2016 Medicare &amp; Medicaid EHR Incentive Program across the United States. Enjoy! "],
["work.html", "Chapter 2 Related Work", " Chapter 2 Related Work Anything that inspired you, such as a paper, a web site, or something we discussed in class. In the past 10 years, there has been a lot of discussion around the benefits and risks of adopting electronic health records (EHR’s). Many news sources have covered the topic, and multiple government agencies have published recommendations and articles on the adoption of EHR’s. From 2008 to 2015, the number of office-based practitioners with EHR systems doubled, proving that the popularity of EHR’s are only increasing (Healthit.gov). In 2011, the Centers for Medicare &amp; Medicaid Services (CMS) initiated the Medicare and Medicaid Electronic Health Record Incentive Programs to encourage medical professionals to adopt EHR technology. The program includes incentives for different stages of implementation, including establishing EHR requirements, demonstrating meaningful use, and a final stage to demonstrate improved health outcomes that will start this year (2017). The CMS provides millions of openly accessible data that they have used to evaluate the effectiveness of their incentive program. Looking through these data, we were inspired to utilize some of the R packages and tools that we have been learning in class, hoping to enable a better understanding of what types of providers enrolled in this incentive program are actually using EHR. Specifically, we wanted to implement the following course concepts: Data Wrangling Import and combine different sets of data in order to analyze relationships that have not been done before. Scrape data directly off of websites outside of those related to CMS in order to analyze more than what they already have. Visualization Apply the principles of data visualizations to accurately and meaningfully present our statistical findings. Create super cool while informative plots to help visualize our exploratory analyses. Statistical Analysis Perform regression analysis on the relationship between EHR use and provider demographics. Report and interpret statistical inference from our results. "],
["questions.html", "Chapter 3 Initial Questions", " Chapter 3 Initial Questions What questions are you trying to answer? How did these questions evolve over the course of the project? What new questions did you consider in the course of your analysis? Originally, we wanted to understand what kinds of people are more likely to adopt EHR in general. But then we learned about the Medicare &amp; Medicaid EHR Incentive Program that is run by the government to encourage providers to use EHR. We looked at hospital and physician level data from 2016 to see if there might be some similar characteristics of healthcare providers who are and are not adopting EHR use. Since EHR’s are a technology-based implementation, our group wanted to see if younger physicians are more likely to adopt EHR technology. What are some of the factors that might be associated with adoption of EHR’s? Additionally, we know that physicians working in hospitals do not have a choice in adopting EHR’s. As a result, we wanted to see if there were hospital-related factors affecting adoption of EHRs. To qualify for the incentive program, participants in the program need to use certified EHR technology as recognized by CMS. This can include a comprehensive package offered by one vendor or different modules or products offered by different vendors. All must be certified, but practitioners have some choice in implementation. As a result, we also thought it might be interesting to see how vendors and products are distributed among the EHR users. We also hoped to gain some insight to see if there were any differences in trends across the United States - are the factors correlated with adoption of EHR’s consistent across the country? Or are just a few states leading the pack? Since the Medicare &amp; Medicaid EHR Incentive Program accepts two types of providers in two different ways, our primary objective of looking at provider demographics on the use of EHR is split into two separate parts: What are the demographics of eligible physicians in the incentive program who have been using EHR; are these different from those who have yet to use EHR? What are the demographics of eligible hospitals in the incentive program who have been using EHR; are these different from those who have yet to use EHR? Our secondary objectives are then: Are all of these demographics and effects on EHR use different geographically? What are the demographics of both types of providers who use EHR by the specific EHR vendor or product types? "],
["data.html", "Chapter 4 Data 4.1 Eligible Professionals (EPs) 4.2 Eligible Hospitals (Hosp) 4.3 Vendors &amp; Products (EHR)", " Chapter 4 Data All of our data are based on the 2016 Medicare &amp; Medicaid EHR Incentive Program since the adoption of EHR is an ongoing basis: a provider who adopted and used EHR during the 2014 program, for example, is likely to still be in the program the following years. So theoretically, the 2016 program would be the most cumulative source of providers adopting EHR. As mentioned in Related Work, the adoption of EHR has been consistently rising over the years across the U.S., so there is also no interest in looking at the use over time when we can just look at the latest collection of data. And since 2017 isn’t quite over yet, it wouldn’t be fair to start looking at the usage of EHR within the 2017 program, so the most recent completed data would be on the 2016 program. 4.1 Eligible Professionals (EPs) To answer the first of our Initial Questions as to whether or not a physician’s age, education, practice location, etc. may be related to their use of EHR in the incentive program, we must be able to find demographics data at the practitioner level. 4.1.1 Source/Metadata And here we are: readily available on Data.Medicare.gov are the demographics of physicians eligible for the Medicare &amp; Medicaid EHR incentive program at the practitioner level. We used the API link to read in the data set and applied SQL filtering options to speed up the download since it is a large file. We specified the limit to be exactly 2254703 because that’s the exact number of rows the data contain, if we don’t specify this, the default limit of rows that get downloaded is 100. To compensate, we will specify the exact columns of interest to include, which can also be specified in the download link (we looked through the metadata on the website to select the meaningful and interesting variables). dat &lt;- read.csv(&quot;https://data.medicare.gov/resource/c8qv-268j.csv?$limit=2254703&amp;$select=npi,frst_nm,gndr,cred,med_sch,grd_yr,pri_spec,cty,st,zip,hosp_afl_1,hosp_afl_lbn_1,ehr&amp;$order=npi&quot;) saveRDS(dat, &quot;./data/dat_raw.rds&quot;) # saving data for reproducibility 4.1.2 Wrangling Let’s first take a look at the data structure and a summary of all the columns. str(dat) ## &#39;data.frame&#39;: 1527291 obs. of 13 variables: ## $ cred : Factor w/ 22 levels &quot;&quot;,&quot;AA&quot;,&quot;AU&quot;,&quot;CNA&quot;,..: 1 1 1 1 1 1 1 1 1 1 ... ## $ cty : Factor w/ 10192 levels &quot;20850&quot;,&quot;ABBEVILLE&quot;,..: 2345 274 7938 2790 9076 1041 5545 5545 364 364 ... ## $ ehr : Factor w/ 2 levels &quot;&quot;,&quot;Y&quot;: 1 1 1 1 2 1 1 1 1 1 ... ## $ frst_nm : Factor w/ 54156 levels &quot;A&quot;,&quot;A&#39;LANNE&quot;,..: 3360 3360 3360 48311 38890 10170 20706 20706 24158 24158 ... ## $ gndr : Factor w/ 3 levels &quot;F&quot;,&quot;M&quot;,&quot;U&quot;: 2 2 2 2 2 2 1 1 2 2 ... ## $ grd_yr : int 1994 1994 1994 2003 1999 2003 2007 2007 1997 1997 ... ## $ hosp_afl_1 : Factor w/ 4746 levels &quot;&quot;,&quot;010001&quot;,&quot;010005&quot;,..: 4371 4371 4371 1112 3220 3617 3168 3168 622 622 ... ## $ hosp_afl_lbn_1: Factor w/ 4515 levels &quot;&quot;,&quot;ABBEVILLE AREA MEDICAL CENTER&quot;,..: 2020 2020 2020 1127 2405 2967 1943 1943 4203 4203 ... ## $ med_sch : Factor w/ 398 levels &quot;A T STILL UN, ARIZONA SCHL OF DENT.Y &amp; ORAL HLTH&quot;,..: 215 215 215 321 215 223 261 261 209 209 ... ## $ npi : int 1003000126 1003000126 1003000126 1003000134 1003000142 1003000407 1003000423 1003000423 1003000480 1003000480 ... ## $ pri_spec : Factor w/ 83 levels &quot;&quot;,&quot;ADDICTION MEDICINE&quot;,..: 38 38 38 61 5 24 51 51 27 27 ... ## $ st : Factor w/ 56 levels &quot;&quot;,&quot;AK&quot;,&quot;AL&quot;,&quot;AR&quot;,..: 50 50 50 17 39 42 39 39 7 7 ... ## $ zip : Factor w/ 188675 levels &quot;&quot;,&quot;000075949&quot;,..: 43170 47812 50388 117622 89610 35299 90294 90294 150777 150777 ... summary(dat) ## cred cty ehr frst_nm ## :1012568 HOUSTON : 25754 :1194451 MICHAEL: 30701 ## MD : 344822 PITTSBURGH : 25135 Y: 332840 DAVID : 27486 ## PA : 29223 NEW YORK : 18521 JOHN : 27117 ## NP : 25666 PHILADELPHIA: 18025 ROBERT : 21989 ## DO : 21639 CHICAGO : 16532 JAMES : 20402 ## CNA : 16635 ANN ARBOR : 16390 (Other):1399580 ## (Other): 76738 (Other) :1406934 NA&#39;s : 16 ## gndr grd_yr hosp_afl_1 ## F:681413 Min. :1942 : 449488 ## M:845877 1st Qu.:1988 230046 : 13889 ## U: 1 Median :1999 450076 : 7003 ## Mean :1997 490009 : 5784 ## 3rd Qu.:2008 390111 : 5496 ## Max. :2017 050454 : 5261 ## NA&#39;s :4024 (Other):1040370 ## hosp_afl_lbn_1 ## : 450721 ## UNIVERSITY OF MICHIGAN HEALTH SYSTEM : 13889 ## UNIVERSITY OF TEXAS M D ANDERSON CANCER CENTER,THE: 7003 ## UNIVERSITY OF VIRGINIA MEDICAL CENTER : 5784 ## HOSPITAL OF UNIV OF PENNSYLVANIA : 5496 ## UCSF MEDICAL CENTER : 5261 ## (Other) :1039137 ## med_sch npi ## OTHER :771781 Min. :1.003e+09 ## WAYNE STATE UNIVERSITY SCHOOL OF MEDICINE : 11559 1st Qu.:1.165e+09 ## INDIANA UNIVERSITY SCHOOL OF MEDICINE : 10794 Median :1.337e+09 ## PHILADELPHIA COLLEGE OF OSTEOPATHIC MEDICINE: 10036 Mean :1.340e+09 ## TEMPLE UNIVERSITY SCHOOL OF MEDICINE : 9473 3rd Qu.:1.509e+09 ## UNIVERSITY OF MINNESOTA MEDICAL SCHOOL : 9266 Max. :1.680e+09 ## (Other) :704382 ## pri_spec st zip ## NURSE PRACTITIONER :148237 CA :131284 481095000: 14678 ## INTERNAL MEDICINE :141051 TX :114489 152124756: 6601 ## FAMILY PRACTICE :119255 PA :100942 770304000: 6033 ## PHYSICIAN ASSISTANT :111992 NY : 95038 229080001: 4827 ## PHYSICAL THERAPY : 69682 FL : 84422 326103003: 4336 ## DIAGNOSTIC RADIOLOGY: 64327 MI : 66982 110303816: 3727 ## (Other) :872747 (Other):934134 (Other) :1487089 Observations from the above output: There are 56 levels of states, which means this data include states outside of the 50 mainland states and DC. Since we don’t have sufficient data on the Virgin Islands and Guam, we will have to filter these states out. There is one person whose gender is unknown, we will filter this person out since we want to group by gender. There are 4024 rows with missing graduation years, will need to filer this out too if graduation years is one of the main demographics of interest (will mess up plotting). Also, one or more physician who graduated in 2017 slipped into our data…we will ignore this by filtering it out too. It looks like most zip codes in this data are the full 9-digit zip codes, which can be split into the standard 5-digit format and the 4-digit. There are way too many levels of medical schools and primary specialties, we will probably focus on looking at the most popular ones during exploratory analysis rather than the final primary analysis. data(&quot;state&quot;) clean &lt;- dat %&gt;% filter(st %in% c(state.abb, &quot;DC&quot;)) %&gt;% filter(gndr %in% c(&quot;F&quot;, &quot;M&quot;) &amp; !is.na(grd_yr) &amp; grd_yr != 2017) Now we only have 51 levels of states, 2 levels of gender, and no records with missing graduation year. To make sure we only keep valid zip codes, we can try to use R’s zip code package to validate our zip codes. This is important because we want to be able to accurately perform our analyses on the location variables and regional analysis (especially zip code plotting). # separate out the first five zip codes from the last four extension clean &lt;- clean %&gt;% mutate(zip.ext = substr(as.character(zip), 6, 9), zip = substr(as.character(zip), 1, 5)) # use R zipcode package and data library(zipcode) data(&quot;zipcode&quot;) zip_dat &lt;- clean %&gt;% left_join(zipcode,by=&#39;zip&#39;) # check state mismatches zip_mismatch &lt;- zip_dat %&gt;% mutate(st = as.character(st)) %&gt;% filter(st != state) %&gt;% select(npi, frst_nm, zip, cty, city, st, state, latitude, longitude) # check number of records mismatched nrow(zip_mismatch) ## [1] 1034 # look at the top five mismatches (top5_mismatch &lt;- zip_mismatch %&gt;% group_by(zip, cty, st, city, state) %&gt;% summarize(n = n()) %&gt;% arrange(desc(n)) %&gt;% head(5)) ## # A tibble: 5 x 6 ## # Groups: zip, cty, st, city [5] ## zip cty st city state n ## &lt;chr&gt; &lt;fctr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; ## 1 99362 WALLA WALLA WA Walla Walla OR 222 ## 2 52761 MUSCATINE IA Muscatine IL 114 ## 3 43530 GRANGER IN Jewell OH 86 ## 4 22401 FREDERICKSBURG MD Fredericksburg VA 82 ## 5 20176 HANOVER MD Leesburg VA 74 In order to not just blatantly throw away 1034 mismatches, we will look at the top 5 most common mismatches on a case-by-case basis to try to salvage as many records as possible without searching too deeply in our data set. Also, starting from the 6th most common mismatches, the number of records n were down to 58 or less, so they would have little effect on the data set. The results of searching up the top 10 mismatches on Google Maps: The zip code 99362 spans across Walla Walla in both WA and OR, so it is likely that the practice is located on the WA side of the zip code coverage. We will ignore the state mismatch from the zip code package for this case. The zip code 52761 does belong to Muscatine, IA, which is right on the border of IL. Again, the practice is most likely located on the IA side. Will ignore the state mismatch for this case as well. The zip code for Granger, IN was most likely mistyped. The correct zip code for Granger is 46530, which is very close to 43530. We will fix the zip code for this particular case only. The zip code 22401 does belong to Frederickburg, VA, and is not near the border of VA and MD at all. There is a “Frederick” city in MD, but none of its zip codes look similar enough to 22401. No clear culprit, will have to let this one go. :( The zip code for Hanover, MD is 21076, which was most likely mistyped as 20176. We will fix this particular case as well. # leave out the 22401 Fredericksburg MD mismatch, fix the zip codes for Granger and Hanover. zip_fix &lt;- top5_mismatch %&gt;% ungroup() %&gt;% filter(cty != &#39;FREDERICKSBURG&#39;) %&gt;% mutate(zip = replace(zip, zip %in% c(43530, 20176), c(46530, 21076))) %&gt;% select(-n) mismatch_tokeep &lt;- zip_dat %&gt;% select(-zip) %&gt;% # we want to replace the original wrong zip codes with the fixed zip codes inner_join(zip_fix, by = c(&#39;cty&#39;,&#39;st&#39;, &#39;city&#39;, &#39;state&#39;)) ## Warning: Column `st` joining factor and character vector, coercing into ## character vector clean &lt;- zip_dat %&gt;% mutate(st = as.character(st), state = as.character(state)) %&gt;% filter(st == state | nchar(zip) == 5) %&gt;% # keeping only the matches bind_rows(mismatch_tokeep) %&gt;% # then add in the mismatches we wanted to keep or have fixed select(-city, -state) # will rely on the original city and state columns Continuing on with our wrangling… About 29.4304098% of the (original) data are of physicians not affiliated with any hospital, these are the practitioners we will subset on to do our practitioner-level analysis on since these are the only cases when a physician’s demographics can have an effect on the choice of using EHR. For physicians who are affiliated with a hospital, their demographics would no longer be informative as to whether or not they use EHR, it would then have to be the demographics of the hospitals that could inform the use of EHR at the hospital-level. Thus, we were able to find demographics on hospitals across the U.S. in general, which will be discussed in the next section within this chapter, but there’s no indication of participation in the incentive program nor EHR use, so we will have to merge that hospital demographic data with the practitioners in this data set who are affiliated with any one hospital. So for the practitioner-level analysis we want to: Calculate the number of years since graduation Use 1’s and 0’s instead of ‘Y’ and blanks as indicator of EHR use for our binary outcome Keep only one record per physician, which means we would have to lose the distinct practice locations for physicians who have multiple practices. But since we can’t fit our logistic model with either city, state, or zip code, there’s no point in keeping this detail. Instead, we can calculate the number of distinct practices these physicians have in order to collapse the data to the practitioner level. EPs &lt;- clean %&gt;% filter(hosp_afl_1 == &#39;&#39;) %&gt;% mutate(yrs_grd = 2016 - as.integer(grd_yr), # calc the n of years since graduation cred = case_when(cred == &#39;&#39; ~ &#39;NA&#39;, # assign blanks to NA&#39;s TRUE ~ as.character(cred)), cred = as.factor(cred), ehr = case_when(ehr == &#39;Y&#39; ~ 1, # use numeric indicators ehr == &#39;&#39; ~ 0), ehr = as.factor(ehr)) %&gt;% select(-hosp_afl_1, -hosp_afl_lbn_1, -frst_nm) %&gt;% distinct(npi, .keep_all = TRUE) # keep only one row per physician # calculate the number of practices for each physician SL &lt;- dat %&gt;% group_by(npi) %&gt;% summarise(locations = n_distinct(zip)) EPs &lt;- left_join(EPs, SL, by=&quot;npi&quot;) rm(SL) summary(EPs) ## cred cty ehr gndr ## NA :167692 NEW YORK : 3555 0:214471 F:128382 ## MD : 19334 HOUSTON : 1875 1: 18284 M:104373 ## DC : 9698 BROOKLYN : 1701 U: 0 ## PT : 6881 LOS ANGELES: 1700 ## OD : 6773 CHICAGO : 1586 ## CSW : 5750 PHOENIX : 1490 ## (Other): 16627 (Other) :220848 ## grd_yr med_sch ## Min. :1942 OTHER :140789 ## 1st Qu.:1988 PALMER COLLEGE CHIROPRACTIC - DAVENPORT : 4547 ## Median :1999 LOGAN COLLEGE OF CHIROPRACTIC : 2312 ## Mean :1997 PENNSYLVANIA COLLEGE OF OPTOMETRY : 2310 ## 3rd Qu.:2009 SOUTHERN COLLEGE OF OPTOMETRY : 2211 ## Max. :2016 ILLINOIS COLLEGE OF OPTOMETRY AT CHICAGO: 2184 ## (Other) : 78402 ## npi pri_spec st ## Min. :1.003e+09 PHYSICAL THERAPY :34788 Length:232755 ## 1st Qu.:1.165e+09 CHIROPRACTIC :27033 Class :character ## Median :1.336e+09 CLINICAL SOCIAL WORKER:25225 Mode :character ## Mean :1.340e+09 NURSE PRACTITIONER :22163 ## 3rd Qu.:1.509e+09 OPTOMETRY :20352 ## Max. :1.680e+09 CLINICAL PSYCHOLOGIST :16522 ## (Other) :86672 ## zip zip.ext latitude longitude ## Length:232755 Length:232755 Min. :19.10 Min. :-170.27 ## Class :character Class :character 1st Qu.:34.14 1st Qu.: -98.57 ## Mode :character Mode :character Median :39.40 Median : -86.18 ## Mean :38.19 Mean : -91.39 ## 3rd Qu.:41.75 3rd Qu.: -77.34 ## Max. :66.90 Max. : -67.24 ## NA&#39;s :140 NA&#39;s :140 ## yrs_grd locations ## Min. : 0.00 Min. : 1.000 ## 1st Qu.: 7.00 1st Qu.: 1.000 ## Median :17.00 Median : 1.000 ## Mean :18.55 Mean : 1.293 ## 3rd Qu.:28.00 3rd Qu.: 1.000 ## Max. :74.00 Max. :359.000 ## 4.1.3 Output # permanently save physician-level analysis dataset to repo saveRDS(EPs, file = &quot;./data/EPs.rds&quot;) # for the rest of practitioners who are affiliated with a hospital hosp_afl &lt;- clean %&gt;% # filter on the clean version filter(hosp_afl_1 != &#39;&#39;) %&gt;% mutate(hosp_afl_lbn_1 = as.character(hosp_afl_lbn_1), cty = str_trim(as.character(cty)), st = as.character(st), ehr = ifelse(ehr == &quot;Y&quot;, 1, 0)) %&gt;% # only keep relevant or potentially interesting variables (keeping npi to count number of physicians) distinct(npi, hosp_afl_lbn_1, st, cty, ehr, hosp_afl_1, pri_spec, gndr, grd_yr) # clean up intermediate data sets rm(dat, clean, zipcode, zip_dat, zip_fix, zip_mismatch, mismatch_tokeep, top5_mismatch) We are storing the EPs data set as a .rds file in our repo under the /data directory for reproducibility of our analysis since this is the clean analysis-ready data set that will be used to analyze the potential effects of practitioner demographics on EHR use in our Primary Analysis. The hosp_afl data set, still containing one row per physician per hospital location, is to be merged with the hospital demographics data discussed in the next section. Both EPs and the merged-to-be data of hosp_afl containing the hospital demographics are to be merged with the EHR vendor and product information in the last section of this chapter, in order to explore both physician and hospital demographics by specific types of EHR used. 4.2 Eligible Hospitals (Hosp) General hospital demographics such as the total number of staffed beds, total number of discharges, total number of patient days, and total gross patient revenue (inpatient and outpatient) are all publicly accessible on the American Hospital Directory organized by U.S. states. Since there is not a .csv file ready for us to download and the hospital demographics are already neatly summarized in a table for each state, we decided that we could do some web scraping for this. 4.2.1 Source/Metadata The link to each U.S. state’s summary table of hospital demographics by hospital name in that state begins with the same URL: https://www.ahd.com/states/hospital_ and ends with the state’s abbreviation plus a .html. For example, a table of hospital demographics for each hospital in Massachusetts can be directly scraped from the link, https://www.ahd.com/states/hospital_MA.html. The details of these hospital statistics are described here. hosp_web &lt;- data.frame() for (st in c(state.abb, &quot;DC&quot;)){ url = paste(&quot;https://www.ahd.com/states/hospital_&quot;, st, &quot;.html&quot;, sep=&#39;&#39;) st_df &lt;- read_html(url) %&gt;% html_nodes(&quot;table&quot;) %&gt;% .[[2]] %&gt;% html_table() st_df &lt;- as.data.frame.matrix(eval(parse(text=st))) # removing the TOTAL row at the end of each table st_df &lt;- st_df[!(st_df$&quot;Hospital Name&quot;==&quot;T O T A L&quot;),] st_df$State &lt;- st hosp_web &lt;- rbind(hosp_web, st_df) } saveRDS(hosp_web, &quot;./data/hosp_raw.rds&quot;) # saving data for reproducibility 4.2.2 Wrangling Let’s take a look at the data structure of the raw scrapped hospital demographics. str(hosp_web) ## &#39;data.frame&#39;: 3907 obs. of 7 variables: ## $ Hospital_name : chr &quot;Alaska Native Medical Center&quot; &quot;Alaska Regional Hospital&quot; &quot;Bartlett Regional Hospital&quot; &quot;Central Peninsula General Hospital&quot; ... ## $ City : chr &quot;Anchorage&quot; &quot;Anchorage&quot; &quot;Juneau&quot; &quot;Soldotna&quot; ... ## $ Staffed_beds : chr &quot;152&quot; &quot;174&quot; &quot;57&quot; &quot;106&quot; ... ## $ Total_discharges : chr &quot;7,320&quot; &quot;6,405&quot; &quot;1,710&quot; &quot;2,575&quot; ... ## $ Patient_days : chr &quot;38,687&quot; &quot;33,507&quot; &quot;6,325&quot; &quot;10,186&quot; ... ## $ Gross_patient_revenue: chr &quot;$0&quot; &quot;$947,754&quot; &quot;$147,231&quot; &quot;$305,469&quot; ... ## $ State : chr &quot;AK&quot; &quot;AK&quot; &quot;AK&quot; &quot;AK&quot; ... To do: We need to turn all the demographic information into numeric columns so we can use them as continuous variables. These values are reported with commas, so we need to strip these out. All the gross patient revenues are reported with a dollar sign in addition to the commas, so we need to strip those out too. Proper cases are harder to match on, will convert all letters in city and hospital name to upper case. It looks like some hospital has a gross patient revenue of $0…is this possible? Will explore this after dealing with all of the above first. hosp_clean &lt;- transform(hosp_web, Staffed_beds = as.numeric(gsub(&quot;,&quot;, &quot;&quot;, Staffed_beds)), Total_discharges = as.numeric(gsub(&quot;,&quot;, &quot;&quot;, Total_discharges)), Patient_days = as.numeric(gsub(&quot;,&quot;,&quot;&quot;, Patient_days)), Gross_patient_revenue = as.numeric(gsub(&quot;\\\\$|,&quot;, &quot;&quot;, Gross_patient_revenue)), Hospital_name = toupper(Hospital_name), City = toupper(str_trim(as.character(City))) ) summary(hosp_clean) ## Hospital_name City Staffed_beds Total_discharges ## Length:3907 Length:3907 Min. : 0.0 Min. : 0 ## Class :character Class :character 1st Qu.: 48.0 1st Qu.: 1244 ## Mode :character Mode :character Median : 133.0 Median : 4562 ## Mean : 204.8 Mean : 8017 ## 3rd Qu.: 264.0 3rd Qu.: 11336 ## Max. :36985.0 Max. :136646 ## Patient_days Gross_patient_revenue State ## Min. : 0 Min. : 0 Length:3907 ## 1st Qu.: 4104 1st Qu.: 98340 Class :character ## Median : 18892 Median : 377425 Mode :character ## Mean : 37794 Mean : 797958 ## 3rd Qu.: 51621 3rd Qu.: 1001421 ## Max. :695643 Max. :15618749 It looks like the zero value wasn’t just for the gross patient revenue. From the summary output, we can see that the minimum values on all hospital demographics (staffed beds, total discharges, patient days, gross patient revenue) are zero, which doesn’t seem right. Theoretically, it is impossible for any functioning hospital to have a total of zero on any of these characteristics. Would having a total of zero number of staffed beds really make it a hospital? Can a hospital survive on a gross patient revenue of zero dollars? We thought that it might be a web scrapping error, but when we went back and looked on the website, some of their tables definitely have random zero hospital statistics and some even have a whole row of zeros for certain hospitals. The metadata wasn’t very clear on this, but it seems like it is their way of representing missing data. Instead of keeping them as zeros, which would affect any computation we want to perform on these continuous variables, we will convert every zero into a true missing value, NA. But if a hospital has all missing demographics (the entire row of zeros), then we will just remove that hospital entirely (delete the whole row). # the demographics are columns 3 to 6 of the data frame is.na(hosp_clean[,3:6]) &lt;- !hosp_clean[,3:6] # turn 0&#39;s to NAs hosp_clean &lt;- hosp_clean[rowSums(is.na(hosp_clean)) &lt; 4,] # only delete hosp with all four NAs summary(hosp_clean) ## Hospital_name City Staffed_beds Total_discharges ## Length:3456 Length:3456 Min. : 1.0 Min. : 1 ## Class :character Class :character 1st Qu.: 73.0 1st Qu.: 2141 ## Mode :character Mode :character Median : 157.0 Median : 5692 ## Mean : 231.6 Mean : 9087 ## 3rd Qu.: 290.0 3rd Qu.: 12564 ## Max. :36985.0 Max. :136646 ## NA&#39;s :1 NA&#39;s :9 ## Patient_days Gross_patient_revenue State ## Min. : 1 Min. : 2298 Length:3456 ## 1st Qu.: 7740 1st Qu.: 188177 Class :character ## Median : 23922 Median : 504646 Mode :character ## Mean : 42838 Mean : 923192 ## 3rd Qu.: 57391 3rd Qu.: 1149258 ## Max. :695643 Max. :15618749 ## NA&#39;s :9 NA&#39;s :79 Now the minimum value is 1…still questionable and potentially causing the skew in their distributions. But we did take a look at these specific hospitals with any one demographic characteristic of value 1 and they seem to also have low values of the other characteristics as well (not necessarily exactly of 1, that would’ve been even more suspicious), so these may very well be valid who knows. Anyway, we need to move on with our lives, I mean, to merging with hosp_afl (which is a subset of practitioners who are affiliated with a hospital from the previous section) on the hospital name and state since different hospitals in different locations can have the same name. Since hosp_afl can have multiple rows per hospital if more than one physician in the data is affiliated with it, so we will aggregate the data back to hospital-level after the merge by summarizing physician-level information. hosps &lt;- inner_join(hosp_clean, hosp_afl, by=c(&quot;Hospital_name&quot;=&quot;hosp_afl_lbn_1&quot;, &quot;State&quot;=&quot;st&quot;)) hosps &lt;- hosps %&gt;% group_by(hosp_afl_1, Hospital_name, State, Staffed_beds, Total_discharges, Patient_days, Gross_patient_revenue) %&gt;% summarize(num_phys = n_distinct(npi), female_prop = round(mean(ifelse(gndr == &quot;F&quot;, 1, 0)),2), avg_grad_year = round(mean(grd_yr),2), n_specialty =n_distinct(pri_spec), EHR_use = as.factor(max(ehr))) summary(hosps) ## hosp_afl_1 Hospital_name State Staffed_beds ## 150042 : 5 Length:1857 Length:1857 Min. : 7.0 ## 050471 : 3 Class :character Class :character 1st Qu.: 72.0 ## 360052 : 3 Mode :character Mode :character Median : 154.0 ## 360134 : 3 Mean : 232.1 ## 050257 : 2 3rd Qu.: 277.0 ## 050380 : 2 Max. :36985.0 ## (Other):1839 ## Total_discharges Patient_days Gross_patient_revenue num_phys ## Min. : 1 Min. : 2 Min. : 3624 Min. : 1.0 ## 1st Qu.: 2056 1st Qu.: 7248 1st Qu.: 185397 1st Qu.: 28.0 ## Median : 5350 Median : 21967 Median : 488683 Median : 69.0 ## Mean : 8376 Mean : 38899 Mean : 854423 Mean : 114.4 ## 3rd Qu.:11983 3rd Qu.: 53935 3rd Qu.: 1100914 3rd Qu.: 152.0 ## Max. :77757 Max. :425114 Max. :14140692 Max. :1460.0 ## NA&#39;s :1 NA&#39;s :1 NA&#39;s :9 ## female_prop avg_grad_year n_specialty EHR_use ## Min. :0.0000 Min. :1971 Min. : 1.00 1:1701 ## 1st Qu.:0.2800 1st Qu.:1994 1st Qu.:12.00 0: 156 ## Median :0.3600 Median :1996 Median :22.00 ## Mean :0.3592 Mean :1996 Mean :22.79 ## 3rd Qu.:0.4300 3rd Qu.:1998 3rd Qu.:33.00 ## Max. :1.0000 Max. :2014 Max. :62.00 ## table(hosps[which(hosps$num_phys &lt;= 10),]$EHR_use) ## ## 1 0 ## 52 114 Well, we managed to get about {r} (nrow(hosps)/nrow(hosp_clean))*100% match on the hospitals between the two data sets and the summary statistics on those hospital demographics look a lot nicer and less skewed! Even though we aggregated the physical-level demographics because we didn’t want to just throw away data, we do acknowledge that these physician-level demographics are not really meaningful because they are not representative of the demographics of the hospital. It is unlikely that we had all the physicians information from our hosp_afl for each hospital that matched. (i.e. the 10 physicians we have data on for a hospital may not accurately represent the all practitioners in that hospital) We thought of excluding hospitals with less than 10 practitioners in the data to obtain accurate physician demographics for the hospital, but it would mean cutting down way to much of our limited data. We decided to just focus on the main hospital demographics scraped from the website, and keep the aggregated physician demographics at the exploratory level. Merging with hosp_afl still provided us the main outcome of interest, “EHR_use (the hospital uses the electronic health system)”, calculated as 1 if at least one practitioner in the hospital uses EHR and 0 if none of the practitioners in the hospital uses EHR - that’s why we took the maximum in our code above. Reminder that for practitioners affiliated with hospitals, we assumed that EHR use is the hospital-level adoption and not individual’s. Thus it makes sense that if at least one of the practitioners is recorded in the data as using EHR, we will assume the hospital uses EHR. 4.2.3 Output # clean up intermediate data sets rm(hosp_web, hosp_afl) # hosp_clean will be used later in secondary regional analysis # permanently save hospital-level analysis dataset to repo saveRDS(hosps, file = &quot;./data/hosps.rds&quot;) Again, we are storing the hosps data set as a .rds file in our repo under the /data directory for reproducibility of our analysis since it will be used to analyze the potential effects of hospital demographics on the use of EHR, which is another aspect of our Primary Analysis. This data set will also be subsequently merge with the EHR vendor and product information discussed in the next section to explore hospital demographics by specific types of EHR used. 4.3 Vendors &amp; Products (EHR) Since so many professionals and hospitals across the U.S. have already adopted EHR, we realized that simply looking at the binary outcome of EHR use would be too boring of a project. Thus, we were curious to further explore the demographics of those who do use EHR by the specific types of EHR vendor or product. Fortunately, we were able to find data to support this additional secondary/exploratory analysis. 4.3.1 Source/Metadata The Health IT Dashboard provides certified health IT product data from the ONC Certified Health IT Product List (CHPL) such as the unique vendors, products, and product types of each certified health IT product used as part of the Medicare EHR Incentive Program. We downloaded only the 2016 data set, which also includes unique provider identifiers (NPI), in order to match the EPs data set discussed in the first section of this chapter. As the metadata explains, a provider in this data set can be either an eligible professional (EP) and eligible hospital (Hospital), as distinguished by the Provider_Type column. Thus, only the Provider_Type == 'EP' records is merged with the subset of EPs who are not affiliated with any hospital, and the Provider_Type == 'Hospital' records is merged with the subset of EPs who are affiliated with a hospital, and therefore directly merged with the combined and cleaned version of the hosp data set discussed in the previous section of this chapter. EHR &lt;- read.csv(&quot;https://dashboard.healthit.gov/datadashboard/data/MU_REPORT_2016.csv&quot;) saveRDS(EHR, &quot;./data/EHR_raw.rds&quot;) # saving data for reproducibility 4.3.2 Wrangling Data structure, you know the drill. str(EHR) ## &#39;data.frame&#39;: 505914 obs. of 23 variables: ## $ NPI : int 1003000142 1003000522 1003000597 1003000639 1003000902 1003000936 1003000936 1003001256 1003001256 1003001462 ... ## $ CCN : int NA NA NA NA NA NA NA NA NA NA ... ## $ Provider_Type : Factor w/ 2 levels &quot;EP&quot;,&quot;Hospital&quot;: 1 1 1 1 1 1 1 1 1 1 ... ## $ Business_State_Territory : Factor w/ 56 levels &quot;Alabama&quot;,&quot;Alaska&quot;,..: 38 11 39 5 17 45 45 6 6 12 ... ## $ ZIP : Factor w/ 11921 levels &quot;&quot;,&quot;00603&quot;,&quot;00612&quot;,..: 5619 4304 9168 10670 5353 3731 3731 10037 10037 4055 ... ## $ Specialty : Factor w/ 288 levels &quot;&quot;,&quot;Acupuncturist&quot;,..: 177 9 279 263 79 27 27 79 79 235 ... ## $ Hospital_Type : Factor w/ 3 levels &quot;&quot;,&quot;Critical Access&quot;,..: 1 1 1 1 1 1 1 1 1 1 ... ## $ Program_Type : Factor w/ 2 levels &quot;Medicare&quot;,&quot;Medicare/Medicaid&quot;: 1 1 1 1 1 1 1 1 1 1 ... ## $ Program_Year : int 2016 2016 2016 2016 2016 2016 2016 2016 2016 2016 ... ## $ Provider_Stage_Number : Factor w/ 2 levels &quot;Stage 1&quot;,&quot;Stage 2&quot;: 2 2 1 1 2 2 2 2 2 1 ... ## $ Payment_Year : int 3 5 NA NA 5 3 3 5 5 NA ... ## $ Attestation_Month : int 2 1 1 2 1 5 5 2 2 3 ... ## $ Attestation_Year : int 2017 2017 2017 2017 2017 2017 2017 2017 2017 2017 ... ## $ MU_Definition_2014 : logi NA NA NA NA NA NA ... ## $ Stage_2_Scheduled_2014 : int 0 1 0 0 1 0 0 0 0 0 ... ## $ EHR_Certification_Number : Factor w/ 3550 levels &quot;0014E0087U0WV35&quot;,..: 2699 1660 2177 2303 2965 1119 1119 2791 2791 2023 ... ## $ EHR_Product_CHP_Id : Factor w/ 2317 levels &quot;14.02.02.1026.A033.01.01.0.170217&quot;,..: 1876 346 1168 1403 2226 136 1747 1403 1876 1004 ... ## $ Vendor_Name : Factor w/ 484 levels &quot;4medica, Inc.&quot;,..: 134 35 338 134 159 170 170 134 134 120 ... ## $ EHR_Product_Name : Factor w/ 798 levels &quot;1 Connect BuildYourEMR&quot;,..: 192 42 554 192 81 251 252 192 192 533 ... ## $ EHR_Product_Version : Factor w/ 699 levels &quot;1&quot;,&quot;1.0&quot;,&quot;1.0.0&quot;,..: 489 113 385 494 50 549 206 494 489 155 ... ## $ Product_Classification : Factor w/ 3 levels &quot;&quot;,&quot;Complete EHR&quot;,..: 2 2 2 2 2 2 2 2 2 2 ... ## $ Product_Setting : Factor w/ 3 levels &quot;&quot;,&quot;Ambulatory&quot;,..: 2 2 2 2 2 2 2 2 2 2 ... ## $ Product_Certification_Edition_Yr: int 2014 2014 2014 2014 2014 2014 2014 2014 2014 2014 ... There are actually a lot of variables here that are not informative so we can drop them and just focus on a smaller set, i.e. program year would just be 2016 on every row in the data, EHR certification number or CHP ID is at an unnecessary level of detail. Let’s select the important columns and a few potentially interesting variables to summarize by (thus, using distinct instead of select). EHR_clean &lt;- EHR %&gt;% distinct(NPI, CCN, Provider_Type, Business_State_Territory, ZIP, Specialty, Hospital_Type, Vendor_Name, EHR_Product_Name, Product_Classification, Product_Setting) summary(EHR_clean) ## NPI CCN Provider_Type ## Min. :1.003e+09 Min. : 10001 EP :393375 ## 1st Qu.:1.255e+09 1st Qu.:121301 Hospital: 16330 ## Median :1.508e+09 Median :241361 ## Mean :1.501e+09 Mean :261394 ## 3rd Qu.:1.750e+09 3rd Qu.:390179 ## Max. :1.993e+09 Max. :670114 ## NA&#39;s :393375 ## Business_State_Territory ZIP ## California : 31692 : 16330 ## Minnesota : 24252 55905 : 11278 ## Florida : 22664 48109 : 3336 ## Texas : 22307 02114 : 3021 ## Pennsylvania: 20564 32224 : 2818 ## Michigan : 19739 60611 : 2521 ## (Other) :268487 (Other):370401 ## Specialty ## Family Medicine : 61485 ## Internal Medicine : 45820 ## Student in an Organized Health Care Education/Training Program: 17552 ## Cardiovascular Disease : 17524 ## : 16330 ## (Other) :250764 ## NA&#39;s : 230 ## Hospital_Type Vendor_Name ## :393375 Epic Systems Corporation:133637 ## Critical Access: 3348 Cerner Corporation : 70367 ## General : 12982 Allscripts : 28067 ## athenahealth, Inc. : 20970 ## eClinicalWorks, LLC : 16354 ## GE Healthcare : 14882 ## (Other) :125428 ## EHR_Product_Name ## EpicCare Ambulatory 2014 Certified EHR Suite: 71207 ## athenaClinicals : 20945 ## Beacon Oncology 2014 Certified Module : 16281 ## eClinicalWorks : 16097 ## NextGen Ambulatory EHR : 13616 ## Powerchart (Clinical) : 13293 ## (Other) :258266 ## Product_Classification Product_Setting ## : 14690 : 14690 ## Complete EHR:202827 Ambulatory:325708 ## Modular EHR :192188 Inpatient : 69307 ## ## ## ## Observations: There are records of missing CCN (the identifying number for eligible hospitals) and missing hospital type, which matches up with the number of records that are Provider_Type == 'EP'. It makes sense since these variables would not be relevant to an eligible professional (EP), who is not affiliated with any hospital. There are exactly 16330 records of missing zip codes and blank specialty (specifically not NA’s), and this number matches up with the number of Provider_Type == 'Hospital'. It sounds like the we just need to split the data into EPs and hospitals since there are enough distinct variables relevant for each type. Then clean each one before merging with their corresponding level of demographics. Split: # split for EPs EHR_EPs &lt;- EHR_clean %&gt;% filter(Provider_Type == &#39;EP&#39;) %&gt;% select(-CCN, -Hospital_Type, -Provider_Type) summary(EHR_EPs) ## NPI Business_State_Territory ZIP ## Min. :1.003e+09 California : 30425 55905 : 11278 ## 1st Qu.:1.255e+09 Minnesota : 23895 48109 : 3336 ## Median :1.508e+09 Florida : 21678 02114 : 3021 ## Mean :1.501e+09 Texas : 20941 32224 : 2818 ## 3rd Qu.:1.750e+09 Pennsylvania: 19919 60611 : 2521 ## Max. :1.993e+09 Michigan : 19221 23298 : 2235 ## (Other) :257296 (Other):368166 ## Specialty ## Family Medicine : 61485 ## Internal Medicine : 45820 ## Student in an Organized Health Care Education/Training Program: 17552 ## Cardiovascular Disease : 17524 ## Obstetrics &amp; Gynecology : 15059 ## (Other) :235705 ## NA&#39;s : 230 ## Vendor_Name ## Epic Systems Corporation:131883 ## Cerner Corporation : 64893 ## Allscripts : 27743 ## athenahealth, Inc. : 20929 ## eClinicalWorks, LLC : 16345 ## GE Healthcare : 14861 ## (Other) :116721 ## EHR_Product_Name ## EpicCare Ambulatory 2014 Certified EHR Suite: 71047 ## athenaClinicals : 20928 ## Beacon Oncology 2014 Certified Module : 16189 ## eClinicalWorks : 16097 ## NextGen Ambulatory EHR : 13613 ## Powerchart (Clinical) : 12548 ## (Other) :242953 ## Product_Classification Product_Setting ## : 14462 : 14462 ## Complete EHR:200889 Ambulatory:324643 ## Modular EHR :178024 Inpatient : 54270 ## ## ## ## # check for valid zip codes EHR_EPs %&gt;% filter(nchar(as.character(ZIP)) &lt; 5) %&gt;% group_by(ZIP) %&gt;% summarize(n()) ## # A tibble: 3 x 2 ## ZIP `n()` ## &lt;fctr&gt; &lt;int&gt; ## 1 1010 1 ## 2 EH16 2 ## 3 IP28 9 # split for hospitals EHR_hosps &lt;- EHR_clean %&gt;% filter(Provider_Type == &#39;Hospital&#39;) %&gt;% select(-ZIP, -Specialty, -Provider_Type) summary(EHR_hosps) ## NPI CCN Business_State_Territory ## Min. :1.003e+09 Min. : 10001 Texas : 1366 ## 1st Qu.:1.245e+09 1st Qu.:121301 California : 1267 ## Median :1.488e+09 Median :241361 Florida : 986 ## Mean :1.495e+09 Mean :261394 Illinois : 667 ## 3rd Qu.:1.740e+09 3rd Qu.:390179 Pennsylvania: 645 ## Max. :1.993e+09 Max. :670114 Ohio : 564 ## (Other) :10835 ## Hospital_Type ## : 0 ## Critical Access: 3348 ## General :12982 ## ## ## ## ## Vendor_Name ## Cerner Corporation :5474 ## Medical Information Technology, Inc. (MEDITECH):2879 ## Epic Systems Corporation :1754 ## MEDHOST : 653 ## McKesson : 625 ## Cerner Health Services, Inc. : 525 ## (Other) :4420 ## EHR_Product_Name ## HealthSentry : 851 ## Powerchart (Clinical) : 745 ## Powerchart (All CQM&#39;s) : 703 ## P2 Sentinel (Powered by Sensage) : 580 ## EpicCare Inpatient 2014 Certified EHR Suite: 565 ## HealtheLife and Powerchart : 552 ## (Other) :12334 ## Product_Classification Product_Setting ## : 228 : 228 ## Complete EHR: 1938 Ambulatory: 1065 ## Modular EHR :14164 Inpatient :15037 ## ## ## ## The summaries much look better separately for the two sets. Now we just have to clean up the zip codes for the physician-level EHR’s. Looks like there are only a few records with invalid zip codes. Similar to how we cleaned up the zip codes for EPs, we will match the zip codes with R’s own zip code package. # first remove non-US states, appending DC to list state_name &lt;- c(state.name,&quot;District Of Columbia&quot;) states &lt;- data.frame(state_name = state_name, state_abb = c(state.abb, &quot;DC&quot;)) EHR_EPs &lt;- EHR_EPs %&gt;% filter(Business_State_Territory %in% state_name) length(unique(EHR_EPs$Business_State_Territory)) ## [1] 51 # remove invalid zip codes EHR_EPs &lt;- EHR_EPs %&gt;% filter(nchar(as.character(ZIP)) &gt;= 5) # merge R zip codes library(zipcode) data(&quot;zipcode&quot;) EHR_EPs &lt;- EHR_EPs %&gt;% left_join(zipcode, by = c(&quot;ZIP&quot; = &quot;zip&quot;)) ## Warning: Column `ZIP`/`zip` joining factor and character vector, coercing ## into character vector # check state mismatches EHR_mismatch &lt;- EHR_EPs %&gt;% left_join(states, by = c(&quot;state&quot; = &quot;state_abb&quot;)) %&gt;% # need to add in long state names mutate(Business_State_Territory = as.character(Business_State_Territory)) %&gt;% filter(state_name != Business_State_Territory) ## Warning: Column `state`/`state_abb` joining character vector and factor, ## coercing into character vector # percent state mismatch nrow(EHR_mismatch)/nrow(EHR_EPs) ## [1] 0.04492693 # check which zips are mismatching EHR_mismatch %&gt;% group_by(ZIP, Business_State_Territory, state_name) %&gt;% summarize(num = n()) %&gt;% arrange(desc(num)) %&gt;% head(8) ## # A tibble: 8 x 4 ## # Groups: ZIP, Business_State_Territory [8] ## ZIP Business_State_Territory state_name num ## &lt;chr&gt; &lt;chr&gt; &lt;fctr&gt; &lt;int&gt; ## 1 51503 Nebraska Iowa 120 ## 2 99362 Washington Oregon 83 ## 3 54601 Minnesota Wisconsin 80 ## 4 19104 New Jersey Pennsylvania 65 ## 5 55905 Florida Minnesota 63 ## 6 33331 Ohio Florida 58 ## 7 85259 Minnesota Arizona 48 ## 8 55905 Wisconsin Minnesota 46 The top 10 mismatches: Zip code 51503 is in Iowa (agrees with zip code package)/bordering Nebraska, but reported as Nebraska which is neighboring Iowa. This may be correct, so we’ll keep Nebraska as reported Zip code 55905 is in Minnesota, but reported state Florida is not near Minnesota. Since there is likely a typo in either zip or state, we’ll remove this mismatched zip all together Zip code 54601 is in Wisconsin/bordering Minnesota, but reported as Minnesota which is neighboring Wisconsin. We’ll keep Minnesota as reported Zip code 33331 is in Florida, which is nowhere near Ohio. Since it is unclear which was the typo, we’ll delete all these mismatches Zip code 55905 is in Minnesota - found it’s actually Mayo Clinic (along with #2). Wisconsin and Minnesota are bordering each other, so we’ll keep Wisconsin –&gt; in general, if we look at test_mismatch %&gt;% filter(ZIP == &quot;55905&quot;) you will notice that this zip code is incorrectly used for multiple states, possibly meaning there were data entry/quality issues, which validates our decision to clean up the zip codes. EHR_zip &lt;- EHR_EPs %&gt;% left_join(states, by = c(&quot;state&quot; = &quot;state_abb&quot;)) %&gt;% mutate(Business_State_Territory = as.character(Business_State_Territory)) %&gt;% filter( (state_name == Business_State_Territory) | (state_name != Business_State_Territory &amp;&amp; ZIP == &quot;51503&quot; &amp;&amp; Business_State_Territory == &quot;Nebraska&quot;) | (state_name != Business_State_Territory &amp;&amp; ZIP == &quot;54601&quot; &amp;&amp; Business_State_Territory == &quot;Minnesota&quot;) | (state_name != Business_State_Territory &amp;&amp; ZIP == &quot;55905&quot; &amp;&amp; Business_State_Territory == &quot;Wisconsin&quot;) ) %&gt;% select(NPI, Business_State_Territory, ZIP, Specialty, Vendor_Name, EHR_Product_Name, Product_Classification, Product_Setting) ## Warning: Column `state`/`state_abb` joining character vector and factor, ## coercing into character vector We want to inner join with the EPs data set on NPI, which has one row per physician by their unique NPI (one-to-many merge). # merge with EPs data EHR_EPs &lt;- inner_join(EHR_zip, EPs, by=c(&#39;NPI&#39;=&#39;npi&#39;)) summary(EHR_EPs) ## NPI Business_State_Territory ZIP ## Min. :1.003e+09 Length:24155 Length:24155 ## 1st Qu.:1.165e+09 Class :character Class :character ## Median :1.336e+09 Mode :character Mode :character ## Mean :1.340e+09 ## 3rd Qu.:1.509e+09 ## Max. :1.680e+09 ## ## Specialty Vendor_Name ## Optometrist : 4746 Epic Systems Corporation : 4225 ## Chiropractor : 2893 Integrated Practice Solutions, Inc.: 1600 ## Family Medicine: 2397 Modernizing Medicine, Inc. : 1544 ## Ophthalmology : 1906 NextGen Healthcare : 1285 ## Dermatology : 1571 GE Healthcare : 1048 ## (Other) :10638 Mayo Clinic : 1035 ## NA&#39;s : 4 (Other) :13418 ## EHR_Product_Name ## EpicCare Ambulatory 2014 Certified EHR Suite: 2043 ## ChiroTouch : 1281 ## NextGen Ambulatory EHR : 1209 ## athenaClinicals : 1019 ## EMA : 888 ## eClinicalWorks : 732 ## (Other) :16983 ## Product_Classification Product_Setting cred ## : 352 : 352 NA :15578 ## Complete EHR:15438 Ambulatory:21513 MD : 4987 ## Modular EHR : 8365 Inpatient : 2290 OD : 1675 ## DC : 1271 ## DO : 325 ## DPM : 290 ## (Other): 29 ## cty ehr gndr grd_yr ## ROCHESTER: 1663 0: 5355 F: 9673 Min. :1951 ## LOS ALTOS: 687 1:18800 M:14482 1st Qu.:1985 ## PALO ALTO: 527 U: 0 Median :1996 ## NEW YORK : 335 Mean :1995 ## FREMONT : 276 3rd Qu.:2005 ## BOSTON : 207 Max. :2016 ## (Other) :20460 ## med_sch pri_spec ## OTHER : 5140 OPTOMETRY :5155 ## PALMER COLLEGE CHIROPRACTIC - DAVENPORT : 699 CHIROPRACTIC :3161 ## ILLINOIS COLLEGE OF OPTOMETRY AT CHICAGO: 640 FAMILY PRACTICE :2637 ## SOUTHERN COLLEGE OF OPTOMETRY : 572 DERMATOLOGY :2534 ## PENNSYLVANIA COLLEGE OF OPTOMETRY : 538 OPHTHALMOLOGY :2044 ## INDIANA UNIVERSITY - SCHOOL OF OPTOMETRY: 420 INTERNAL MEDICINE:1499 ## (Other) :16146 (Other) :7125 ## st zip zip.ext latitude ## Length:24155 Length:24155 Length:24155 Min. :19.53 ## Class :character Class :character Class :character 1st Qu.:34.61 ## Mode :character Mode :character Mode :character Median :39.04 ## Mean :38.31 ## 3rd Qu.:42.13 ## Max. :64.85 ## NA&#39;s :11 ## longitude yrs_grd locations ## Min. :-159.38 Min. : 0.00 Min. : 1.000 ## 1st Qu.:-104.96 1st Qu.:11.00 1st Qu.: 1.000 ## Median : -90.03 Median :20.00 Median : 1.000 ## Mean : -93.52 Mean :21.31 Mean : 1.281 ## 3rd Qu.: -80.31 3rd Qu.:31.00 3rd Qu.: 1.000 ## Max. : -67.88 Max. :65.00 Max. :53.000 ## NA&#39;s :11 # check EHR use (should expect all 1&#39;s or &quot;yes&quot;) table(EHR_EPs$ehr) ## ## 0 1 ## 5355 18800 Notice that the ehr column is not all 1’s when we expect them to be. This explains why we had so many physicians who fell in the ehr='' category. The physicians whom we have EHR product usage information on did not answer “yes” to EHR use in the original EPs data. 4.3.3 Output saveRDS(EHR_EPs, file = &quot;./data/EHR_EPs.rds&quot;) Although the specific product types are too granular and not meaningful enough to clean, we believe that exploring the professional and hospital demographics across vendor types may still be interesting, especially if we focus on the top 10 most popular vendors or classify the smaller local vendors as one group. "],
["primary.html", "Chapter 5 Primary Analysis 5.1 Physician Demographics 5.2 Hospital Demographics", " Chapter 5 Primary Analysis 5.1 Physician Demographics Since practitioners who are affiliated with a hospital may not have a choice in using EHR or not, we will exclude these from our analysis population, which is now just the practitioners who enrolled in the Medicare Incentive Program who are not affiliated with any hospital, which come from the data set EPs that we cleaned in section 4.1. We will use logistic regression because we have a dichotomous outcome (EHR used: Y/N) and want to explore the relationship between the outcome and other predictor/explanatory variables. The coefficients generated from logistic regression will give us a formula to predict a logit transformation of the probability of the outcome. The general formula will look like this: \\[ ln\\left(\\frac{p}{1-p}\\right) = \\beta_0 + \\beta_1X_1 + \\beta_2X_2 + ....+\\beta_kX_k \\] 5.1.1 Exploratory Before fitting our model, we explored the relationships between our variables of interest using Association Rule Learning. We will use the R package called arulesViz to help us visualize this because we have mostly categorical variables with too many levels for simple correlation matrices to handle. Here, each “transaction” is a practitioner who adapted EHR as part of the Medicare EHR Incentive Program in the U.S. # first need to keep certain associational variables of interest and discretize them corr &lt;- EPs %&gt;% ungroup() %&gt;% filter(med_sch != &quot;OTHER&quot;) %&gt;% select(gndr, grd_yr, pri_spec, st) %&gt;% mutate(grd_yr = as.factor(grd_yr), st = as.factor(st)) # convert from a data frame to a transaction dataset corrt &lt;- as(corr, &quot;transactions&quot;) # create rules using the apriori rules &lt;- apriori(corrt, parameter=list(support=0.01, confidence=0.5)) ## Apriori ## ## Parameter specification: ## confidence minval smax arem aval originalSupport maxtime support minlen ## 0.5 0.1 1 none FALSE TRUE 5 0.01 1 ## maxlen target ext ## 10 rules FALSE ## ## Algorithmic control: ## filter tree heap memopt load sort verbose ## 0.1 TRUE TRUE FALSE TRUE 2 TRUE ## ## Absolute minimum support count: 919 ## ## set item appearances ...[0 item(s)] done [0.00s]. ## set transactions ...[203 item(s), 91966 transaction(s)] done [0.03s]. ## sorting and recoding items ... [90 item(s)] done [0.00s]. ## creating transaction tree ... done [0.04s]. ## checking subsets of size 1 2 3 done [0.00s]. ## writing ... [80 rule(s)] done [0.00s]. ## creating S4 object ... done [0.00s]. plot(rules) The result is a a set of 80 association rules with generally high confidence and low support (proportion of transactions in the data set which contain the item set). Let’s first trim this down a bit to show only important rules (confidence &gt; 0.85). We’ll pick the top 30 rules so we have a smaller subset to find meaningful relationships. The top 30 rules are chosen with respect to the lift measure (a measure of rule strength) - the deviation of the support of the whole rule from the support expected under independence given the supports of both sides of the rule. subrules &lt;- rules[quality(rules)$confidence &gt; 0.85] inspect(head(sort(subrules, by =&quot;lift&quot;),30)) ## lhs rhs support confidence ## [1] {pri_spec=NURSE PRACTITIONER} =&gt; {gndr=F} 0.02473740 0.9009901 ## [2] {grd_yr=1976} =&gt; {gndr=M} 0.01154775 0.8530120 ## lift count ## [1] 2.265309 2275 ## [2] 1.416338 1062 plot(subrules, method=&quot;grouped&quot;, control=list(k=50)) We concluded the following: Medical School, Primary Specialty, and Gender had the most meaningful associations However, we would choose only one of medical school or primary specialty. They are likely highly correlated because there are specialty-specific schools such as chiropractic schools. Now we need to explore the relationships of our continuous independent variables Years since graduation by gender using jittered violin plots EPs %&gt;% melt(id.vars=&quot;gndr&quot;, measure.vars=&quot;yrs_grd&quot;) %&gt;% ggplot(aes(gndr, value)) + geom_jitter(alpha = 0.1) + geom_violin(alpha = 0.75) + facet_grid(variable ~ .) + scale_y_sqrt() Gender seems to be pretty independent of the number of years since graduation so we should be able to add both to the model without influencing each other’s effects. The distribution of years since graduation is skewed, so we used a square root scale to make the kernel density curves look more symmetric in the plots than it otherwise would have been. The actual values of the years since graduation were left alone so we could intuitively interpret the results from our model. Number of locations by gender using jittered violin plots EPs %&gt;% melt(id.vars=&quot;gndr&quot;, measure.vars=&quot;locations&quot;) %&gt;% ggplot(aes(gndr, value)) + geom_jitter(alpha = 0.1) + geom_violin(alpha = 0.75) + facet_grid(variable ~ .) + scale_y_log10() While practice locations seem to be distributed evenly between males and females, note that the large majority of physicians in our data set have only one location. There are a few outliers who have over 300 unique zip codes associated with their practices. Years since graduation by credentials using bubble plots EPs %&gt;% mutate(cred = reorder(cred, yrs_grd)) %&gt;% ggplot(aes(cred, yrs_grd)) + stat_sum(aes(size = ..n.., group = 1)) + scale_size_area(max_size = 10) Credentials (physician degrees) had one of the fewest number of levels, so we wanted to see if it was a good candidate for our model. The distribution of years since graduation looked pretty consistent across different credentials. Unfortunately, there were disproportionally high numbers of physicians with credentials listed as N/A (~75%), meaning their credential was unknown, so we could not use this variable in our model. Gender, years since graduation, and number of locations by EHR use # scatter plot matrix of all three effects plus EHR use EPs %&gt;% ggpairs(columns = c(&quot;gndr&quot;, &quot;yrs_grd&quot;, &quot;locations&quot;, &quot;ehr&quot;)) ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`. ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`. ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`. ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`. # bubble plot of years since graduation by EHR use EPs %&gt;% ggplot(aes(ehr, yrs_grd)) + stat_sum(aes(size = ..n.., group = 1)) + scale_size_area(max_size = 10) # jittered violin plot of years since graduation by EHR use EPs %&gt;% melt(id.vars=&quot;ehr&quot;, measure.vars=&quot;yrs_grd&quot;) %&gt;% ggplot(aes(ehr, value)) + geom_jitter(alpha = 0.1) + geom_violin(alpha = 0.75) + facet_grid(variable ~ .) + scale_y_sqrt() Again, we can confirm that all three variables of interest (gender, years since graduation, and number of locations) are not strongly correlated with each other at all. We can safely add them into the final model without interaction terms. From the this scatter plot matrix, it is apparent that the distribution of gender and years since graduation differ by EHR use (as indicated by the red and blue colors, blinded here because we want to give you some suspense dun dun dun - but actually, we just couldn’t get the legend to not completely cover the density curves). A general observation from the bubble and violin plots is that there are proportionally more physicians in our data who have not used EHR. so we already have an imbalance in sample size between the two groups. But overall, our sample size is still large enough. 5.1.2 Final Analysis 5.1.2.1 Fit the Logistic Model Our final physician-level logistic regression model looked like this: \\[ logit(EHR) = \\beta_0 + \\beta_1(gender) + \\beta_2(years~since~grad) + \\beta_3(location) \\] # fit the model model &lt;- glm(ehr ~ gndr + yrs_grd + locations, data = EPs, family = binomial) summary(model) ## ## Call: ## glm(formula = ehr ~ gndr + yrs_grd + locations, family = binomial, ## data = EPs) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -0.7116 -0.4564 -0.3538 -0.3037 2.5340 ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) -3.1736081 0.0165219 -192.085 &lt;2e-16 *** ## gndrM 0.6964365 0.0165690 42.033 &lt;2e-16 *** ## yrs_grd 0.0166015 0.0005856 28.349 &lt;2e-16 *** ## locations 0.0020854 0.0023454 0.889 0.374 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 128120 on 232754 degrees of freedom ## Residual deviance: 124587 on 232751 degrees of freedom ## AIC: 124595 ## ## Number of Fisher Scoring iterations: 5 #table of odds ratios with 95% CI (ORtab &lt;- exp(cbind(OR = coef(model), confint(model)))) ## Waiting for profiling to be done... ## OR 2.5 % 97.5 % ## (Intercept) 0.04185232 0.04051644 0.04322772 ## gndrM 2.00658945 1.94253308 2.07289203 ## yrs_grd 1.01674007 1.01557342 1.01790742 ## locations 1.00208755 0.99665828 1.00611723 Holding years since graduation and locations at a fixed value, the odds of adopting EHR for males is 2.01 the odds of adopting EHR for females. Holding gender (male) and locations at a fixed value, the odds of adopting EHR has a 1.67% increase for each additional year since graduation. We did not find a statistically significant effect in the number of practice locations on the use of EHR, so this makes me feel better about collapsing the records by unique physicians and losing the specific location information like city, state, and zip code. If owning practices in various different locations had an effect on EHR use, then we would have needed to consider fitting a mixed effects model that takes into account the random effects of the different locations these physicians practice in, or consider a repeated measures analysis on the non-collapsed data where a physician can have repeated records for each unique location of their practice, etc. But since we lack statistical evidence for the number of practice locations to show an effect on EHR use, we have no reason to seek a better model to fit. 5.1.2.2 Predicted Probabilities We can look at the effects of varying years since graduation by gender while holding the number of practice locations constant at its sample mean on the outcome of EHR use with a ribbon plot of the predicted probabilities. # create a table of predicted probabilities varying the value of years since graduation and gender varyvals &lt;- with(EPs, data.frame(yrs_grd = rep(seq(from = min(yrs_grd), to = max(yrs_grd), length.out = 100), 2), locations = mean(locations), gndr = factor(rep(c(&#39;M&#39;,&#39;F&#39;), each = 100)))) pred &lt;- cbind(varyvals, predict(model, newdata = varyvals, type = &quot;link&quot;, se = TRUE)) pred &lt;- within(pred, { PredictedProb &lt;- plogis(fit) LL &lt;- plogis(fit - (1.96 * se.fit)) UL &lt;- plogis(fit + (1.96 * se.fit)) }) # ribbon plot ggplot(pred, aes(x = yrs_grd, y = PredictedProb)) + geom_ribbon(aes(ymin = LL, ymax = UL, fill = gndr), alpha = 0.2) + geom_line(aes(colour = gndr), size = 1) Well, how well does the model with these predictors fit compared to a null model? Let’s perform the likelihood ratio test using a chi-square test of {r} with(model, null.deviance - deviance) (the difference in deviance for the two models) with {r} with(model, df.null - df.residual) degrees of freedom on our observed data, which gives us the following p-value: with(model, pchisq(null.deviance - deviance, df.null - df.residual, lower.tail = FALSE)) ## [1] 0 Looks like our model did pretty well! 5.2 Hospital Demographics Now let’s focus on the other type of providers eligible for the Medicaid &amp; Medicare EHR Incentive Program: the hospitals. Recall that in this analysis population, we included only the physicians who are affiliated with any hospital and aggregated their demographics and EHR use at the hospital level. This is because the use of EHR would no longer depend on the physicians themselves, but rather the hospitals who decide to participate in the program. Since the aggregated physician demographics are not reliable demographic representations of the hospitals, as discussed in the Data chapter, we will only perform exploratory analysis on them and focus on the scraped hospital demographics (staffed beds, total discharges, patient days, gross patient revenue) for the final analysis. 5.2.1 Exploratory Analysis Number of practitioners in hospital We suspect that if there is less than 10 physicians in our data per hospital, it is not an accurate representation of the hospital. i.e. The 10 practitioners may not accurately represent the entire group of practitioners in the hospital. We thought of excluding the hospitals with less than 10 practitioners in the data, but it would mean removing 108 out of 166 hospitals in the “control group” that does not use EHR. Therefore, while we will keep the aggregated variables, we should keep in mind that these variables may not be accurate representation of hospital demographics. e.g. Number of practitioners in the dataset may be only ten, while the hospital actually employees 500 practitioners. #RECODE Using EHR_use==1 -&gt; Y, 0 -&gt; &quot;&quot; hosps$EHR_char &lt;- ifelse(hosps$EHR_use == 1, &quot;Y&quot;, &quot;Blank&quot;) #RECODE Years since medical school graduation hosps$yrs_since_grad = 2017 - hosps$avg_grad_year table(hosps$EHR_use) ## ## 1 0 ## 1701 156 less10ind &lt;- which(hosps$num_phys &lt;= 10) table(hosps[less10ind,]$EHR_use) ## ## 1 0 ## 52 114 5.2.1.1 Box plots Each box plot shows an independent variable’s distribution grouped by electronic use or not. boxplot(Staffed_beds~EHR_use,data=hosps, xlab=&quot;EHR Use&quot;, ylab=&quot;Staffed_beds&quot;, ylim = c(0,1000)) boxplot(Total_discharges~EHR_use,data=hosps, xlab=&quot;EHR Use&quot;, ylab=&quot;Total discharge&quot;) boxplot(Patient_days~EHR_use,data=hosps, xlab=&quot;EHR Use&quot;, ylab=&quot;Patient days&quot;) boxplot(Gross_patient_revenue~EHR_use,data=hosps, xlab=&quot;EHR Use&quot;, ylab=&quot;Yearly gross patient revenue&quot;) boxplot(num_phys~EHR_use ,data=hosps, xlab=&quot;EHR Use&quot;, ylab=&quot;Number of Practitioners&quot;) boxplot(female_prop~EHR_use ,data=hosps, xlab=&quot;EHR Use&quot;, ylab=&quot;Proportion of Female&quot;) boxplot(yrs_since_grad~EHR_use ,data=hosps, xlab=&quot;EHR Use&quot;, ylab=&quot;Years since graduation&quot;) boxplot(n_specialty~EHR_use ,data=hosps, xlab=&quot;EHR Use&quot;, ylab=&quot;Number of specialties&quot;) 5.2.1.2 Correlations among variables #Correlation Matrix my_colors &lt;- brewer.pal(nlevels(as.factor(hosps$EHR_use)), &quot;Set1&quot;) ## Warning in brewer.pal(nlevels(as.factor(hosps$EHR_use)), &quot;Set1&quot;): minimal value for n is 3, returning requested palette with 3 different levels scatterplotMatrix(~num_phys+female_prop+Staffed_beds+Total_discharges+Patient_days+Gross_patient_revenue|EHR_use, data=hosps, col=my_colors , smoother.args=list(col=&quot;grey&quot;) , cex=1.5 , pch=c(15,16)) 5.2.1.3 Normality Check We notice that many of the predictor variables are not normally distributed in the above scatter plot. We logged the predictor variables that are skewed to be normally distributed. #Variables that are not normally distributed are logged: num_phys, staffed_bed, Gross_patient_revenue hosps$num_phys_log &lt;- round(log(hosps$num_phys),2) hosps$staffed_beds_log &lt;- round(log(hosps$Staffed_beds),2) hosps$gross_patient_rev_log &lt;- round(log(hosps$Gross_patient_revenue),2) hosps$total_discharge_log &lt;- round(log(hosps$Total_discharges),2) hosps$patient_days_log&lt;- round(log(hosps$Patient_days),2) #Check for normality after logging qqnorm(hosps$num_phys_log) qqline(hosps$num_phys_log) qqnorm(hosps$staffed_beds_log) qqline(hosps$staffed_beds_log) qqnorm(hosps$gross_patient_rev_log) qqline(hosps$gross_patient_rev_log) qqnorm(hosps$total_discharge_log) qqline(hosps$total_discharge_log) qqnorm(hosps$patient_days_log) qqline(hosps$patient_days_log) From observing qq-plots after taking log on the variables, we get much closer to normality for each variables. Now note some of correlations. Now let’s look at the correlation matrix again with the normalized variables. [General trends noticeable from the correlation matrix.] Years since graduation is relevant only to MD, so it is not applicable to all practitioners Female proportion is not associated with any other variables EHR seems most heavily correlated (correlation coefficients over 0.7) with num_phys, n_specialty, staffed_bed, and gross patient revenue. Potential confounding Factors: We can see that all four variables have positive correlation with each other. IN particular, total discharge has very strong positive association with patient days (coef = 0.99) #Correlation Matrix with logged variables #Final table scatterplotMatrix(~staffed_beds_log+total_discharge_log + patient_days_log +gross_patient_rev_log|EHR_use, data=hosps, col=my_colors , smoother.args=list(col=&quot;grey&quot;) , cex=1.5 , pch=c(15,16)) hosps_cor3 &lt;- hosps %&gt;% ungroup() %&gt;% mutate(EHR_use = ifelse(EHR_use==&#39;1&#39;, 1, 0)) %&gt;% select(staffed_beds_log, total_discharge_log, patient_days_log, gross_patient_rev_log) tidy(round(cor(hosps_cor3, use = &quot;complete.obs&quot;), 2)) ## .rownames staffed_beds_log total_discharge_log ## 1 staffed_beds_log 1.00 0.86 ## 2 total_discharge_log 0.86 1.00 ## 3 patient_days_log 0.88 0.99 ## 4 gross_patient_rev_log 0.81 0.91 ## patient_days_log gross_patient_rev_log ## 1 0.88 0.81 ## 2 0.99 0.91 ## 3 1.00 0.90 ## 4 0.90 1.00 The difference in distributions is not as apparent by the use of EHR. We believed that the gross patient revenue, which may be implying overall hospital size, is a confounding factor that affects other predictor variables. We can also observe this in the strong correlation (above 0.8) between GPR and staffed beds, GPR and total discharge, and GPR and patient days. Thus, we will stratify on gross patient revenue. Let’s see if other predictor variables still have effect on EHR use proportion after stratifying on GPR. hosps$gpr_grp = cut(hosps$gross_patient_rev_log, quantile(hosps$gross_patient_rev_log, prob = seq(0, 1, .2), na.rm = TRUE), include.lowest = TRUE) filter_var = &quot;total_discharge_log&quot; #&quot;staffed_beds_log&quot; #&quot;patient_days_log&quot; hosps %&gt;% filter(!is.na(gpr_grp)) %&gt;% group_by(gpr_grp) %&gt;% do(tidy(glm(EHR_use ~ staffed_beds_log + total_discharge_log + patient_days_log, data = ., family=&quot;binomial&quot;), conf.int = TRUE)) %&gt;% filter(term==filter_var) ## # A tibble: 5 x 8 ## # Groups: gpr_grp [5] ## gpr_grp term estimate std.error statistic ## &lt;fctr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 [8.2,11.9] total_discharge_log -1.967436 0.491234 -4.0050898 ## 2 (11.9,12.7] total_discharge_log -4.927093 1.449333 -3.3995581 ## 3 (12.7,13.4] total_discharge_log -4.829553 2.695692 -1.7915816 ## 4 (13.4,14.1] total_discharge_log -2.275644 1.916510 -1.1873892 ## 5 (14.1,16.5] total_discharge_log -1.453429 1.998146 -0.7273889 ## # ... with 3 more variables: p.value &lt;dbl&gt;, conf.low &lt;dbl&gt;, ## # conf.high &lt;dbl&gt; We are only showing the statistical results on total discharge because it is the only demographic that has a different significance in effect on EHR use across the stratification of gross patient revenue, as evident by the p-values. So in our final model, we will use total discharge and gross patient revenue and their interaction term. 5.2.2 Final Analysis We are just running the models below to show you our process of choosing the best fitting model, by splitting our data into training and test sets. Train &lt;- createDataPartition(hosps$EHR_use, p=0.6, list=FALSE) training &lt;- hosps[Train, ] testing &lt;- hosps[-Train, ] # first model with all hosptial demographics glm1 &lt;- glm(EHR_use ~ gross_patient_rev_log + staffed_beds_log + total_discharge_log + patient_days_log +staffed_beds_log:gross_patient_rev_log + total_discharge_log:patient_days_log, data=training, family = &quot;binomial&quot;) summary(glm1) ## ## Call: ## glm(formula = EHR_use ~ gross_patient_rev_log + staffed_beds_log + ## total_discharge_log + patient_days_log + staffed_beds_log:gross_patient_rev_log + ## total_discharge_log:patient_days_log, family = &quot;binomial&quot;, ## data = training) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -2.0305 -0.3535 -0.2603 -0.2060 2.9414 ## ## Coefficients: ## Estimate Std. Error z value ## (Intercept) 24.29327 5.39258 4.505 ## gross_patient_rev_log -2.30611 0.49088 -4.698 ## staffed_beds_log -4.75227 1.36357 -3.485 ## total_discharge_log -2.61047 0.69616 -3.750 ## patient_days_log 2.73517 0.69808 3.918 ## gross_patient_rev_log:staffed_beds_log 0.40783 0.10677 3.820 ## total_discharge_log:patient_days_log -0.06185 0.04895 -1.264 ## Pr(&gt;|z|) ## (Intercept) 6.64e-06 *** ## gross_patient_rev_log 2.63e-06 *** ## staffed_beds_log 0.000492 *** ## total_discharge_log 0.000177 *** ## patient_days_log 8.92e-05 *** ## gross_patient_rev_log:staffed_beds_log 0.000134 *** ## total_discharge_log:patient_days_log 0.206382 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 624.20 on 1106 degrees of freedom ## Residual deviance: 484.11 on 1100 degrees of freedom ## (8 observations deleted due to missingness) ## AIC: 498.11 ## ## Number of Fisher Scoring iterations: 6 p_hat_logit &lt;- predict(glm1, newdata = testing, type=&quot;response&quot;) y_hat_logit &lt;- ifelse(p_hat_logit &gt; 0.5, 1, 0) confusionMatrix(data = y_hat_logit, reference = testing$EHR_use) ## Warning in confusionMatrix.default(data = y_hat_logit, reference = testing ## $EHR_use): Levels are not in the same order for reference and data. ## Refactoring data to match. ## Confusion Matrix and Statistics ## ## Reference ## Prediction 1 0 ## 1 16 19 ## 0 662 43 ## ## Accuracy : 0.0797 ## 95% CI : (0.0612, 0.1016) ## No Information Rate : 0.9162 ## P-Value [Acc &gt; NIR] : 1 ## ## Kappa : -0.0495 ## Mcnemar&#39;s Test P-Value : &lt;2e-16 ## ## Sensitivity : 0.02360 ## Specificity : 0.69355 ## Pos Pred Value : 0.45714 ## Neg Pred Value : 0.06099 ## Prevalence : 0.91622 ## Detection Rate : 0.02162 ## Detection Prevalence : 0.04730 ## Balanced Accuracy : 0.35857 ## ## &#39;Positive&#39; Class : 1 ## Because total discharge and patient days have very high correlation (0.99), pick out one out of the two - total discharge. Also, because we observed from correlation plots that staffed beds and the gross patient revenue are highly correlated, we add interaction variable to the model. glm2 &lt;- glm(EHR_use ~ gross_patient_rev_log + staffed_beds_log + gross_patient_rev_log*staffed_beds_log + total_discharge_log, data=training, family = &quot;binomial&quot;) summary(glm2) ## ## Call: ## glm(formula = EHR_use ~ gross_patient_rev_log + staffed_beds_log + ## gross_patient_rev_log * staffed_beds_log + total_discharge_log, ## family = &quot;binomial&quot;, data = training) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -1.6894 -0.3466 -0.2697 -0.2300 2.7863 ## ## Coefficients: ## Estimate Std. Error z value ## (Intercept) 25.68744 5.31031 4.837 ## gross_patient_rev_log -2.18995 0.47545 -4.606 ## staffed_beds_log -3.37459 1.14599 -2.945 ## total_discharge_log -0.44873 0.21107 -2.126 ## gross_patient_rev_log:staffed_beds_log 0.31235 0.08909 3.506 ## Pr(&gt;|z|) ## (Intercept) 1.32e-06 *** ## gross_patient_rev_log 4.10e-06 *** ## staffed_beds_log 0.003233 ** ## total_discharge_log 0.033503 * ## gross_patient_rev_log:staffed_beds_log 0.000455 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 624.20 on 1106 degrees of freedom ## Residual deviance: 501.48 on 1102 degrees of freedom ## (8 observations deleted due to missingness) ## AIC: 511.48 ## ## Number of Fisher Scoring iterations: 6 This time, we will pick total discharge instead of the staffed beds. Then we will compare two models (glm2 vs. glm3) using chisquare test. glm3 &lt;- glm(EHR_use ~ gross_patient_rev_log + total_discharge_log + gross_patient_rev_log*total_discharge_log, data=training, family = &quot;binomial&quot;) summary(glm3) ## ## Call: ## glm(formula = EHR_use ~ gross_patient_rev_log + total_discharge_log + ## gross_patient_rev_log * total_discharge_log, family = &quot;binomial&quot;, ## data = training) ## ## Deviance Residuals: ## Min 1Q Median 3Q Max ## -1.8495 -0.3370 -0.2777 -0.2550 2.6907 ## ## Coefficients: ## Estimate Std. Error z value ## (Intercept) 35.18429 6.61203 5.321 ## gross_patient_rev_log -3.02172 0.59662 -5.065 ## total_discharge_log -3.64510 0.78982 -4.615 ## gross_patient_rev_log:total_discharge_log 0.28840 0.06561 4.395 ## Pr(&gt;|z|) ## (Intercept) 1.03e-07 *** ## gross_patient_rev_log 4.09e-07 *** ## total_discharge_log 3.93e-06 *** ## gross_patient_rev_log:total_discharge_log 1.11e-05 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 624.20 on 1106 degrees of freedom ## Residual deviance: 503.86 on 1103 degrees of freedom ## (8 observations deleted due to missingness) ## AIC: 511.86 ## ## Number of Fisher Scoring iterations: 6 p_hat_logit &lt;- predict(glm3, newdata = testing, type=&quot;response&quot;) y_hat_logit &lt;- ifelse(p_hat_logit &gt; 0.5, 1, 0) confusionMatrix(data = y_hat_logit, reference = testing$EHR_use) ## Warning in confusionMatrix.default(data = y_hat_logit, reference = testing ## $EHR_use): Levels are not in the same order for reference and data. ## Refactoring data to match. ## Confusion Matrix and Statistics ## ## Reference ## Prediction 1 0 ## 1 11 16 ## 0 667 46 ## ## Accuracy : 0.077 ## 95% CI : (0.0589, 0.0986) ## No Information Rate : 0.9162 ## P-Value [Acc &gt; NIR] : 1 ## ## Kappa : -0.0419 ## Mcnemar&#39;s Test P-Value : &lt;2e-16 ## ## Sensitivity : 0.01622 ## Specificity : 0.74194 ## Pos Pred Value : 0.40741 ## Neg Pred Value : 0.06452 ## Prevalence : 0.91622 ## Detection Rate : 0.01486 ## Detection Prevalence : 0.03649 ## Balanced Accuracy : 0.37908 ## ## &#39;Positive&#39; Class : 1 ## #chisquare test H0(null model): glm2, H1(alternative model):glm3 anova(glm3, glm2, test=&quot;Chisq&quot;) ## Analysis of Deviance Table ## ## Model 1: EHR_use ~ gross_patient_rev_log + total_discharge_log + gross_patient_rev_log * ## total_discharge_log ## Model 2: EHR_use ~ gross_patient_rev_log + staffed_beds_log + gross_patient_rev_log * ## staffed_beds_log + total_discharge_log ## Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi) ## 1 1103 503.86 ## 2 1102 501.48 1 2.3858 0.1224 Because the anova test yields that glm3 is better, our final model is glm3 with two variables: total staffed beds and gross patient revenue. Our final physician-level logistic regression model looked like this: \\[ logit(EHR) = \\beta_0 + \\beta_1(staffed~beds) + \\beta_2(gross~patient~revenue) + \\beta_3(interaction) \\] Here is a table of odds ratios with 95% CI. exp(cbind(OR = coef(glm3), confint(glm3))) ## Waiting for profiling to be done... ## OR 2.5 % ## (Intercept) 1.906966e+15 5.233109e+09 ## gross_patient_rev_log 4.871726e-02 1.481991e-02 ## total_discharge_log 2.611883e-02 5.560800e-03 ## gross_patient_rev_log:total_discharge_log 1.334285e+00 1.172378e+00 ## 97.5 % ## (Intercept) 9.745855e+20 ## gross_patient_rev_log 1.541502e-01 ## total_discharge_log 1.236346e-01 ## gross_patient_rev_log:total_discharge_log 1.516940e+00 Interpretation of the final model: If the total discharge is equal at 5000, with the 10% increase in the revenue, the odds of using EHR is 2.92 times higher. Similarly, if the gross patient revenue is equal at 5000 and the discharged increases by 10%, the odds of using EHR is 2.95 times higher. Mathematically, if revenue increases 10% and discharge is the same, the odds of using EHR is the higher by \\(1.102\\cdot \\log(1.1)-0.04\\cdot \\log(1.1)\\cdot \\log(discharge)\\) times. If discharge increases by 10% while the revenue is the same, the odds of using EHR is higher by \\(1.2411\\cdot \\log(1.1) - 0.046\\cdot \\log(1.1)\\cdot \\log(revenue)\\) "],
["secondary.html", "Chapter 6 Secondary Analysis 6.1 By Geographical Regions 6.2 By EHR Vendors", " Chapter 6 Secondary Analysis 6.1 By Geographical Regions 6.1.1 Physician Demographics data(&quot;zipcode&quot;) data(&quot;fifty_states&quot;) states_map &lt;- map_data(&quot;state&quot;) EHR_EPs %&gt;% group_by(Business_State_Territory) %&gt;% summarize(count = n()) %&gt;% ggplot() + geom_map(aes(map_id = id), data = fifty_states, map = fifty_states, color=&quot;grey50&quot;, fill=&quot;grey90&quot;) + geom_map(aes(map_id = tolower(Business_State_Territory), fill = count), map = fifty_states, color=&quot;grey50&quot;) + coord_map() + scale_fill_gradientn(colors = brewer.pal(6, &quot;RdYlBu&quot;)) + expand_limits(x=states_map$long, y=states_map$lat) + theme_grey() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), panel.grid = element_blank(), axis.title = element_blank(), legend.position = &quot;bottom&quot;) + ggtitle(&quot;Number of Physicians in Dataset&quot;) # gender distribution EHR_EPs %&gt;% group_by(Business_State_Territory) %&gt;% summarize(fem = mean(gndr == &quot;F&quot;), male = mean(gndr == &quot;M&quot;)) %&gt;% ggplot() + geom_map(aes(map_id = id), data = fifty_states, map = fifty_states, color=&quot;grey50&quot;, fill=&quot;grey90&quot;) + geom_map(aes(map_id = tolower(Business_State_Territory), fill = male), map = fifty_states, color=&quot;grey50&quot;) + coord_map() + scale_fill_gradientn(colors = brewer.pal(6, &quot;RdYlBu&quot;)) + expand_limits(x=states_map$long, y=states_map$lat) + theme_grey() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), panel.grid = element_blank(), axis.title = element_blank(), legend.position = &quot;bottom&quot;) + ggtitle(&quot;Distribution of Male Physicians&quot;) age &lt;- EHR_EPs %&gt;% filter(!is.na(grd_yr)) %&gt;% group_by(Business_State_Territory) %&gt;% summarize(yrsgrad = mean(2016 - grd_yr)) age %&gt;% ggplot() + geom_map(aes(map_id = id), data = fifty_states, map = fifty_states, color=&quot;grey50&quot;, fill=&quot;grey90&quot;) + geom_map(aes(map_id = tolower(Business_State_Territory), fill = yrsgrad), map = fifty_states, color=&quot;grey50&quot;) + coord_map() + scale_fill_gradientn(colors = brewer.pal(6, &quot;RdYlBu&quot;)) + expand_limits(x=states_map$long, y=states_map$lat) + theme_grey() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), panel.grid = element_blank(), axis.title = element_blank(), legend.position = &quot;bottom&quot;) + ggtitle(&quot;Years Since Graduation&quot;) Among those Physicians in our Vendor data set, there were many more freshly graduated practitioners in Minnesota compared to the rest of the country. We interpreted this as being similar to an ‘age’ variable, since people who have 15 years since graduating &amp; getting their degrees are more likely to be younger than those who have been graduated for 26 years. mn &lt;- subset(states_map, region %in% c(&quot;minnesota&quot;)) zip_mapdata &lt;- EHR_EPs %&gt;% filter(!is.na(grd_yr) &amp; Business_State_Territory == &quot;Minnesota&quot;) %&gt;% group_by(ZIP) %&gt;% summarize(yrsgrad = mean(2016 - grd_yr)) %&gt;% left_join(zipcode, by = c(&quot;ZIP&quot; = &quot;zip&quot;)) #minnesota only # zip_mapdata %&gt;% # ggplot() + # geom_polygon(data=mn, aes(x=long, y=lat, group = group),colour=&quot;white&quot;, fill=&quot;grey70&quot; ) + # geom_point(aes(x=longitude, y=latitude, color = yrsgrad),size=2,alpha=.5) + # coord_fixed(1.5) + # theme_void() #zoomed in on minnesota zip_mapdata %&gt;% ggplot() + geom_polygon(data=states_map, aes(x=long, y=lat, group = group),colour=&quot;grey50&quot;, fill=&quot;white&quot;) + geom_point(aes(x=longitude, y=latitude, color = yrsgrad),size=2,alpha=.8) + scale_color_gradientn(colors=brewer.pal(8, &quot;Reds&quot;)) + coord_fixed(xlim = c(-88, -98), ylim = c(42, 50), ratio = 1.5) + theme_void() + theme(legend.title = element_blank()) Here we can see that most of the Physicians we have are clustered near Minneapolis. useehr &lt;- EPs %&gt;% group_by(st) %&gt;% summarize(num = n(), used = sum(ehr == 1)) %&gt;% mutate(pct = used/num) state_name &lt;- c(state.name,&quot;District Of Columbia&quot;) states &lt;- data.frame(state_name = state_name, state_abb = c(state.abb, &quot;DC&quot;)) useehr &lt;- useehr %&gt;% left_join(states, by = c(&quot;st&quot; = &quot;state_abb&quot;)) ## Warning: Column `st`/`state_abb` joining character vector and factor, ## coercing into character vector useehr %&gt;% ggplot() + geom_map(aes(map_id = id), data = fifty_states, map = fifty_states, color=&quot;grey50&quot;, fill=&quot;grey90&quot;) + geom_map(aes(map_id = tolower(state_name), fill = pct), map = fifty_states, color=&quot;grey50&quot;) + coord_map() + scale_fill_gradientn(colors = brewer.pal(6, &quot;RdYlBu&quot;)) + expand_limits(x=states_map$long, y=states_map$lat) + theme_gray() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), panel.grid = element_blank(), axis.title = element_blank(), legend.position = &quot;bottom&quot;) + ggtitle(&quot;Percent EHR Usage&quot;) In our dataset overall, we had more blank information on EHR usage than we did on confirmed EHR usage, which is why the percentages are low overall. However, it is interesting to note that Alaska and Vermont had extremely low EHR usage, while the Midwest tended to have relatively more adoption. Perhaps Alaska and Vermont have more rural environments, while many of the EHR vendors are based in the Midwest. #find what types of product settings exist levels(EHR_EPs$Product_Setting) ## [1] &quot;&quot; &quot;Ambulatory&quot; &quot;Inpatient&quot; #ambulatory vs inpatient numbers EHR_EPs %&gt;% filter(Product_Setting != &quot;&quot;) %&gt;% summarize(amb = sum(Product_Setting == &quot;Ambulatory&quot;), inp = sum(Product_Setting == &quot;Inpatient&quot;)) ## amb inp ## 1 21513 2290 prod_setting &lt;- EHR_EPs %&gt;% filter(Product_Setting != &quot;&quot;) %&gt;% group_by(Business_State_Territory) %&gt;% summarize(num = n(), amb = sum(Product_Setting == &quot;Ambulatory&quot;), inpat = sum(Product_Setting == &quot;Inpatient&quot;)) %&gt;% mutate(p_amb = amb/num, p_inpp = inpat/num) # table for overall percentages in merge dataset prod_setting_overall &lt;- EHR_EPs %&gt;% summarize(total = n(), amb = sum(Product_Setting == &quot;Ambulatory&quot;), inpat = sum(Product_Setting == &quot;Inpatient&quot;)) %&gt;% mutate(&quot;Ambulatory (Outpatient)&quot; = amb/total, Inpatient= inpat/total) %&gt;% mutate(Place = &quot;Overall&quot;) %&gt;% select(Place, &quot;Ambulatory (Outpatient)&quot;, Inpatient) prod_setting_overall %&gt;% kable Place Ambulatory (Outpatient) Inpatient Overall 0.8906231 0.0948044 ambulatory &lt;- prod_setting %&gt;% ggplot() + geom_map(aes(map_id = id), data = fifty_states, map = fifty_states, color=&quot;grey50&quot;, fill=&quot;grey90&quot;) + geom_map(aes(map_id = tolower(Business_State_Territory), fill = p_amb), map = fifty_states, color=&quot;grey50&quot;) + coord_map() + scale_fill_gradientn(colors = brewer.pal(6, &quot;RdYlBu&quot;)) + expand_limits(x=states_map$long, y=states_map$lat) + theme_gray() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), panel.grid = element_blank(), axis.title = element_blank(), legend.position = &quot;bottom&quot;) + ggtitle(&quot;Product Setting = Ambulatory&quot;) inpatient &lt;- prod_setting %&gt;% ggplot() + geom_map(aes(map_id = id), data = fifty_states, map = fifty_states, color=&quot;grey50&quot;, fill=&quot;grey90&quot;) + geom_map(aes(map_id = tolower(Business_State_Territory), fill = p_inpp), map = fifty_states, color=&quot;grey50&quot;) + coord_map() + scale_fill_gradientn(colors = brewer.pal(6, &quot;RdYlBu&quot;)) + expand_limits(x=states_map$long, y=states_map$lat) + theme_gray() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), panel.grid = element_blank(), axis.title = element_blank(), legend.position = &quot;bottom&quot;) + ggtitle(&quot;Product Setting = Inpatient&quot;) grid.arrange(ambulatory, inpatient, nrow = 1) # california = outlier cali &lt;- EHR_EPs %&gt;% filter(Business_State_Territory == &quot;California&quot;) %&gt;% summarize(total = n(), amb = sum(Product_Setting == &quot;Ambulatory&quot;), inpat = sum(Product_Setting == &quot;Inpatient&quot;)) %&gt;% mutate(&quot;Ambulatory (Outpatient)&quot; = amb/total, Inpatient = inpat/total) %&gt;% select(&quot;Ambulatory (Outpatient)&quot;, Inpatient) prod_setting_overall &lt;- bind_rows(prod_setting_overall, data_frame(Place = &quot;California&quot;, &quot;Ambulatory (Outpatient)&quot; = cali$`Ambulatory (Outpatient)`, Inpatient = cali$Inpatient )) prod_setting_overall %&gt;% kable Place Ambulatory (Outpatient) Inpatient Overall 0.8906231 0.0948044 California 0.6114474 0.3838745 Product Setting refers to the type of practice setting that the EHR product is certified for. The possible settings are: Ambulatory: doctor’s offices, clinics, and other outpatient facilities Inpatient: hospitals and other long-term care facilities We found that most EHR products were certified for ambulatory settings, by far. This extreme preference in ambulatory EHR products is consistent across the country, except in California where there is still a slight preference for ambulatory EHR products (among those adopting EHR’s in the incentive program), but it is less than the rest of the country. # how many unique vendors length(unique(factor(EHR_EPs$Vendor_Name))) ## [1] 262 # find top 10 vendors top10 &lt;- EHR_EPs %&gt;% filter(!is.na(Vendor_Name)) %&gt;% group_by(Vendor_Name) %&gt;% summarize(num = n()) %&gt;% arrange(desc(num)) %&gt;% top_n(10) ## Selecting by num #unique vendors vendors &lt;- as.vector(top10$Vendor_Name) # distribution of top 10 vendors EHR_EPs %&gt;% filter(Vendor_Name %in% vendors) %&gt;% group_by(Vendor_Name) %&gt;% summarise(num = n()) %&gt;% ggplot(aes(x = reorder(Vendor_Name, num), y = num)) + geom_bar(stat=&#39;identity&#39;) + theme(axis.text.x = element_text(angle = 45, hjust = 1)) # percent usage of top 10 sum(top10$num)/nrow(EHR_EPs) ## [1] 0.5940385 pct_popvendors &lt;- EHR_EPs %&gt;% group_by(Business_State_Territory) %&gt;% summarize(num = n(), total_v = sum(Vendor_Name %in% vendors), opp = num - total_v) %&gt;% mutate(p_vend = total_v/num, u_vend = opp/num) pct_popvendors %&gt;% ggplot() + geom_map(aes(map_id = id), data = fifty_states, map = fifty_states, color=&quot;grey50&quot;, fill=&quot;grey90&quot;) + geom_map(aes(map_id = tolower(Business_State_Territory), fill = p_vend), map = fifty_states, color=&quot;grey50&quot;) + coord_map() + scale_fill_gradientn(colors = brewer.pal(6, &quot;RdYlBu&quot;)) + expand_limits(x=states_map$long, y=states_map$lat) + theme_gray() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), panel.grid = element_blank(), axis.title = element_blank(), legend.position = &quot;bottom&quot;) + ggtitle(&quot;Usage of Top 10 Vendors&quot;) We found that the majority of EHR products used were from the top 10 vendors. Interestingly, though, Minnesota had almost 100% usage of the top 10 vendors. This could potentially be because many of the big vendors are based in the Midwest (ie Epic, Mayo Clinic, Cerner, etc). #most common specialties in general EHR_EPs %&gt;% group_by(pri_spec) %&gt;% summarize(num = n()) %&gt;% arrange(desc(num)) ## # A tibble: 65 x 2 ## pri_spec num ## &lt;fctr&gt; &lt;int&gt; ## 1 OPTOMETRY 5155 ## 2 CHIROPRACTIC 3161 ## 3 FAMILY PRACTICE 2637 ## 4 DERMATOLOGY 2534 ## 5 OPHTHALMOLOGY 2044 ## 6 INTERNAL MEDICINE 1499 ## 7 OBSTETRICS/GYNECOLOGY 1098 ## 8 PODIATRY 738 ## 9 PSYCHIATRY 652 ## 10 ALLERGY/IMMUNOLOGY 401 ## # ... with 55 more rows # most common state -&gt; specialty specialty &lt;- EHR_EPs %&gt;% group_by(Business_State_Territory, pri_spec) %&gt;% summarize(num = n()) %&gt;% arrange(Business_State_Territory, desc(num)) #check similar specialties #EHR_EPs %&gt;% filter(grepl(&quot;PSYCH&quot;, pri_spec)) %&gt;% distinct(pri_spec) specialty %&gt;% ggplot(aes(Business_State_Territory, pri_spec)) + geom_tile(aes(fill = num)) When it came to looking at patterns between primary specialty and states, it was nearly impossible to find useful information. There were too many states and too many different specialties to try to find significant correlations between the levels. Additionally, we tried to find group similar specialties but it did not make the results much more interpretable. 6.1.2 Hospital Demographics #load hosp_all data &amp; add long state names state_name &lt;- c(state.name,&quot;District Of Columbia&quot;) states &lt;- data.frame(state_name = state_name, state_abb = c(state.abb, &quot;DC&quot;)) hosp_all &lt;- hosp_clean %&gt;% left_join(states, by = c(&quot;State&quot; = &quot;state_abb&quot;)) ## Warning: Column `State`/`state_abb` joining character vector and factor, ## coercing into character vector beds &lt;- hosp_all %&gt;% filter(!is.na(Staffed_beds)) %&gt;% group_by(state_name) %&gt;% summarize(avgbed = mean(Staffed_beds)) beds %&gt;% ggplot() + geom_map(aes(map_id = id), data = fifty_states, map = fifty_states, color=&quot;grey50&quot;, fill=&quot;grey90&quot;) + geom_map(aes(map_id = tolower(state_name), fill = avgbed), map = fifty_states, color=&quot;grey50&quot;) + coord_map() + scale_fill_gradientn(colors = brewer.pal(6, &quot;RdYlBu&quot;)) + expand_limits(x=states_map$long, y=states_map$lat) + theme_gray() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), panel.grid = element_blank(), axis.title = element_blank(), legend.position = &quot;bottom&quot;) + ggtitle(&quot;Average Hospital Beds per hospital&quot;) Vermont and Rhode Island had the lowest number of average hospital beds per hospital, which makes sense since they are small states. Connecticut and Florida had the highest average, suggesting that hospitals in that state tend to be bigger on average. # patient days hosp_all %&gt;% filter(!is.na(Patient_days)) %&gt;% group_by(state_name) %&gt;% summarize(patient = mean(Patient_days)) %&gt;% ggplot() + geom_map(aes(map_id = id), data = fifty_states, map = fifty_states, color=&quot;grey50&quot;, fill=&quot;grey90&quot;) + geom_map(aes(map_id = tolower(state_name), fill = patient), map = fifty_states, color=&quot;grey50&quot;) + coord_map() + scale_fill_gradientn(colors = brewer.pal(6, &quot;RdYlBu&quot;)) + expand_limits(x=states_map$long, y=states_map$lat) + theme_gray() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), panel.grid = element_blank(), axis.title = element_blank(), legend.position = &quot;bottom&quot;) + ggtitle(&quot;Across states, mean patient days per hospital&quot;) The distribution of average days at the hospital was mostly proportional to the distribution of average hospital beds from the previous map. The differences were: Florida had one of the highest averages for hospital beds (biggest hospitals) but did not have one of the highest average patient days (yay!) Massachusetts, which was slightly above average in the number of hospital beds, ended up being one of the states with the longest patient days on average. #total discharges hosp_all %&gt;% filter(!is.na(Total_discharges)) %&gt;% group_by(state_name) %&gt;% summarize(discharges = mean(Total_discharges)) %&gt;% ggplot() + geom_map(aes(map_id = id), data = fifty_states, map = fifty_states, color=&quot;grey50&quot;, fill=&quot;grey90&quot;) + geom_map(aes(map_id = tolower(state_name), fill = discharges), map = fifty_states, color=&quot;grey50&quot;) + coord_map() + scale_fill_gradientn(colors = brewer.pal(6, &quot;RdYlBu&quot;)) + expand_limits(x=states_map$long, y=states_map$lat) + theme_gray() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), panel.grid = element_blank(), axis.title = element_blank(), legend.position = &quot;bottom&quot;) + ggtitle(&quot;Across states, mean discharges days per hospital on average&quot;) The distribution of average discharges was not very interesting - it was similar to the previous maps. #avg revenue per discharge revenue &lt;- hosp_all %&gt;% filter((Gross_patient_revenue != 0) &amp; (Total_discharges != 0)) %&gt;% mutate(per = Gross_patient_revenue/Total_discharges) %&gt;% group_by(State) %&gt;% summarize(rev = mean(per)) revenue %&gt;% ggplot() + geom_map(aes(map_id = id), data = fifty_states, map = fifty_states, color=&quot;grey50&quot;, fill=&quot;grey90&quot;) + geom_map(aes(map_id = tolower(state_name), fill = rev), map = fifty_states, color=&quot;grey50&quot;) + coord_map() + scale_fill_gradientn(colors = brewer.pal(6, &quot;RdYlBu&quot;)) + expand_limits(x=states_map$long, y=states_map$lat) + theme_gray() + theme(axis.text = element_blank(), axis.line = element_blank(), axis.ticks = element_blank(), panel.border = element_blank(), panel.grid = element_blank(), axis.title = element_blank(), legend.position = &quot;bottom&quot;) + ggtitle(&quot;Across states, average revenue per discharge&quot;) Looks like Montana has the highest average gross patient revenue per discharge. 6.1.3 Regional Conclusions The regional analyses served mostly exploratory/informational purposes. While we noticed many patterns regarding the Midwest, it is not clear if the patterns are due to association or causation. For example, we saw that the Midwestern states tended to have higher rates of EHR usage compared to the rest of the country. However, we also saw that many of the “Top 10” vendors in our data set were also based in the Midwest. There could have been confounding effects - our data set may not have been representative of the entire country - Healthit.gov cited over 75% of Physician EHR adoption by 2015, while our data set could only match about 20% EHR usage in 2016. We could have had a skewed sample of Physicians that happened to have more EHR adopter living in the Midwest. Also, the first plot showed that we did have strong representation in Physician counts in Minnesota and California, but not as much in the rest of the country. 6.2 By EHR Vendors 6.2.1 Physician Demographics Check the distributions of number of practice locations, states, products, and vendors among practitioners whom we have EHR usage information on. Counts of these distributions are the number of practitioners. #specialty vs year since graduation top_spec &lt;- EHR_EPs %&gt;% filter(!is.na(pri_spec)) %&gt;% group_by(pri_spec) %&gt;% summarize(num = n()) %&gt;% arrange(desc(num)) %&gt;% head(10) spec_list &lt;- c(&quot;OPTOMETRY&quot;, &quot;CHIROPRACTIC&quot;, &quot;DERMATOLOGY&quot;, &quot;OPHTHALMOLOGY&quot;, &quot;FAMILY PRACTICE&quot;, &quot;INTERNAL MEDICINE&quot;, &quot;OBSTETRICS/GYNECOLOGY&quot;, &quot;PODIATRY&quot;, &quot;PSYCHIATRY&quot;, &quot;NEUROLOGY&quot;) EHR_EPs %&gt;% filter(pri_spec %in% spec_list) %&gt;% mutate(yrsgrad = 2016 - grd_yr) %&gt;% ggplot(aes(x = pri_spec, y = yrsgrad)) + geom_boxplot() + theme(axis.text.x = element_text(angle = 45, hjust = 1)) #vendors vs year since graduation EHR_EPs %&gt;% filter(Vendor_Name %in% vendors) %&gt;% mutate(yrsgrad = 2016 - grd_yr) %&gt;% ggplot(aes(x = Vendor_Name, y = yrsgrad)) + geom_boxplot() + theme(axis.text.x = element_text(angle = 45, hjust = 1)) #top vendors vs top specialty EHR_EPs %&gt;% filter((pri_spec %in% spec_list) &amp; (Vendor_Name %in% vendors)) %&gt;% ggplot(aes(x = pri_spec, y = Vendor_Name)) + geom_jitter(alpha = 0.2, color = &quot;steelblue4&quot;) + theme_minimal() + theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = &quot;none&quot;, axis.title = element_blank()) + ggtitle(&quot;Top 10 Primary Specialties versus Top 10 Vendors&quot;) Interesting conclusions from the boxplots: Ophthalmology had the highest median years since graduation, which makes sense that we found that our EHR users had more years since graduation than non-EHR users Mayo Clinic and GE Healthcare were used by the youngest practitioners, both having median years since graduation under 10 years. Interesting conclusions from the jitter plot: Integrated Practice Solutions, Inc, the second most popular vendor in our data set, is exclusively used by chiropractors. They also dominate the other vendors among the chiropractors. Eyefinity, Inc also has a specific audience, with only ophthalmologists and optometrists (eye doctors) using their products. Compulink Business Systems, Inc, is also very popular among the two eye specialties and their products seem to be targeted for a specific audience. While NextGen Healthcare is used by all the top 10 specialties, they are most popular among the ophthalmologists and optometrists. Modernizing Medicine Inc is very popular among dermatologists. Epic Systems, Cerner Corporation, athenahealth, and GE Healthcare are pretty consistently used across all the top 10 disciplines. Epic is the most consistently popular, however. "]
]
